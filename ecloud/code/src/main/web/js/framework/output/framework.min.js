define("framework.alert",["exports","framework.core"],function(t,e){function i(){return this.dom=$('<div class="ef-alert-box-" style="width: 100%;height:100%;z-index:2147483648;position:fixed;top:0;"> <div class="window-loading" style="width:100%;height:100%;z-index:2147483642;position: absolute;"></div><div class="ef-alert" style="z-index: 2147483643;"><div  class="ef-alert-box"><div class="ef-alert-top"><span class="ef-alert-msg"></span></div><div class="ef-alert-bottom"><span class="ef-alert-close">close</span></div></div></div></div>'),this.init(),this.addListener(),this}return i.prototype.init=function(){this.dom.find(".ef-alert-close").text(_.getLocale("cal.host.switch.open"))},i.prototype.addListener=function(){var t=this;this.dom.find(".ef-alert-bottom .ef-alert-close").click(function(){t.hide()}),$(window).keydown(function(e){27==e.keyCode&&t.hide()})},i.prototype.show=function(t){return this.hide(),$(document.body).append(this.dom),this.dom.find(".ef-alert-msg").text(t),this.dom.fadeIn("fast"),t},i.prototype.hide=function(){$(document.body).find(".ef-alert-box-").off().remove()},e.rewrite(e.root,{alert:i}),i}),define("framework.appBlock",["exports","framework.core"],function(t,e){function i(t,e){return this.box=t,this.data=e,this.clickCallback=$.noop,this.data=this.data?this.data:[],this.left=$('<div class="appBlock-left"><</div>'),this.right=$('<div class="appBlock-right">></div>'),this.templateAll=$('<ul class="appBlock-all"></ul>'),this.templateRender=$('<li class="appBlock-all-render"></li>'),this.template=$('<div class="appBlock-block"></div>'),this.iDom=$('<i style="display: inline-block"></i>'),this.blockData=null,this.liLength=0,this.moveLen=0,this.labelField="label",this.valueField="value",this.idField="id",this.arr=[],this.draw(),this.args=arguments,this}return i.isDom=!0,i.prototype.resizeChange=function(){var t=this;this.templateAll.empty();var i=/[1-9][0-9]*/g,n=this.box.css("width").match(i);this.liLength=2*Math.floor((n-40)/145),this.moveLen=Math.ceil(this.data.data.length/this.liLength);for(var s=0;s<this.liLength;s++){var o=t.templateRender.clone(!0),a=e.util.pluck(t.arr,"dom");if(s*this.liLength>a.length)break;o.append(a.slice(s*this.liLength,s*this.liLength+this.liLength)),t.templateAll.append(o)}this.hoverOn(),this.move(this.moveLen),this.addListener()},i.prototype.draw=function(){var t=this;t.arr=[],t.templateAll.empty(),this.labelField=this.data.labelField||this.labelField,this.valueField=this.data.valueField||this.valueField,this.idField=this.data.idField||this.idField,this.box.append(this.left).append(this.right).append(this.templateAll),$(this.data.data).each(function(e,i){var n={dom:t.template.clone(!0),index:e,text:i[t.labelField],data:i};n.dom.text(i[t.labelField]),n.dom.attr("id",i[t.idField]),t.arr.push(n),n.dom.data("bdata",i)}),t.resizeChange(),$(window).resize(function(){t.resizeChange(),t.templateAll.find("li").eq(0).show()}),t.templateAll.find("li").eq(0).show(),this.data.data.length<7?($(".appBlock-left",this.box).hide(),$(".appBlock-right",this.box).hide()):($(".appBlock-left",this.box).show(),$(".appBlock-right",this.box).show())},i.prototype.move=function(t){var e=this,i=0;$(".appBlock-left",this.box).click(function(){0!=i&&(i--,e.templateAll.find("li").eq(i).show().siblings().hide())}),$(".appBlock-right",this.box).click(function(){i!=t-1&&(i++,e.templateAll.find("li").eq(i).show().siblings().hide())})},i.prototype.hoverOn=function(){var t=this;$(".appBlock-block",this.box).hover(function(){t.blockData=$(this).text(),$(this).empty();for(var e=0;e<t.data.icon.length;e++){var i=t.iDom.clone(!0);i.addClass(t.data.icon[e].iconClass),$(this).append(i),i.tooltip({content:t.data.icon[e].tip})}},function(){$(this).empty().text(t.blockData)})},i.prototype.addListener=function(){var t=this;$(".appBlock-block",this.box).click(function(i){var n=$(i.target).index(),s=$(".appBlock-all div",t.box).index($(this)),o=e.util.findWhere(t.arr,{index:s});t.clickCallback(o,t.data.icon[n],n)})},i.prototype.iconClick=function(t){this.clickCallback=t},i.prototype.removeBlock=function(t){$(".appBlock-block",this.box).eq(t).remove()},i.prototype.loadData=function(t){this.data.data=t,this.draw()},i.prototype.destroy=function(){},e.register(i,"appBlock"),i}),define("framework.backup",["exports","framework.core"],function(t,e){function i(t,i,n){if(this.box=t,this.data=i,!i)return null;this.container=$('<div class="ef-backup"></div>'),this.tempalte=$("<canvas></canvas>"),this.square=$('<div class="ef-backup-square"></div>'),this.legendTemplate=$('<span class="ef-backup-legend-item"><i></i><label></label></span>'),this.render(n);var s=this;return this.lastRow=null,this.type="none",this.oldRows=null,$(e.root).resize(function(){s.render(s.config)}),this}return i.isDom=!0,i.prototype.render=function(t){this.init(),_.copyProperty(this.config,t),this.draw(),this.addListener()},i.prototype.click=function(t){return this.config.click=t||this.config.click||$.noop,this},i.prototype.init=function(){this.config=this.config||{rowHeight:130,labelHeight:30,normalColor:"#bcbcbc",normalHighlightColor:"#626262",selectedColor:"#0080c9",selectedHighlightColor:"#005a96",paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,dotRadius:12,dotLev1Radius:3,dotLev2Radius:5,dotOuterMargin:5,dotOuterRadius:16,isEdit:!0,vmStates:["available","backuping","recovering","error"],dotState:["available","error","creating","recovering","deleting"]},this.rows&&(this.oldRows=this.getRows(this.rows.concat([]))),this.rows=[],this.config.click=this.config.click||$.noop,this.config.formatter=this.config.formatter||function(t){return t.des},this.data.backups=this.data.backups||[]},i.prototype.getRowsHeight=function(){var t=0;return t+=2*this.config.dotRadius+this.config.rowHeight*this.data.backups.length},i.prototype.draw=function(){this.width=this.box.width(),this.height=this.config.paddingTop+this.config.paddingBottom+this.getRowsHeight()+this.config.labelHeight,this.contentWidth=this.width-this.config.paddingLeft-this.config.paddingRight,this.contentHeight=this.getRowsHeight(),this.posX=this.config.paddingLeft,this.posY=this.config.paddingTop,this.box.empty(),this.container.empty(),this.container.height(this.height),this.tempalte.attr("width",this.width),this.tempalte.attr("height",this.height),this.baseLayer=this.tempalte.clone(!1),this.baseContext=this.baseLayer[0].getContext("2d"),this.tipLayer=this.tempalte.clone(!1),this.tipContext=this.tipLayer[0].getContext("2d"),this.iconLayer=$('<div class="backup-icon-layer"></div>'),this.descLayer=$('<div class="backup-desc-layer"></div>'),this.legendLayer=$('<div class="backup-legend-layer"></div>'),this.hoverLayer=this.tempalte.clone(!1),this.hoverContext=this.hoverLayer[0].getContext("2d"),this.baseLayer.css({"z-index":1}),this.descLayer.css({"z-index":7}),this.tipLayer.css({"z-index":3}),this.hoverLayer.css({"z-index":5}),this.iconLayer.css({"z-index":7}),this.legendLayer.css({"z-index":6}),this.box.append(this.container),this.container.append(this.baseLayer),this.container.append(this.descLayer),this.container.append(this.tipLayer),this.container.append(this.hoverLayer),this.container.append(this.legendLayer),this.container.append(this.iconLayer),this.createRows(),this.createLegend()},i.prototype.createLegend=function(){var t=$("<div style='float: right; margin-top: 10px;'></div>"),e=this;$(this.config.dotState).each(function(i,n){var s=e.legendTemplate.clone();s.find("i").addClass("ef-backup-state-"+n||"available"),s.find("label").text(_.getLocale("backup.dot.state."+n+".text")),t.append(s)}),this.legendLayer.append(t)},i.prototype.showTip=function(t){},i.prototype.hideTip=function(){},i.prototype.hover=function(t){var e=this,i=t.offsetX,n=t.offsetY,s=(e.box.offset().left,e.box.offset().top,_.find(e.rows,function(t){return i>=t.x1&&i<t.x2&&n>=t.y1&&n<t.y3}));s?(e.showTip(s),s.data.isFirst?e.container.find(".backup-btn").hide():(e.createOverRow(s),e.lastRow&&e.lastRow!=s&&e.lastRow.btns&&e.lastRow.btns.hide(),s.btns?s.btns.show():null),e.lastRow=s):(e.hideTip(),e.lastRow&&(e.lastRow.btns&&e.lastRow.btns.hide(),e.lastRow=null))},i.prototype.addListener=function(){var t=this;this.hoverLayer.off(),this.hoverLayer.hover(function(e){t.hover(e)},function(){t.hideTip()}),this.hoverLayer.mouseout(function(){t.hideTip()}),this.hoverLayer.click(function(){t.hideTip()}),this.hoverLayer.mousemove(function(e){t.hover(e)})},i.prototype.removeListener=function(){},i.prototype.createOverRow=function(t){},i.prototype.createRows=function(){var t=this,e=new this.Row;e.width=this.contentWidth,e.height=this.config.labelHeight+2*this.config.dotRadius,e.data={isFirst:!0,title:"selected",status:this.data.status},e.x=this.posX,e.y=this.posY,e.x1=e.x,e.y1=e.y,e.x2=e.x1+e.width,e.y2=e.y1,e.x3=e.x1,e.y3=e.y1+e.height,e.x4=e.x2,e.y4=e.y3,this.drawDot(this.config.selectedColor,this.config.selectedHighlightColor,this.posX+this.config.dotRadius,this.posY+this.config.dotRadius,e),this.rows.push(e),$(this.data.backups).each(function(e,i){var n=new t.Row;n.index=e,n.width=t.contentWidth,n.height=t.config.rowHeight,n.x=t.posX,n.y=t.posY+2*t.config.dotRadius+t.config.rowHeight*e+t.config.labelHeight,n.data=i,n.x1=n.x,n.y1=n.y,n.x2=n.x1+n.width,n.y2=n.y1,n.x3=n.x1,n.y3=n.y1+n.height,n.x4=n.x2,n.y4=n.y3,n.index=e;var s=$('<span class="backup-des"></span>');if(s.text(n.data.des),s.attr("title",n.data.des),s.css({left:t.contentWidth-n.x-987,top:n.y+n.height-2*t.config.dotOuterMargin-50}),t.descLayer.append(s),t.config.isEdit){var o=$('<div style="position:absolute;" class="backup-btn"></div>');t.iconLayer.append(o);var a,r;t.oldRows&&(r=t.oldRows[e]),a=o.iconmenu([{iconClass:"ef-backup-icon-menus-icon-revert",tip:_.getLocale("global.button.rever.label"),type:"revert",index:0,disable:Boolean(r&&r.menu.menus[0].disable),id:1,click:function(){t.config.click(i,this)}},{iconClass:"icon-menus-icon-edit",tip:_.getLocale("global.button.edit.label"),type:"edit",index:2,disable:Boolean(r&&r.menu.menus[2].disable),id:3,click:function(){t.config.click(i,this)}},{iconClass:"ef-backup-icon-menus-icon-delete",tip:_.getLocale("global.button.delete.label"),type:"delete",index:1,disable:Boolean(r&&r.menu.menus[1].disable),id:2,click:function(){t.config.click(i,this)}}],!0),o.css({left:n.x+2*t.config.dotRadius+150,top:n.y+n.height-t.config.labelHeight-t.config.dotOuterMargin-110}),n.btns=o,n.menu=a,o.hide()}t.rows.push(n),t.createRow(n)})},i.prototype.createRow=function(t){this.baseContext.lineWidth=1,this.baseContext.beginPath(),this.baseContext.strokeStyle=this.config.normalColor,this.baseContext.moveTo(t.x+this.config.dotRadius+30.5,t.y-this.config.labelHeight+.5),this.baseContext.lineTo(t.x+this.config.dotRadius+30.5,t.y+t.height-2*this.config.dotRadius-this.config.dotOuterMargin+30+.5),this.baseContext.closePath(),this.baseContext.stroke(),this.baseContext.stroke(),this.baseContext.moveTo(.5,t.y+t.height-this.config.labelHeight+.5),this.baseContext.lineTo(t.x+t.width-2*this.config.dotRadius+.5,t.y+t.height-this.config.labelHeight+.5),this.baseContext.closePath(),this.baseContext.stroke(),this.drawDot(this.config.normalColor,this.config.normalHighlightColor,t.x+this.config.dotRadius,t.y+t.height-this.config.dotRadius-this.config.labelHeight,t),this.drawText(t)},i.prototype.drawText=function(t){this.baseContext.beginPath(),this.baseContext.textAlign="left",this.baseContext.font="14px bold 微软雅黑,Microsoft YaHei",this.baseContext.fillText(t.data.title,t.x+2*this.config.dotRadius+3*this.config.dotOuterMargin+22,t.y-2*this.config.dotOuterMargin+20),this.baseContext.closePath(),this.baseContext.textAlign="right",this.baseContext.beginPath(),this.baseContext.fillText(_.number2time(t.data.time,"Y-M-D h:m:s",!0),this.contentWidth-t.x-5,t.y+t.height-2*this.config.dotOuterMargin-this.config.labelHeight),this.baseContext.closePath(),this.baseContext.beginPath(),this.baseContext.textAlign="left",this.baseContext.fillText(t.data.size+t.data.unit||0,t.x+2*this.config.dotRadius+3*this.config.dotOuterMargin+22,t.y+t.height-2*this.config.dotOuterMargin-this.config.labelHeight-40),this.baseContext.closePath()},i.prototype.drawDot=function(t,e,i,n,s){var o=$('<span class="absolute ef-backup-doti-span"><i class="ef-backup-doti"></i><label></label></span>');o.css({left:i+20,top:n-92}),o.find("i").addClass((s.data.isFirst?"ef-backup-vm-state-":"ef-backup-state-")+s.data.status||"available"),this.legendLayer.append(o),s.data.isFirst?(o.css({left:i+20,top:n-5}),o.find("label").text(_.getLocale("backup.vm.state."+this.data.status+".text"))):o.tooltip({content:_.getLocale("backup.dot.state."+s.data.status+".text")})},i.prototype.Row=function(){this.x=0,this.y=0,this.width=0,this.height=0,this.data={},this.x1=0,this.x2=0,this.x3=0,this.x4=0,this.y1=0,this.y2=0,this.y3=0,this.y4=0,this.menu=null,this.index=-1},i.prototype.getRows=function(t){return t=t||this.rows,_.filter(t,function(t){return-1!=t.index})},e.register(i,"backup"),i}),define("framework.breadcrumbs",["exports","framework.core","framework.nav","user"],function(t,e,i,n){function s(){this.data=null,this.currentId="",this.lastId="",this.doms=[],this.dashboard=null,this.userValue=n.getRole().value}var o=!1;s.prototype.render=function(t,i,n){if(this.currentId=t,this.lastId=i,this.data||(this.data=this.filterData(n)),this.dashboard||this.noDashboard||(this.dashboard=this.getDashboard(),this.dashboard.noDashboard&&7==this.userValue&&(this.dashboard=null,o=!0)),t!=i){var s=[];if(!o&&this._isDashboard(t)){var a=e.localStorage.get("current-datacenter");return a&&a.name&&(this.dashboard=$.extend({},this.dashboard,{vmText:a.name})),s.push(this.getDom(this.dashboard,"span")),void this.addListener(s)}var r=this.getCurrentById(t),c=r.length;if(c){o||s.push(this.getDom(this.dashboard,"a"));var h=_.findIndex(r.reverse(),function(t){return t.isDetail});if(-1==h)return 1==c&&s.push(this.getDom(r[0],"span")),2==c&&(s.push(this.getDom(r[0],"double")),s.push(this.getDom(r[1],"span"))),void this.addListener(s);var l=this;_.each(r,function(t,i){if(0==i)return void s.push(l.getDom(r[i],"double"));if(i==c-1){var n=$.extend({},r[i],{vmText:e.util.getLocale("framework.breadcrumb.detail.text")});return void s.push(l.getDom(n,"span"))}if(i>=h){var o=$.extend({},r[i],{vmText:l.getDetailData()||e.util.getLocale("framework.breadcrumb.detail.text")});return void s.push(l.getDom(o,"a"))}s.push(l.getDom(r[i],"a"))}),this.addListener(s)}}},s.prototype.getDetailData=function(t){if(t)return e.nav.current&&e.nav.current.data?e.nav.current.data:void 0;var i=void 0;if(e.nav.current&&e.nav.current.data){var n=e.nav.current.data;try{var s=e.util.unescapeJSON(n),o=JSON.parse(s);i=o.name||o.app_id||o.id}catch(a){i=n}}return i},s.prototype._isDashboard=function(t){return t===this.dashboard.id},s.prototype.addListener=function(t){var i=$(".bread-items");i.off("click.breadcrumbs").find("a").off("click.breadcrumbs").end().empty(),i.append(t),i.on("click.breadcrumbs","a",$.proxy(function(t){t.preventDefault();var i=$(t.target),n=i.attr("id"),s=i.attr("src");console.log("thomas----",r,"thomas----",n),e.nav["goto"](s,n,r[n]);var o=this.findNavItem(i.attr("id"));o&&o.trigger("click")},this))},s.prototype.findNavItem=function(t){if(!this.doms.length){var e=$(".nav .lev0"),i=$(".nav .lev1"),n=[];e&&!e.is("document")&&(n=n.concat(e.toArray())),i&&!i.is("document")&&(n=n.concat(i.toArray())),this.doms=n}var s=_.find(this.doms,function(e,i){return $(e).attr("id")==t});return s&&$(s).attr("id")&&$(s).attr("src")?$(s):null},s.prototype.filterData=function(t){var e=[],i=n.getRole().value;return _.isArray(t)&&t.length?(_.each(_.clone(t),function(e){var n=e.invisible;if(n){var s=_.findIndex(t,function(t){return _.contains(n,i)});s>-1&&t.splice(s,1)}}),n.isSuper()?t:(_.each(t,function(t){var n=t.access;if(_.contains(n,i)){var s=t.children,o=_.clone(t);s&&(o.children=_.filter(s,function(t){return _.contains(t.access,i)})),e.push(o)}}),e)):e},s.prototype.getDashboard=function(){e.nav||require([e.nav]);var t=e.nav["default"];return this.getCurrentById(t)[0]},s.prototype.getDom=function(t,i){var n={};return t?(n.id=t.id,n.src=t.src,n.text=t.vmText||e.util.getLocale("framework.component.nav."+t.id+".label")):n.text=e.util.getLocale("framework.breadcrumb.detail.text"),this.getTemplate(n,i)};var a={span:"<span>{{text}}</span>","double":"<span>{{text}}</span><span>></span>",a:'<a href="javascript:void(0)" id = "{{id}}" src="{{src}}">{{text}}</a><span>></span>'};s.prototype.getTemplate=function(t,e){_.templateSettings={interpolate:/\{\{(.+?)\}\}/g};var i=a[e];return _.template(i)(t)};var r={};return s.prototype.getCurrentById=function(t){function i(t,a){if(s)for(var c=a,h=0,l=c.length;l>h&&s;){var d=c[h];if(d.isRepain&&(n=[]),d.id==t){s=!1;var p=e.util.dcopy(d);p.children&&(p.children=null),r[t]=o.getDetailData(!0),n.push(p)}else if(d.children&&(i(t,d.children),!s)){var u=e.util.dcopy(d);u.children&&(u.children=null),n.push(u)}h++}}var n=[],s=!0,o=this;return i(t,this.data),s&&(n=[]),n},s.isInstance=!0,e.register(s,"breadcrumbs"),s}),define("framework.buttonstep",["exports","framework.core"],function(t,e){function i(t,e){return this.box=t,this.data=e,this.steps=[],this.current=0,this.container=$('<ul class="button-step"></ul>'),this.li=$("<li></li>"),this.template=$('<span class="btn"><a></a></span>'),this.viewstack=null,this.confirmCallback=$.noop,this.init(),this.draw(),this}return i.isDom=!0,i.prototype.init=function(){if(this.config={length:4,first:_.getLocale("framework.component.buttonstep.first"),prev:_.getLocale("framework.component.buttonstep.prev"),next:_.getLocale("framework.component.buttonstep.next"),last:_.getLocale("framework.component.buttonstep.last"),enabled:!0},_.copyProperty(this.config,this.data),this.config.length<0)throw new Error("Wrong with ButtonStep.length<0")},i.prototype.addListener=function(){var t=this;this.container.find(".next").click(function(){t.next()}),this.container.find(".prev").click(function(){t.prev()}),this.container.find(".last").click(function(){t.config.enabled&&t.confirmCallback($(this))})},i.prototype.setEnabled=function(t){this.config.enabled=t,t?this.container.find(".last").removeClass("disabled"):this.container.find(".last").addClass("disabled")},i.prototype.change=function(t){return this.viewstack.change(t),this},i.prototype.confirm=function(t){return t&&(this.confirmCallback=t),this},i.prototype.draw=function(){var t=this;this.box.empty(),this.container.empty(),this.box.append(this.container);for(var e=0;e<this.config.length;e++){var i=new t.Step;i.position=e;var n=this.li.clone();i.dom=n;var s=this.template.clone(),o=this.template.clone();n.append(s),n.append(o),e?(s.find("a").text(this.config.prev),o.find("a").text(this.config.next),s.addClass("prev"),e==this.config.length-1?(o.find("a").text(this.config.last),o.addClass("last")):o.addClass("next")):(s.addClass("first"),o.addClass("next"),s.find("a").text(this.config.first),o.find("a").text(this.config.next),s.remove()),this.container.append(n)}this.addListener(),this.viewstack=this.container.viewstack(),this.setEnabled(this.config.enabled)},i.prototype["goto"]=function(t){return this.viewstack["goto"](t)},i.prototype.prev=function(){return this.viewstack.prev()},i.prototype.next=function(){return this.viewstack.next()},i.prototype.first=function(){return this.viewstack.first()},i.prototype.last=function(){return this.viewstack.last()},i.prototype.Step=function(){this.data=null,this.dom=null,this.position=-1},e.register(i,"buttonstep"),i}),define("framework.checkinfo",["framework.core","exports"],function(t,e){function i(t,e){return this.box=t,this.data=e,this.clickCallback=$.noop,this.data=this.data?this.data:[],this.template=$('<div class="checkRender"><input class="checkInfoBox" name="check"><div class="checkInfo"></div><div class="checkValue"></div></div>'),this.clickCallback=$.noop,this.returnData=[],this.state=!0,this.checkType=this.data.checkType?this.data.checkType:null,this.draw(),this}return i.isDom=!0,i.prototype.draw=function(){var t=this;t.box.empty(),"checkbox"==this.checkType||null==this.checkType?(this.template.find("input").attr({type:"checkbox"}),this.template.find(".checkInfoBox").addClass("checkBoxCheck")):"radio"==this.checkType&&(this.template.find("input").attr({type:"radio"}),this.template.find(".checkInfoBox").addClass("checkBoxRadio")),this.data.labelField||(this.data.labelField="label"),this.data.valueField||(this.data.valueField="value"),$(this.data.dataProvider).each(function(e,i){var n=t.template.clone(!0);t.data.disabled&&(n.addClass("disabled"),n.find(".checkInfoBox").attr("disabled","disabled")),n.find(".checkInfo").text(i[t.data.labelField]),n.find(".checkValue").text(i[t.data.valueField]),i.selected&&(n.find(".checkInfoBox").attr("checked",!0),n.addClass("checkInfoSelected")),i.isAlwaysSelected&&(n.find(".checkInfoBox").attr("checked",!0),n.find(".checkInfoBox").attr("readonly","readonly"),n.addClass("disabled"),n.attr("isalways",1),n.addClass("checkInfoSelected")),t.box.append(n)}),this.data.className&&this.box.find(".checkRender").addClass(this.data.className),this.addListener()},i.prototype.select=function(t){var e=this;this.returnData.length=0;var i=$(this.box).find(".checkInfoBox");i.each(function(){var t={label:"",value:""};if($(this).is(":checked")){var i=$(this).next().text(),n=$(this).next().next().text();t.label=i,t.value=n,e.returnData.push(t)}}),t&&t(this.returnData)},i.prototype.addListener=function(){var t=this,e=$(this.box).find(".checkRender");e.click(function(){if($(this).attr("isalways"))return!1;var e=$(this).find(".checkInfoBox");$(this).find(".checkInfo");if(t.data.disabled)return!1;if(0!=t.state){var i={label:"",value:"",status:""};i.label=$(this).find(".checkInfo").text(),i.value=$(this).find(".checkValue").text(),e.prop("checked")?($(this).removeClass("checkInfoSelected"),e.prop({checked:!1}),i.status=!1):($(this).addClass("checkInfoSelected"),e.prop({checked:!0}),i.status=!0),t.clickCallback(i)}})},i.prototype.click=function(t){return this.clickCallback=t,this},i.prototype.setStatus=function(t){this.state=t},i.prototype.setSelect=function(t){var e=$(this.box).find(".checkRender");e.each(function(e,i){$(this).find(".checkValue").text()==t&&($(this).find(".checkInfoBox").prop({checked:!0}),$(this).addClass("checkInfoSelected"))})},i.prototype.add=function(t){this.data.dataProvider=this.data.dataProvider.concat(t),this.draw()},i.prototype.clear=function(){this.data.dataProvider=[],this.draw()},i.prototype.isChecked=function(){var t=!1,e=$(this.box).find(".checkRender");return $(e).each(function(e,i){var n=$(i);n.hasClass("checkInfoSelected")&&(t=!0)}),t},t.register(i,"checkinfo"),this}),define("framework.cidr",["require","exports"],function(t,e){function i(t,e,i,n){if(e=e||[16,28],this.isValidate=!1,this.ip=null,this.isAll=i,this.exclude=n,2!=e.length)return!1;if(this.reg=/^((\d{1,3}\.){3}(\d{1,3}))\/(\d{1,3})$/,!this.reg.test(t))return!1;var s=t.match(this.reg);if(!_.isValidIp(s[1]))return!1;if(s[4]>e[1]||s[4]<e[0])return!1;var o=/^((\d{1,3}\.){2}(\d{1,3}))/;return this.ip=s[1],this.prefix=t.match(o)[0],this.config=t,this.isValidate=!0,this.init(s),this}return i.prototype.init=function(t){this.ip=t[1].split("."),this.start=t[4],this.end=32,this.mask=this.getMask10()},i.prototype.getMask=function(){var t=this.ip2hex2("255.255.255.255").join("").split(""),e=this;$(t).each(function(i){i>=e.start&&i<e.end&&(t[i]=0),i%8==7&&(t[i]=t[i]+".")});var t=t.join("").split(".");return t.length=4,t},i.prototype.getNotMask=function(){var t=_.copyDeepProperty(this.mask);return $(t).each(function(e,i){t[e]=255-i}),t},i.prototype.getBroadAddress=function(){var t=_.copyDeepProperty(this.getNotMask()),e=this.getNetAddress();return $(t).each(function(i,n){t[i]=n+e[i]}),t},i.prototype.getIpRange=function(){var t=this.getNetAddress(),e=this.getBroadAddress();return[t.join("."),e.join(".")]},i.prototype.getIpZone=function(){var t=this.getNetAddress()[3],e=this.getBroadAddress()[3];return this.isAll||(t+=1,e-=1),t==this.exclude&&(t+=1),e==this.exclude&&(e-=1),[t,e]},i.prototype.getMask10=function(){var t=this.getMask(),e=this;return $(t).each(function(i,n){t[i]=e.getHex10(n)}),t},i.prototype.getHex10=function(t){return parseInt(t,2)},i.prototype.pad=function(t,e){for(var i=t.toString().length;e>i;)t="0"+t,i++;return t},i.prototype.ip2hex2=function(t){var e=t.split("."),i=this;return $(e).each(function(t,n){var s=Number(n).toString(2);e[t]=i.pad(s,8)}),e},i.prototype.getNetAddress=function(){var t=[],e=this;return $(this.ip).each(function(i,n){t[i]=n&e.mask[i]}),t},t(["framework.core"],function(t){t.register(i,"Cidr")}),i}),define("framework.cidrWidget",["exports","framework.core"],function(t,e){function i(t,e,i){return this.box=t,this.data=e,this.config=i,this.container=$('<div class="ef-cidr-widget"><span class="1_pos ef-cidr-pos"><input /></span><sub>.</sub><span class="2_pos ef-cidr-pos"><input /></span><sub>.</sub><span class="3_pos ef-cidr-pos"><input /></span><sub>.</sub><span class="4_pos ef-cidr-pos"><input /></span><span>/</span><span class="0_pos ef-cidr-pos"><input/></span></div>'),this.draw(),this}return i.prototype.init=function(){this.isValidate=!1,this.segments=[],this._changeCallback=(this.data&&this.data.onChange?this.data.onChange:null)||$.noop,this.gateData=_.map(_.range(16,29),function(t){return{label:t,value:t}}),this.option={pos1:{width:40,height:30},pos2:{width:40,height:30},pos3:{width:40,height:30},pos4:{width:40,height:30},gate:{width:50,height:30}},_.copy(this.config,this.option)},i.prototype.draw=function(){var t=this;this.init(),this.box.empty(),this.box.append(this.container),this.pos1=this.container.find(".1_pos input").numberbox({width:this.option.pos1.width||40,height:this.option.pos1.height||30,min:0,max:255,value:10,required:!0}),this.pos2=this.container.find(".2_pos input").numberbox({width:this.option.pos2.width||40,height:this.option.pos2.height||30,min:0,max:255,value:0,required:!0}),this.pos3=this.container.find(".3_pos input").numberbox({width:this.option.pos3.width||40,height:this.option.pos3.height||30,min:0,max:255,value:0,required:!0}),this.pos4=this.container.find(".4_pos input").numberbox({width:this.option.pos4.width||40,height:this.option.pos4.height||30,min:0,max:255,value:0,required:!0}),this.geteCount=this.container.find(".0_pos input").combobox({width:this.option.gate.width||50,height:this.option.gate.height||30,valueField:"value",textField:"label",editable:!1,required:!0,data:this.gateData}),this.pos1.next().tooltip({content:_.getLocale("cidr.input.range.tip",0,255)}),this.pos2.next().tooltip({content:_.getLocale("cidr.input.range.tip",0,255)}),this.pos3.next().tooltip({content:_.getLocale("cidr.input.range.tip",0,255),onShow:function(e){var i=t.pos3.numberbox("options").readonly;i&&$(this).tooltip("tip").hide()}}),this.pos4.next().tooltip({content:_.getLocale("cidr.input.range.tip",0,255),onShow:function(e){var i=t.pos4.numberbox("options").readonly;i&&$(this).tooltip("tip").hide()}}),this.geteCount.next().tooltip({content:_.getLocale("cidr.input.range.tip",16,28)}),this.addListener()},i.prototype.addListener=function(){var t=this;this.pos1.numberbox({onChange:function(){t.compute()}}),this.pos2.numberbox({onChange:function(){t.compute()}}),this.pos3.numberbox({onChange:function(){t.compute()}}),this.pos4.numberbox({onChange:function(){t.compute()}}),this.geteCount.combobox({onChange:function(){t.compute(!0)}})},i.prototype.compute=function(t){var i=this.pos1.numberbox("getValue"),n=this.pos2.numberbox("getValue"),s=this.pos3.numberbox("getValue"),o=this.pos4.numberbox("getValue"),a=this.geteCount.combobox("getValue"),r=i+"."+n+"."+s+"."+o+"/"+a,c=new e.Cidr(r,[16,28]);this.isValidate=c.isValidate,this.isValidate&&(this.pos1Value=i,this.pos2Value=n,this.pos3Value=s,this.pos4Value=o,this.gateValue=a,this.segments=this.getIpSegments(i,n,s,o,a),t&&(16==this.gateValue?(this.pos3.numberbox("setValue","0"),this.pos4.numberbox("setValue","0"),this.pos3.numberbox({readonly:!0}),this.pos4.numberbox({readonly:!0})):this.gateValue>16&&this.gateValue<=24?(this.pos3.numberbox({readonly:!1}),this.pos4.numberbox("setValue","0"),this.pos4.numberbox({readonly:!0})):(this.pos3.numberbox({readonly:!1}),this.pos4.numberbox({readonly:!1}))),this._changeCallback())},i.prototype.getIpSegments=function(t,e,i,n,s){var o=[];if(s>=24)return[i];var a=_.radix2(i);a=this.pad(a,8);var r=s-16,c=a.substring(0,r),h=_.radix10(this.append(c,8)),l=_.radix10(this.append(c,8,1));return o=_.range(h,l+1)},i.prototype.pad=function(t,e,i){i=i||"0";for(var n=t.toString().length;e>n;)t=i+t,n++;return t},i.prototype.append=function(t,e,i){i=i||"0";for(var n=t.toString().length;e>n;)t+=i,n++;return t},i.prototype.getCidrBySegement=function(t){return this.pos1Value+"."+this.pos2Value+"."+t+"."+this.pos4Value+"/"+this.gateValue},i.prototype.setGateValue=function(t){this.geteCount.combobox("setValue",t)},i.isDom=!0,e.register(i,"cidrWidget"),i}),define("framework.cidrX",["require","exports"],function(t,e){function i(t){if(this.range=[16,28],this.ip=null,this.isValidate=!1,this.reg=/^((\d{1,3}\.){3}(\d{1,3}))\/(\d{1,3})$/,!this.reg.test(t))return!1;var e=t.match(this.reg);if(!_.isValidIp(e[1]))return!1;if(e[4]>this.range[1]||e[4]<this.range[0])return!1;this.pre_reg=/^((\d{1,3}\.){2}(\d{1,3}))/,this.ip=e[1],this.ips=[],this.gateCount=e[4];t.match(this.pre_reg);this.all_reg=/(\d{1,3})/g;var i=this.ip.match(this.all_reg);return this.pos1=i[0],this.pos2=i[1],this.pos3=i[2],this.pos4=i[3],this.cidr=t,this.segments=[],this.ipSegments=[],this.compute(),this.isValidate=!0,this}return t(["framework.cidr"]),i.prototype.compute=function(){var t=this;this.segments=this.getIpSegments(this.pos1,this.pos2,this.pos3,this.pos4,this.gateCount),this.ipSegments=ef.util.map(this.segments,function(e){return t.spellIp(t.pos1,t.pos2,e,t.pos4)}),this.ips=this.getFullIps()},i.prototype.spellIp=function(){return _.arg2arr(arguments).join(".")},i.prototype.getIpSegments=function(t,e,i,n,s){var o=[];if(s>=24)return[i];var a=_.radix2(i);a=this.pad(a,8);var r=s-16,c=a.substring(0,r),h=_.radix10(this.append(c,8)),l=_.radix10(this.append(c,8,1));return o=_.range(h,l+1)},i.prototype.pad=function(t,e,i){i=i||"0";for(var n=t.toString().length;e>n;)t=i+t,n++;return t},i.prototype.append=function(t,e,i){i=i||"0";for(var n=t.toString().length;e>n;)t+=i,n++;return t},i.prototype.getFullIps=function(){var t=this,e=[];return e=_.map(this.segments,function(e){return t.getIpsBySegment(e)})},i.prototype.getIpsBySegment=function(t){var e=this;if(!this.isInSegment(t))return!1;var i=this.getCidrBySegement(t),n=new ef.Cidr(i),s=n.getIpZone(),o=_.range(s[0],s[1]+1);return _.map(o,function(i){return e.spellIp(e.pos1,e.pos2,t,i)})},i.prototype.isInSegment=function(t){return void 0!=_.find(this.segments,function(e){return e==t})},i.prototype.getCidrBySegement=function(t){return this.isInSegment(t)?this.pos1+"."+this.pos2+"."+t+"."+this.pos3+"/"+this.gateCount:!1},i.prototype.getCidrByIpSeg=function(t){return _.isValidIp(t)?t+"/"+this.gateCount:!1},i.prototype.getFullCidr=function(){var t=this;return _.map(this.ipSegments,function(e){return t.getCidrByIpSeg(e)})},t(["framework.core"],function(t){t.register(i,"CidrX")}),i}),define("framework.cn2uni",["exports","framework.core"],function(t,e){function i(t){return this.box=t,this.container=$('<textarea class="ef-text2Change" cols="30" rows="20" id="text"></textarea>'),this.show=$('<textarea class="ef-text2Change" cols="30" rows="20"></textarea>'),this.copy=$('<button type="button" class="ef-copyAll" id="copyAll"></button>'),this.draw(),this}return i.isDom=!0,i.prototype.cn2unicode=function(t){return _.cn2unicode(t)},i.prototype.unicode2cn=function(t){return _.unicode2cn(t)},i.prototype.draw=function(){var t=this;this.container.attr("placeholder",_.getLocale("framework.component.cn2uni.textarea.text")),this.copy.text(_.getLocale("framework.component.cn2uni.copy.value")),this.box.empty(),this.container.empty(),this.box.append(this.container),this.box.append(this.show),this.box.append(this.copy),this.container.keyup(function(){
for(var e,i,n,s,o,a="",r=$("#text").val(),c=r.split("="),h=0;h<c.length;h++)c[h].match(/\\+/g)?(e=_.unicode2cn(c[h]),a+=e+"="):(i=_.cn2unicode(c[h]),a+=i+"=");n=a.substring(0,a.length-1),s=n.replace(/[\\][2][0]/g," "),s.match(/[\\][0][A]/g)?(o=s.replace(/[\\][0][A]/g,"\n"),t.show.empty().val(o)):t.show.empty().val(s)}),this.copy.click(function(){t.show.select(),document.execCommand("Copy")})},e.register(i,"cn2uni"),i}),define("framework.coor",["exports","framework.core"],function(t,e){function i(t,e){return this.x=0,this.y=0,this.source=e,this.box=$(t),this._img=null,this.width=0,this.height=0,this._isDrag=!1,this._startX=-1,this._startY=-1,this.container=$('<div class="ef-coor-container" unselectable="on"><canvas class="ef-coor-basement"></canvas><canvas class="ef-coor-dash"></canvas><canvas class="ef-coor-hover"></canvas></div>'),this.init(),this.addListener(),this}return i.prototype.addListener=function(){var t=this;this.hoverLayer.mousemove(function(e){var i=t.container.tooltip("tip");i.show(),t._isDrag&&(t.drawRect(e.offsetX-t._startX,e.offsetY-t._startY),t.dash.width=Math.abs(e.offsetX-t._startX),t.dash.height=Math.abs(e.offsetY-t._startY)),i.css({left:e.pageX-i.width()/2,top:e.pageY-80}),i.find(".tooltip-content").html("x: "+(0==e.offsetX?0:-Math.abs(e.offsetX))+" y: "+(0==e.offsetY?0:-Math.abs(e.offsetY))+"<div>w: "+t.dash.width+" h: "+t.dash.height+"</div>")}),this.hoverLayer.mouseout(function(){var e=t.container.tooltip("tip");e.hide(),t._isDrag=!1,t._startX=-1,t._startY=-1}),this.hoverLayer.mousedown(function(e){return t._isDrag=!0,t._startX=e.offsetX,t._startY=e.offsetY,3==e.which?(t.container.smartMenu([[{text:"取消选区",func:function(){t.clear()}},{text:"背景黑色",func:function(){t.container.removeClass("c_black").removeClass("c_white").removeClass("c_transparent"),t.container.addClass("c_black")}},{text:"背景白色",func:function(){t.container.removeClass("c_black").removeClass("c_white").removeClass("c_transparent"),t.container.addClass("c_white")}},{text:"背景透明",func:function(){t.container.removeClass("c_black").removeClass("c_white").removeClass("c_transparent"),t.container.addClass("c_transparent")}}]]),!1):void 0}),this.hoverLayer.mouseup(function(e){t._isDrag=!1,t._startX=-1,t._startY=-1})},i.prototype.drawRect=function(t,e){this.clear(),this.dashContext.strokeStyle="#f27f37",this.dashContext.lineWidth=2,this.dashContext.dashStorkeRect(this._startX,this._startY,t,e,1)},i.prototype.clear=function(){this.dash.x=0,this.dash.y=0,this.dash.width=0,this.dash.height=0,this.dashContext.clearRect(0,0,this.width,this.height)},i.prototype.init=function(){this.dash=new this.Dash;var t=this;if(this.basementLayer=this.container.find(".ef-coor-basement"),this.basementContext=this.basementLayer[0].getContext("2d"),this.hoverLayer=this.container.find(".ef-coor-hover"),this.hoverContext=this.basementLayer[0].getContext("2d"),this.dashLayer=this.container.find(".ef-coor-dash"),this.dashContext=this.dashLayer[0].getContext("2d"),!_.isClass(this.basementContext,CanvasRenderingContext2D))throw new Error(_.getLocale("framework.component.ip.error.no2d.tip"));this.box.empty(),this.box.append(this.container),this.container.tooltip({content:"test",position:"top"}),this._img=new Image,this._img.src=this.source,this._img.onload=function(){t.width=this.width,t.height=this.height,t.resize(),t.render(this),t.addListener()},this._img.onerror=function(){throw new Error(_.getLocale("framework.component.coor.error.img.tip")+"["+this.src+"]")}},i.prototype.resize=function(){this.container.width(this.width),this.container.height(this.height),this.container.find("canvas").attr("width",this.width),this.container.find("canvas").attr("height",this.height)},i.prototype.render=function(t){this.basementContext.drawImage(t,0,0)},i.prototype.Dash=function(){this.x=0,this.y=0,this.width=0,this.height=0},e.register(i,"Coor"),i}),"Easted Framework Define"*function(t){return Object.freeze=Object.freeze||function(t){return t},Object.freeze(t.ef?t.ef:define("framework.core",["user","framework.util","module","exports","signature"],function(e,i,n,s,o){t.ef=this,this.version="20.15.0.1",this.name="ef",this.components={name:"component"},this.formatter={name:"formatter"},this.alert={warning:i.getLocale("global.messager.Warning.tip")},this.fn={name:"functions"},this.code={authFailed:401},this.msg={authFailed:"error.identify.auth.failed",sessionOut:"error.ecloud.dialogue.timeout"},this.logTable=function(t,e,i){return this.config.isDebug&&console.table?(console.info(i?"[获取的本地数据如下]:":"[服务数据如下:]",e),console.table(t)):void 0},this.setting=function(){if(!this.config.isDebug){t.console=t.console||{};for(var e in t.console)t.console[e]=$.noop}},this.i18n={parse:function(t){var e=null;e=t?$(t).find("[i18n]"):$("[i18n]"),e.each(function(){var t=$(this).attr("i18n");if(t){var e=/(.+)=(.+)/,n=t.match(e),s=/=/g,o=t.match(s);if(n&&3==n.length&&o&&1==o.length)return $(this).attr(n[1],i.getLocale(n[2])),void $(this).removeAttr("i18n");$(this).text(i.getLocale(t)),$(this).removeAttr("i18n")}})}},this.util=i,this.server={},this.destroy=function(){require.undef(n.id)},this.getFormatters=function(){var t=[];for(var e in this.formatter)t.push(e);return t},this.getFns=function(){var t=[];for(var e in this.fn)t.push(e);return t},this.init=function(){},this.status={logining:!1,logined:!1},this.config={isServer:!0,webroot:"/",token:"",isTimeout:!1,isDebug:!1},this.inherit=function(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t},this.getJSON=function(t){var n=this;if(t){t.dataType="json",t.cache=!1;var a=(t.type?t.type:"GET").toUpperCase(),r={"Content-Type":"application/json","Ecloud-Token":e.getToken(),"Ecloud-Method":a};if(t.headers=r,t.type="GET"==a?"GET":"POST","DELETE"==a){t.type="GET";var c=t.url,h=/\/$/;c=h.test(c)?c:c,c+=s.util.getValues(t.data).join(""),t.url=c,delete t.data,t.data={}}var l=t.success?t.success:$.noop,d=t.error?t.error:$.noop;return t.success=function(e){if(i.isServer(t))if(e.success&&200==e.code)l(e.result,e),n.config.isDebug&&n.logTable(e.result,t.url);else{if(e.code==s.code.authFailed||e.msg==s.msg.authFailed||e.msg==s.msg.sessionOut)return void o.sessionOut(i.getLocale(e.msg));d(e),t.noPlacard||s.placard.error(i.getLocale(e.msg,e.result||[]))}else l(e),n.logTable(e,t.url,!0)},t.error=function(e){return e&&(e.msg=e.msg||i.getLocale("global.getjson.notfound.tip")+":"+t.url),e.msg==s.msg.sessionOut?void o.sessionOut(i.getLocale(e.msg)):e&&0==e.readyState&&0==e.status&&"error"==e.statusText&&""==e.responseText?void o.sessionOut(i.getLocale("signature.session.abort.message")):(d(arguments),void(i.isServer(t)&&(!t.noPlacard,e&&s.placard.error(i.getLocale(e.msg)),"overtime"==e.msg&&s.placard.warn(i.getLocale("global.getjson.overtime.tip")+":"+t.url))))},t.isUpload?$.ajaxFileUpload(t):(t.data="GET"==t.type?t.data:JSON.stringify(t.data),$.ajax(t))}},this._register=function(t,e,i,n,o,a,r){if(r)return void(n?s[r][t]=e:s[r][t]=new e);if(o)return void(o[t]=a);if(n)return void(s[t]=e);s.components[t]=e;var c={};c[t]=function(){return arguments.length>1?new e(this,arguments[0],arguments[1],arguments[2],arguments[3]):new e(this,arguments[0])},i?s[t]=new e:$.fn.extend(c)};var a=function(){};return a.prototype.put=function(e,i){this._init();var n=this.get();if(n){n[e]=i;var s=JSON.stringify(n);t.name=s}},a.prototype.get=function(e){var i=t.name;if(i){try{i=JSON.parse(i)}catch(n){return}return arguments.length&&(i=i[e]),i}},a.prototype._init=function(){var e=t.name;if(!e||"undefined"==e){var i={},n=JSON.stringify(i);t.name=n}},a.prototype.clear=function(){t.name=""},function(e){$.ajaxSetup({timeout:999999}),$.getJSON=function(t,e,i,n){if(!(arguments.length>2))return $.get(t,e,i,"json");switch(arguments.length){case 3:return $.isFunction(e)&&$.isFunction(i)?$.ajax({dataType:"json",type:"GET",url:t,success:e,error:i,timeout:90}):$.get(t,e,i,"json");case 4:return $.isFunction(i)&&$.isFunction(n)?$.ajax({dataType:"json",type:"GET",url:t,data:e,success:i,error:n,timeout:90}):$.get(t,e,i,"json");default:return $.get(t,e,i,"json")}},e.root=e.root?e.root:t,e.root.CanvasRenderingContext2D=e.root.CanvasRenderingContext2D?e.root.CanvasRenderingContext2D:$.noop,e.root.console=e.root.console?e.root.console:{log:$.noop,warn:$.noop,debug:$.noop,info:$.noop,error:$.noop,assert:$.noop,clear:$.noop,count:$.noop,dir:$.noop,dirxml:$.noop,group:$.noop,groupCollapsed:$.noop,groupEnd:$.noop,profile:$.noop,profileEnd:$.noop,table:$.noop,time:$.noop,timeEnd:$.noop,timeStamp:$.noop,trace:$.noop},CanvasRenderingContext2D.prototype.roundRect=function(t,e,i,n,s,o,a){"undefined"==typeof a&&(a=!0),"undefined"==typeof s&&(s=5),this.beginPath(),this.moveTo(t+s,e),this.lineTo(t+i-s,e),this.quadraticCurveTo(t+i,e,t+i,e+s),this.lineTo(t+i,e+n-s),this.quadraticCurveTo(t+i,e+n,t+i-s,e+n),this.lineTo(t+s,e+n),this.quadraticCurveTo(t,e+n,t,e+n-s),this.lineTo(t,e+s),this.quadraticCurveTo(t,e,t+s,e),this.closePath(),a&&this.stroke(),o&&this.fill()},CanvasRenderingContext2D.prototype.dashedLineTo=function(t,e,i,n,s){"undefined"==typeof s&&(s=5);var o=i-t,a=n-e,r=Math.floor(Math.sqrt(o*o+a*a)),c=0>=s?r:r/s,h=a/r*s,l=o/r*s;this.beginPath();for(var d=0;c>d;d++)d%2?this.lineTo(t+d*l,e+d*h):this.moveTo(t+d*l,e+d*h);this.stroke()},CanvasRenderingContext2D.prototype.dashStorkeRect=function(t,e,i,n,s,o){this.dashedLineTo(t,e,t+i,e,s),this.dashedLineTo(t+i,e,t+i,e+n,s),this.dashedLineTo(t+i,e+n,t,e+n,s),this.dashedLineTo(t,e+n,t,e,s),o&&this.fillRect(t,e,i,n)},CanvasRenderingContext2D.prototype.circle=function(t,e,i,n){this.beginPath(),this.arc(t,e,i,0,2*Math.PI,!0),this.stroke(),n&&this.fill(),this.closePath()},CanvasRenderingContext2D.prototype.cross=function(t,e,i,n){this.beginPath(),this.save();var s=t+i,o=e,a=t,r=e+i,c=t-i,h=e,l=t,d=e-i;this.moveTo(t,e),this.lineTo(s,o),this.moveTo(t,e),n||(this.lineTo(a,r),this.moveTo(t,e)),this.lineTo(c,h),this.moveTo(t,e),n||(this.lineTo(l,d),this.moveTo(t,e)),this.closePath(),this.stroke()},$.extend($.fn.validatebox.defaults.rules,{minlength:{validator:function(t,e){return t.length>=e[0]},message:e.util.getLocale("framework.validate.minlength.message")}}),$.extend($.fn.validatebox.defaults.rules,{whitelist:{validator:function(t,e){var i=new RegExp("["+e[0]+"]","g"),n=t.match(i);return n&&n.length==String(t).length},message:e.util.getLocale("framework.validate.whitelist.message")}}),$.extend($.fn.validatebox.defaults.rules,{blacklist:{validator:function(t,e){var i=new RegExp("["+e[0]+"]","g");return!i.test(t)},message:e.util.getLocale("framework.validate.blacklist.message")}}),$.extend($.fn.validatebox.defaults.rules,{reg:{validator:function(t,e){var i=e[0];return i.test(t)},message:e.util.getLocale("framework.validate.reg.message")}}),$.extend($.fn.validatebox.defaults.rules,{regx:{validator:function(t,e){var i=e[0];return i.test(t)},message:e.util.getLocale("framework.validate.regx.message")}}),e._register(e.name,null,null,!1,e.root,e),e.completeDeffers=[],e.easyui={},e.easyui.ready=function(t){return t&&i.isFunction(t)?void e.completeDeffers.push(t):!1},$(t).on("easyui.complete",function(t,i,n){n=n||".right-entity",i==n&&$(e.completeDeffers).each(function(t,e){e()})})}(this),Function.prototype.extend=function(t){},this.extend=function(t,e){if(t){var i=[t.registerName||t.name,t["class"]||t];return e?i.push(!1,!t.isInstance,!1,!1,e):(!t.isDom&&t.isInstance?i.push(!0):null,t.isDom||t.isInstance?null:i=i.concat([!0,!0])),this._register.apply(this,i)}},this.rewrite=function(t,e){if(t)for(var i in e)t[i]=function(t){return(new e[i]).show(t)}},this.inherit=function(t){t.toString=function(){return"[Class "+t.name+"]"}},this.register=function(t,e,n){t&&(t.name=t.name||i.getFunctionName(t),this.inherit(t),t.registerName=e||(t.isDom||t.isInstance?t.name.toLowerCase():t.name),this.extend(t,n))},$.ajaxSetup({timeout:999999}),this}))}(window),define("framework.coverlayer",["exports","framework.core","framework.preload"],function(t,e,i){function n(t,e,i){return this.box=t,this.data=e||{},this.init(),this.setConfig(i),this.render(),this}return n.isDom=!0,n.prototype.init=function(){this.config={name:2},this.width=0,this.height=0,this.container=$('<div class="ef-coverlayer"><div class="ef-coverlayer-inn"><div class="ef-coverlayer-bg"></div><div class="ef-coverlayer-cont"><div class="ef-coverlayer-load" style="width: 100%;height:100%"></div></div></div></div>'),this.loadCallback=$.noop,this.errorCallback=$.noop,this.preload=null},n.prototype.setConfig=function(t){this.config=_.copy(this.config,t)},n.prototype.render=function(){var t=this.box.find(".ef-coverlayer");this.config.opaque&&this.container.find(".ef-coverlayer-bg").addClass("opaque"),this.config.transparent&&this.container.find(".ef-coverlayer-bg").css({background:"transparent"}),this.preload=new i(this.container.find(".ef-coverlayer-load"),this.data.loadingHeight),t.length&&t.remove(),this.box.css({position:"relative","min-height":"36px"}),this.box.append(this.container),this.data.contentURL?this._load():(this.data.content&&this.container.find(".ef-coverlayer-cont").empty(),this.data.content?this.container.find(".ef-coverlayer-cont").append(this.data.content):null),this.width=this.data.width||this.width,this.height=this.data.height||this.height,this.width&&this.container.width(this.width),this.height&&this.container.height(this.height),this.width=this.width||this.container.width(),this.height=this.height||this.container.height(),this.data.contentURL||this.loadCallback(),this.data.contentClass&&this.container.find(".ef-coverlayer-cont").addClass(this.data.contentClass)},n.prototype._load=function(){var t=this;this.container.find(".ef-coverlayer-cont").load(this.data.contentURL,function(e,i){"success"==i?(t.preload.hide(),t.loadCallback()):($(this).text(_.getLocale("global.load.error.tip")),t.errorCallback()),$(this).removeAttr("style")})},n.prototype.onLoad=function(t){return this.loadCallback=t,this},n.prototype.onError=function(t){return this.errorCallback=t,this},n.prototype.show=function(){return this.container.show("fast"),this},n.prototype.hide=function(){return this.container.hide("fast"),this},e.register(n,"coverlayer"),n}),define("framework.dataCenter",["exports","framework.core"],function(t,e){var i={textField:"",valueField:"",originalDatas:null,currentData:null,onSelect:$.noop},n=function(t,e,n){if(!n.textField||!n.valueField)throw new Error("��������ȷ������!");this.config=$.extend({},i,n),this.config.originalDatas=_.clone(e),this.dataItem=$('<div class="data-center-item"></div>'),this.dataEsay=$('<div class="data-center-es"><input type="text" class="data-center-interface" style="width: 193px; height: 46px"/></div>'),this.dataInner=$('<div class="data-center-inner" style="display: none;"></div>'),this.box=t,this.box.empty(),this.box.append(this.dataEsay),this.box.append(this.dataInner),this.menus=[],this.renderPage(),this.addListener()};return n.prototype.Menu=function(t){this.data=null,this.dom=null,this.disable=!1,this.owner=t,this.tip=null,this.toggle=null},n.prototype.renderPage=function(){var t=this,e=[];this.box.find(".data-center-interface").textbox({iconCls:"combo-arrow",iconAlign:"right",editable:!1,disabled:!0}),$(this.config.originalDatas).each(function(i,n){var s=new t.Menu(t),o=t.dataItem.clone(!1);o.attr({id:"data-center-"+(i+1)}),o.text(n[t.config.textField]),s.data=n,s.dom=o,t.menus.push(s),n.selected&&(o.addClass("data-center-selected"),t.setSelected(n)),e.push(o)}),this.dataInner.append(e)},n.prototype.setSelected=function(t){var e=this;this.box.find(".data-center-interface").textbox("setText",t[this.config.textField]),this.config.currentData&&$(this.config.originalDatas).each(function(t,e){e.selected=!1});var i=_.findIndex(this.config.originalDatas,function(i){return i[e.config.textField]==t[e.config.textField]});i&&(t.selected=!0,e.config.originalDatas[i].selected=!0,e.config.currentData=t)},n.prototype.addListener=function(){var t=this;this.box.hover(function(){var t=$(this);t.find(".data-center-inner").show()},function(){var t=$(this);t.find(".data-center-inner").hide()}),this.box.find(".data-center-item").hover(function(){var t=$(this);t.addClass("data-center-hover")},function(){var t=$(this);t.removeClass("data-center-hover")}),this.box.find(".data-center-item").on("click.data.center",function(){var e=$(this);e.addClass("data-center-selected").siblings().removeClass("data-center-selected");var i=_.find(t.menus,function(t){return $(t.dom).attr("id")==e.attr("id")});i&&(t.setSelected(i.data),t.box.find(".data-center-inner").hide(),t.config.onSelect(i))})},n.prototype.getValue=function(){var t=this.box.find(".data-center-interface").textbox("getText");if(t){var e=_.find(this.config.originalDatas,function(e,i){return t==i[this.config.textField]});return e?e[this.config.valueField]:""}return""},n.prototype.destroy=function(){},n.isDom=!0,e.register(n,"dataCenter"),n}),define("framework.dataScroll",["exports","framework.core"],function(t,e){function i(t,e,i){if(!$.isArray(e))throw new Error("data must be array!");this.config=$.extend({},n,i),this.config.originalRows=_.clone(e),this.config.total=Math.ceil(e.length/this.config.pageSize)||0,this.box=t,this.appWrapper=$('<div class="clearfix app-wrapper"></div>'),this.ctr=$('<div class="ctr"><a class="ctr-item left-ctr" href="#" title data-type="0"></a><a class="ctr-item right-ctr" href="#" title data-type="1"></a></div>'),this.appBlock=$('<div class="appblock"></div>'),this.icons=$('<div class="app-utils" style="display: none;"></div>'),this.box.empty(),this.box.append(this.appWrapper),this.box.append(this.ctr),this.addCtrListener(),this.template()}var n={total:0,pageNum:1,pageSize:6,originalRows:[],rows:[]};return i.prototype.template=function(){this.loadData(),this.renderPage(),this.addListener(),this.checkState(this.config.pageNum)},i.isDom=!0,i.prototype.Menu=function(t){this.data=null,this.dom=null,this.disable=!1,this.owner=t,this.tip=null,this.toggle=null},i.prototype.loadData=function(){var t=this.config,e=t.pageNum,i=t.pageSize,n=t.originalRows,s=(e-1)*i,o=s+i;this.config.rows=n.slice(s,o)},i.prototype.renderPage=function(){console.log("render page-----");var t=this,e=null,i=null;this.box.find(".app-wrapper").empty(),$(this.config.rows).each(function(n,s){new t.Menu(t);e=t.appBlock.clone(!1),s.nodeClass&&e.addClass(s.nodeClass),s.text&&e.html(s.text),t.appWrapper.append(e),s.icons&&(i=t.icons.clone(!1),e.append(i),i.iconmenu(s.icons))})},i.prototype.addListener=function(){this.box.find(".appblock").hover(function(){var t=$(this);t.find(".app-utils").show()},function(){var t=$(this);t.find(".app-utils").hide()})},i.prototype.addCtrListener=function(){var t=this;this.box.find(".ctr-item").on("click.appDataScroll",function(){var e=$(this);if(0==e.attr("data-type"))--t.config.pageNum;else{if(1!=e.attr("data-type"))return;++t.config.pageNum}t.template()})},i.prototype.checkState=function(t){var e=this.config,i=e.total;e.pageSize;1>=t?this.box.find('[data-type="0"]').hide():this.box.find('[data-type="0"]').show(),t>=i?this.box.find('[data-type="1"]').hide():this.box.find('[data-type="1"]').show()},i.prototype.setSize=function(){},e.register(i,"dataScroll"),i}),define("framework.dialog",["exports","framework.core"],function(t,e){function i(t,e){return this.id=t,this.param=e||{},this.dom=$("<div></div>"),this.noHeader=!1,this.init(),this}return i._dialogs={},i._register=function(t,e){return this._dialogs[t]=e,e},i.getDialog=function(t){return this._dialogs.hasOwnProperty(t)?this._dialogs[t]:void 0},i.getAll=function(){return this._dialogs},i.closeAll=function(){for(var t in this._dialogs){var e=this._dialogs[t];e.close()}},i._deleteDialog=function(t){delete this._dialogs[t]},i.close=function(t){var e=this.getDialog(t);return e&&(e.close(),$(document.body).scrollTop(0),$(".tooltip").hide()),Boolean(e)},i.prototype._onClose=function(t){if(t){var e=this.dialog.next(".window-shadow"),n=e.next(".window-mask");e.remove(),n.remove();try{t.remove()}catch(s){}}this.dialog&&($(window).off("keydown."+this.id,this.keydown),this.dom.off(),$("html").removeClass("auto"),this.dom.remove(),this.dialog.remove(),this.closeCallback(),i._deleteDialog(this.id))},i.prototype._onLoad=function(t){this.loadCallback()},i.prototype.keydown=function(t){if(27==t.keyCode){var e=t.data.id;i.close(e)}},i.prototype.init=function(){function t(){try{n.dom.dialog("options")}catch(t){return}var e=$(this).width(),i=$(this).height(),s=n.dom.parent().width(),o=n.dom.parent().height(),r=(e-s)/2,c=(i-o)/2;$("html").addClass("auto"),r=10>r?10:r,c=10>c?10:c,a.dialog("move",{top:c,left:r})}this.isExpand=Boolean(this.param.isExpand),this.expandWidth=this.param.expandWidth||0,$(".tooltip").hide(),i._register(this.id,this),this.param.modal=!0,this.param.draggable=!1;var n=this;this.closeCallback=this.param.onClose?this.param.onClose:$.noop,this.loadCallback=this.param.onLoad?this.param.onLoad:$.noop,this.param.onClose=function(){var t=this;n._onClose(t)},this.param.onLoad=function(){var t=this;n._onLoad(t)};var s=e.root.top||e.root,o=$(s.document.body);if(o.find("#"+this.id).length)throw new Error(_.getLocale("framework.dialog.id.error,重复的dialogId，请重新命名唯一性"));this.dom.attr("id",this.id),o.append(this.dom),this.dom.hide(),this.dom.fadeIn("fast"),this.param.width=this.param.width+(this.isExpand?this.expandWidth:-this.expandWidth),this.dom.dialog(this.param),this.dialog=this.dom.dialog("dialog"),this.dialog.addClass("ef-dailog"),this.noHeader=this.param.noHeader,this.noHeader&&this.dialog.addClass("no-header");var a=this.dom;$(window).on("keydown."+this.id,{id:this.id},this.keydown),$(document.body).resize(t),$(window).resize(t),t()},i.prototype.toResize=function(){var t=this,e=this.dom;try{t.dom.dialog("options")}catch(i){return}var n=e.width()+(this.isExpand?this.expandWidth:-this.expandWidth),s=t.dom.parent().find(">.panel-header"),o=t.dom.parent().find(">.panel-body");t.dom.parent().width(n),t.dom.parent().next(".window-shadow").width(n),s.width(n),o.width(n),$(window).resize()},i.prototype.toggle=function(){this.isExpand=!this.isExpand,this.toResize()},i.prototype.setTitle=function(t){this.dom.dialog("setTitle",t)},i.prototype.close=function(){this.dom.dialog("close")},e.register(i,"Dialog"),i}),define("framework.download",["exports","framework.core"],function(t,e){function i(t){return this.dom=$('<div class="___download_box___"><iframe width="0" height="0" frameborder="0" scrolling="no"></iframe></div>'),this.start(t),this}return i.prototype._init=function(){var t=$(e.root.document.body).find(".___download_box___");t.remove();var i=_.url(this.url);this.dom.find("iframe").removeAttr("src"),this.dom.find("iframe").attr("src",i),$(e.root.document.body).append(this.dom)},i.prototype.start=function(t){this.url=t,this.url&&this._init()},e.register(i,"Download"),i}),define("framework.event",["exports","framework.core"],function(t,e){function i(){this._dom=$(window)}return i.isInstance=!0,i.prototype.trigger=function(t,e){this._dom.trigger(t,e)},i.prototype.on=function(t,e){this._dom.on(t,e)},i.prototype.off=function(t){return arguments.length?void this._dom.off(t):void this._dom.off()},e.register(i,"event"),i}),define("framework.iconchange",["framework.core","exports"],function(t,e){function i(t,e,i,n){return this.box=t,this.data=e,this.len=i,this.hei=n,this.steps=[],this.current=0,this.isClick=!1,this.clickCallback=$.noop,this.data=this.data?this.data:[],this.container=$('<ul class="icon-change"></ul>'),this.contentAll='<div class="iconAllRender"></div><ul class="iconChangeAll"></ul>',this.templateAll=$('<li><div class="iconChangeAll-pic"><i></i></div><p class="iconChangeAll-text"></p></li>'),this.template=$('<li><div class="bg"></div><div class="iconChangeCon"><span class="icon-change-text-lateral"></span><span class="icon-change-text"></span><p class="icon-change-icon"><i></i></p></div></li>'),this.draw(),this}return i.isDom=!0,i.prototype.resize=function(){var t=(Number($(document.body).width())-Number(this.len))/2+2;$(".iconChangeAll").css({width:this.len}).css({left:t+"px"});var e=(Number(this.len)-140)/this.data.length;$(".iconChangeAll li").css({width:e}).eq(0).css({"margin-left":"70px"});var i=this.box.offset().top,n=i+(this.box.height()-$(this.contentAll).height()/2)/2-82;$(".iconChangeAll").css({top:n})},i.prototype.draw=function(){var t=this;this.box.empty(),this.container.empty(),this.box.append(this.container),$(document.body).append(this.contentAll),$(this.data).each(function(e,i){var n=t.template.clone(!0),s=t.templateAll.clone(!0);if($(".icon-change").append(n),$(".icon-change i").eq(e).addClass(i.iconClass),$(".iconChangeAll").append(s),$(".iconChangeAll li").eq(e).attr({index:e}),$(".iconChangeAll i").eq(e).addClass(i.iconAllClass),-1!=i.text.indexOf("[")){var o=i.text.indexOf("["),a=i.text.indexOf("]"),r=i.text.substring(o+1,a),c=i.text.substring(a+1,i.text.length);return $(".iconChangeAll p").eq(e).text(r+c),$(".icon-change .icon-change-text-lateral").eq(e).text(r),void $(".icon-change .icon-change-text").eq(e).text(c)}$(".icon-change .icon-change-text").eq(e).text(i.text),$(".iconChangeAll p").eq(e).text(i.text)}),$(".icon-change li").eq(this.current).show(),$(window).resize(function(){t.resize()}),this.resize()},i.prototype["goto"]=function(t){return isNaN(t)||t>this.data.length||0>t?!1:(this.current=t,$(".icon-change li").eq(this.current).show().siblings().hide(),$(this.data).each(function(e,i){var n=$(".iconChangeAll li").eq(e).attr("index");t>=n?($(".iconChangeAll li").eq(e).find("i").removeClass(i.iconAllClass).addClass(i.iconSelectedClass),$(".iconChangeAll li").eq(e).addClass("icon_change_useable")):($(".iconChangeAll li").eq(e).find("i").removeClass(i.iconSelectedClass).addClass(i.iconAllClass),$(".iconChangeAll li").eq(e).removeClass("icon_change_useable"))}),!0)},i.prototype.first=function(){return this["goto"](0)},i.prototype.last=function(){return this["goto"](this.data.length-1)},i.prototype.prev=function(){return this["goto"](this.current-1)},i.prototype.next=function(){return this["goto"](this.current+1)},i.prototype.click=function(t){var e=this;$(".iconChangeCon").hover(function(){$(".iconChangeAll").show(),$(".iconAllRender").show()}),$(".iconChangeAll li").click(function(){var i=Number($(this).attr("index"));e.current==i&&($(this).parent().hide(),$(".iconAllRender").hide()),e.current>i&&(e.current=i,e["goto"](e.current),$(this).parent().hide(),$(".iconAllRender").hide()),t&&t(e.current)}),$(".iconChangeAll").hover(function(){},function(){$(".iconChangeAll").hide(),$(".iconAllRender").hide()})},i.prototype.destroy=function(){$(".iconChangeAll").remove(),$(".iconAllRender").remove(),this.box.remove()},t.register(i,"iconchange"),this}),define("framework.iconmenu",["require","exports","framework.core","user"],function(t,e,i,n){function s(t,e,i){return this.box=t,this.data=e,this.container=$('<ul class="icon-menus"></ul>'),this.item=$('<li class="hide"><img  class="hide"/><i class="icon-menus-icon"></i></li>'),this.text=$('<span class="icons-menus-text"><i data-class class="icons-menus-i"></i></span>'),this.menus=[],this.isSlow=!i,this.isNoRightAll=!1,this.roleType=n.getRole().value,this["super"]=n.isSuper(),this.data&&this.data.length?(this.init(),this.addListener(),this):void 0}return t(["framework.togglebutton"]),s.isDom=!0,s.prototype.init=function(){this.menus=[],this.box.empty(),this.isSlow||this.container.addClass("transparent"),this.box.append(this.container),this.draw()},s.prototype.draw=function(){var t=this,e=0;$(this.data).each(function(i,n){if(n.access){var s=_.noRight(t.roleType,n.access,t["super"]);if(s)return}e++;var o=new t.Menu(t),a=t.item.clone(!1);if(o.data=n,o.dom=a,t.container.append(a),n.isToggle)a.empty(),o=a.togglebutton(n.data,!0),o.toggle=!0;else{if(n.iconClass)if(a.find("img").remove(),n.text){a.find("i").remove();var r=t.text.clone(!1).addClass(n.iconClass).find("i").attr("data-class",n.text).end();a.append(r)}else a.find("i").addClass(n.iconClass);else{var c=a.find("img");c.show("fast"),c.attr("src",n.icon),a.find("i").remove()}n.position&&a.css({left:n.position.x,top:n.position.y});a.tooltip({content:n.tip});n.click&&a.click(function(){n.disable||n.click(o)}),a.fadeTo(.7),a.hover(function(){return n.disable?void $(this).tooltip("hide"):void $(this).fadeTo("fast",1)},function(){n.disable||$(this).fadeTo("fast",.7)}),t.setDisable(o,n.disable),t.isSlow&&(a.hide(),a.animate({height:"toggle",opacity:"toggle"},"slow"))}t.menus.push(o)}),this.isNoRightAll=!e},s.prototype.Menu=function(t){this.data=null,this.dom=null,this.disable=!1,this.owner=t,this.tip=null,this.toggle=null},s.prototype.addListener=function(){$(this.menus).each(function(t,e){e.toggle||($(e.dom).hover(function(){e.tip||(e.tip=e.dom.tooltip("tip"))}),$(e.dom).mouseout(function(){try{var t=$(this).tooltip("tip");t.hide()}catch(e){}}),$(e.dom).click(function(){return e.disable?!1:void(e.tip&&e.tip.hide())}))})},s.prototype.setStatus=function(t,e){var i=this;$(this.menus).each(function(n,s){s.data.id==t&&i.setDisable(s,e)})},s.prototype.setDisable=function(t,e){t.data.disable=Boolean(e),t.disable=t.data.disable,t.dom.css({display:"inline-block"}),t.data.disable?t.dom.addClass("icon-disable"):t.dom.removeClass("icon-disable"),t.data.disable?t.dom.fadeTo(0,.2):t.dom.fadeTo(0,.7)},i.register(s,"iconmenu"),s}),define("framework.iconstep",["exports","framework.core"],function(t,e){function i(t,e){return this.box=t,this.data=e,this.steps=[],this.current=0,this.isClick=!1,this.clickCallback=$.noop,this.data=this.data?this.data:[],this.container=$('<ul class="icon-step icon-step-svm"></ul>'),this.template=$('<li><div class="bg"></div><div class="conter"><p class="icon-step-text icon-step-text-svm"></p><p class="icon-step-icon icon-step-icon-svm"><img class="hide"><i></p></div></li>'),this.draw(),this}return i.isDom=!0,i.prototype.draw=function(){var t=this;this.box.empty(),this.container.empty(),this.box.append(this.container),$(this.data).each(function(e,i){var n=new t.Step,s=t.template.clone(!0);n.dom=s,n.data=i,n.position=e,n.isIcon=i.icon_up&&i.icon_selected,s.find(".icon-step-text").text(i.text),n.isIcon?(s.find(".icon-step-icon img").show(),s.find(".icon-step-icon img").attr("src",n.data.selected?n.data.icon_selected:n.data.icon_up)):s.find("i").addClass(n.data.selected?i.iconSelectedClass:i.iconClass),t.steps.push(n),n.data.selected&&t["goto"](e),s.click(function(){t._hasClickRight(e)&&(t.clickCallback(n.position),t["goto"](n.position,!0))}),e||s.addClass("icon-step-first"),e==t.data.length-1&&s.addClass("icon-step-end"),e&&e!=t.data.length-1&&s.addClass("icon-step-svm-middles"),t.container.append(s)})},i.prototype.change=function(t){return t?(this.changeCallback=t,this):void 0},i.prototype.click=function(t){return t?(this.clickCallback=t,this):void 0},i.prototype["goto"]=function(t,e){if(isNaN(t)||t>this.data.length||0>t)return!1;this.current=t;var i=this;return $(this.steps).each(function(e,n){n.data.selected=n.position==t,n.data.selected?(n.dom.addClass("current"),i.changeCallback&&i.changeCallback(n)):n.dom.removeClass("current"),n.position<=t?(n.dom.addClass("selected"),n.isIcon?n.dom.find(".icon-step-icon img").attr("src",n.data.icon_selected):(n.dom.find("i").removeClass(n.data.iconClass),n.dom.find("i").addClass(n.data.iconSelectedClass))):(n.data.selected=!1,n.dom.removeClass("selected"),n.isIcon?n.dom.find(".icon-step-icon img").attr("src",n.data.icon_up):(n.dom.find("i").removeClass(n.data.iconSelectedClass),n.dom.find("i").addClass(n.data.iconClass)))}),this._setAfterUnClick(t),!0},i.prototype.prev=function(){return this["goto"](this.current-1)},i.prototype.next=function(){return this["goto"](this.current+1)},i.prototype.first=function(){return this["goto"](0)},i.prototype.last=function(){return this["goto"](this.data.length-1)},i.prototype.Step=function(){this.data=null,this.dom=null,this.position=-1,this.isIcon=!1,this.clicked=!1},i.prototype.setClicked=function(t,e){$(this.steps).each(function(i,n){i==t&&(n.clicked=e)})},i.prototype._setAfterUnClick=function(t){$(this.steps).each(function(e,i){e>t&&(i.clicked=!1);
})},i.prototype._hasClickRight=function(t){return t<=this.current},i.prototype.isAllClicked=function(){var t=0;return $(this.steps).each(function(e,i){i.clicked&&t++}),t==this.steps.length},e.register(i,"iconstep"),i}),define("framework.incrementNum",["exports","framework.core","framework.timer"],function(t,e,i){function n(t,e){return this.box=t,this.oldValue=0,this.newValue=0,this.data=e,this.speed=10,this.delay=50,this.isPlaying=!1,this.total=null,this.totalTimer=null,this.timer=null,this.play(),this}return n.isDom=!0,n.prototype.init=function(){this.box.addClass("increment-num"),this.data&&(this.oldValue=this.data.oldValue?this.data.oldValue:0,this.newValue=this.data.newValue?this.data.newValue:0,this.speed=this.data.speed?this.data.speed:this.speed,this.total=this.data.total?this.data.total:null)},n.prototype.play=function(t,e){if(!this.isPlaying){this.isPlaying=!0,this.timer&&this.timer.destory(),this.totalTimer&&(this.totalTimer.destory(),this.totalTimer=null);var n=this;t&&(_.copyProperty(this.data,t),void 0==t.oldValue&&(this.oldValue=this.data.oldValue=Number(this.box.find(".num").text()))),this.init(),this.total?(n.step=Math.ceil((n.newValue-n.oldValue)/n.delay),0!=n.step&&(this.totalTimer=new i(n.total,function(){n.totalTimer.destory(),n.totalTimer=null}),this.totalTimer.start()),this.timer=new i(n.delay,function(){var t=Math.ceil((n.newValue-n.oldValue)/n.delay);n.oldValue+=n.step,(null==n.totalTimer||null!=n.totalTimer&&0==t)&&(n.oldValue=n.newValue,n.timer.destory(),n.isPlaying=!1),n.draw()},null,!0),this.timer.start()):(this.timer=new i(this.delay,function(){var t=Math.ceil((n.newValue-n.oldValue)/n.speed),e=Math.ceil((n.newValue-n.oldValue)/n.speed);n.oldValue+=e,0==t&&(n.oldValue=n.newValue,n.timer.destory(),n.isPlaying=!1),n.draw()},null,!0),this.timer.start())}},n.prototype.draw=function(){this.box.find(".num").length||this.box.append('<span class="num" style="vertical-align: middle;display: inline-block"></span>'),this.box.find(".num").text(this.oldValue)},e.register(n,"incrementNum"),n}),define("framework.interface",["exports","framework.core"],function(t,e){function i(){if(this.name="interface",this.startCode=101,this.endCode=102,!arguments.length||2!=arguments.length||arguments[1].charCodeAt(0)!=this.startCode&&arguments[1].charCodeAt(1)!=this.endCode)throw new Error(this.constructor.error)}return i.error="Please use [Interface.implment()] to implement!",i.implement=function(){return new i("interface",e.name)},i.prototype.init=function(){},i.prototype.redraw=function(){throw new Error("This function must be implement!")},i.prototype.destroy=function(){throw new Error("This function must be implement!")},e.register(i,"Interface"),i}),define("framework.ip",["exports","framework.core"],function(t,e){function i(t,e,i){return this.box=t,this.legend=$('<ul class="ip-legend"><li class="square_unselect"><span class="legend_square ip_square_unselect"></span><span class="legend_text"></span><p class="legend_count_p"><span>(</span><span class="legend_count"></span><span>)</span></p></li><li class="square_selected"><span class="legend_square ip_square_selected"></span><span class="legend_text"></span><p class="legend_count_p"><span>(</span><span class="legend_count"></span><span>)</span></p></li><li class="square_occupy_host"><span class="legend_square ip_square_occupy_host"></span><span class="legend_text"></span><p class="legend_count_p"><span>(</span><span class="legend_count"></span><span>)</span></p></li><li class="square_occupy"><span class="legend_square ip_square_occupy"></span><span class="legend_text"></span><p class="legend_count_p"><span>(</span><span class="legend_count"></span><span>)</span></p></li><li class="square_dhcp_edit"><span class="legend_square ip_square_dhcp_set"></span><span class="legend_text"></span><p class="legend_count_p"><span>(</span><span class="legend_count"></span><span>)</span></p></li><li class="square_dhcp"><span class="legend_square ip_square_gateway_legend"></span><span class="legend_text legend_text_gateway"></span><p class="legend_count_p"><span>(</span><span class="legend_count"></span><span>)</span></p></li></ul>'),this.container=$('<div class="ip"></div>'),this.square=$('<span class="ip_square"></span>'),this.tip=$('<a class="easyui-tooltip"></a>'),this.config=i||{isHideLengend:!1},this.data=e,this.start=0,this.end=0,this.range=[],this.select=[],this.isHideLengend=this.config.isHideLengend,this.isEdit=!1,this.hasDhcp=!1,this.isEditDhcp=!1,this.squares=[],this.isMoving=!1,this.isSep=!1,this.startNum=-1,this.endNum=-1,this.hasNetgate=!1,this.init(),this.draw(),this.addListener(),this}return i.isDom=!0,i.prototype.init=function(){this.start=0,this.end=0,this.range=[],this.select=[],this.squares=[],this.hasDhcp=!1,this.isDrag=!1,this.hasNetgate=!1,this.startX=-1,this.startY=-1,this.lastX=-1,this.lastY=-1,this.changeCallback=$.noop,this.isFilter=Boolean(this.data.isFilter),_.copyProperty(this,this.config),this.cidr=_.getCidr(this.data.cidr,this.data.isAll,this.data.exclude),this.data.cidr=this.cidr.getIpZone()},i.prototype.getDragSquares=function(){},i.prototype.getSquareByPosition=function(t,i,n){return n&&(this.config.isSep?(console.log("sepxxx"),t-=$(".right-entity").scrollLeft(),i-=$(".right-entity").scrollTop()):(t=this.isMoving?t-this.box.scrollLeft():t+this.box.scrollLeft(),i=this.isMoving?i-this.box.scrollTop():i+this.box.scrollTop())),e.util.find(this.squares,function(e){var n=e.offset().left-5,s=e.offset().top-5,o=n+e.width()+10,a=s+e.height()+10;return t>n&&i>s&&o>t&&a>i?!0:t==n&&i>=s&&a>=i?!0:t==o&&i>=s&&a>=i?!0:i==s&&t>=n&&o>=t?!0:i==a&&t>=n&&o>=t?!0:void 0})},i.prototype.isIn=function(t){var e=this,i=[],n=_.max([this.startNum,this.endNum]),s=_.min([this.startNum,this.endNum]);return $(this.squares).each(function(t,e){e.removeClass("ip_square_circle")}),$(this.squares).each(function(t,o){if(!(e.isDHCP(o)||e.isNetgate(o)||e.isOccupy(o))){var a=e.getSquareData(o);a>=s&&n>=a&&(i.push(o),o.addClass("ip_square_circle"))}}),i},i.prototype.change=function(t){return this.changeCallback=t||this.changeCallback,this},i.prototype._doChange=function(){this.changeCallback(arguments),this.refreshLegend()},i.prototype.setCirleSelected=function(){var t=this,e=[];$(this.squares).each(function(i,n){n.hasClass("ip_square_circle")&&(t.setSquareStatus(n,"selected"),e.push(n),n.removeClass("ip_square_circle"))}),this._doChange(e)},i.prototype.addListener=function(){var t=this;$(this.container).mousedown(function(e){if(3==e.which)return!1;if(!t.isEdit)return!1;var i=$(e.target);return i.hasClass("ip_square")?(t.startNum=t.getSquareData(i),void(t.isDrag=!0)):!1}),$(this.container).mouseup(function(e){return t.isEdit?(t.isDrag=!1,void t.setCirleSelected()):!1}),$(this.container).mousemove(function(e){if(!t.isDrag)return!1;var i=$(e.target);if(!i.hasClass("ip_square"))return!1;t.endNum=t.getSquareData(i);var n=t.isIn();n.length&&t._doChange($(n)),t.refreshLegend()}),$(this.squares).each(function(e,i){$(this).hover(function(){$(this).hasClass("ip_square_wait")&&($(this).removeClass("ip_square_white"),$(this).addClass("ip_square_pink"))},function(){$(this).hasClass("ip_square_wait")&&($(this).addClass("ip_square_white"),$(this).removeClass("ip_square_pink"))}),$(this).mousedown(function(e){function i(t){return 3==e.which?(t.oncontextmenu=function(t){return t=t||root.event,t.cancelBubble=!0,t.stopPropagation(),!1},!1):!0}return t.isEdit&&t.isEditDhcp?t.isDHCP($(this))||t.isNetgate($(this))?i(this):void 0:i(this)}),$(this).click(function(e){return t.isEdit?void(t.isDHCP($(this))||t.isNetgate($(this))||(t.isUnselect($(this))?t.setSquareStatus($(this),"selected"):t.isSelected($(this))&&t.setSquareStatus($(this),"unselect"),!t.hasDhcp&&!t.isOptimize,t.isOccupy($(this))||t._doChange($(this)))):!1})})},i.prototype.clear=function(){},i.prototype.selectAll=function(){var t=this;$(this.getUnSelectedSquares()).each(function(e,i){t.setSquareStatus(i,"selected")})},i.prototype.unSelectAll=function(){var t=this;$(this.getSelectSquares()).each(function(e,i){"selected"==t.getSquareStatus(i)&&t.setSquareStatus(i,"unselect")})},i.prototype._getFormatSelect=function(){var t=[];return $(this.data.ips).each(function(e,i){var n={id:_.getIpSufix(i.ip)};n.project=i.tenant&&i.tenant.id?i.tenant.name:"",i.vm?n.host=i.vm:null,(n.project.length||n.host)&&(i.used=1),t.push(n)}),t},i.prototype._getRange=function(){var t=[];return $(this.data.ips).each(function(e,i){t.push(Number(_.getIpSufix(i.ip)))}),_.sortNum(t,!0)},i.prototype._getNewData=function(t){var e=null;return $(this.data.ips).each(function(i,n){var s=_.getIpSufix(n.ip);s==t&&(e=n)}),e},i.prototype.draw=function(){var t=this;if(this.box.empty(),this.container.empty(),this.isHideLengend||(this.box.append(this.legend),this.legend.find(".square_unselect .legend_text").text(_.getLocale(this.isOptimize?"framework.component.ip.status.unuse.tip":"framework.component.ip.status.unselect.tip")),this.legend.find(".square_selected .legend_text").text(_.getLocale(this.isOptimize?"framework.component.ip.status.inuse.tip":"framework.component.ip.status.selected.tip")),this.legend.find(".square_occupy_host .legend_text").text(_.getLocale("framework.component.ip.host.occpuy.tip")),this.legend.find(".square_occupy .legend_text").text(_.getLocale("framework.component.ip.tenant.occpuy.tip")),this.legend.find(".square_dhcp .legend_text_dhcp").text(_.getLocale("framework.component.ip.status.dhcp.tip")+"/"),this.legend.find(".square_dhcp .legend_text_gateway").text(_.getLocale("framework.component.ip.status.gateway.tip")),this.legend.find(".square_dhcp_edit .legend_text").text(_.getLocale("framework.component.ip.status.dhcp.tip"))),this.box.append(this.container),this.start=this.data.cidr[0],this.end=this.data.cidr[1],this.select=this._getFormatSelect(),this.range=this._getRange(),this.isFilter)$(this.range).each(function(e,i){var n=t.square.clone();n.text(i),n.data("id",i),n.data("newdata",t._getNewData(i)),t.container.append(n),t.setSquareStatus(n,"unselect"),t.squares.push(n)});else for(var e=this.start;e<=this.end;e++){var i=this.square.clone();i.text(e),i.data("id",e),i.data("newdata",this._getNewData(e)),this.container.append(i),t.setSquareStatus(i,"unselect"),this.squares.push(i)}this.setSelection(),this.refreshLegend()},i.prototype.refreshLegend=function(){this.legend.find(".square_unselect .legend_count").text(this.getUnSelectedSquares().length),this.legend.find(".square_selected .legend_count").text(this.getSelectedSquare().length),this.legend.find(".square_occupy_host .legend_count").text(this.getHostOccupySquare().length),this.legend.find(".square_occupy .legend_count").text(this.getTenantOccupySquare().length),this.legend.find(".square_dhcp .legend_count").text(this.getGatewaySquare().length),this.legend.find(".square_dhcp_edit .legend_count").text(this.getDhcpSuqare().length)},i.prototype.getSquareData=function(t){return t.data("id")},i.prototype.getSquareAttach=function(t){return t.data("attach")},i.prototype.getSquareNewData=function(t){return t.data("newdata")},i.prototype.setSquareStatus=function(t,e,i,n){function s(){return $(o).filter(function(t){return o[t]!=e})}var o=["unselect","selected","occupy","dhcp","netgate"],a="";switch(e){case"unselect":a=_.getLocale("framework.component.ip.status.unselect.tip");break;case"selected":a=_.getLocale("framework.component.ip.status.selected.tip");break;case"occupy":a=_.getLocale("network.vlan.ip.project")+i.project,i.hasOwnProperty("host")&&(a="emptyvm"==i.host?_.getLocale("network.vlan.ip.project")+i.project+"&nbsp;&nbsp;&nbsp;&nbsp;"+_.getLocale("network.vlan.ip.host")+"&nbsp;&nbsp;&nbsp;&nbsp;":_.getLocale("network.vlan.ip.project")+i.project+"&nbsp;&nbsp;&nbsp;&nbsp;"+_.getLocale("network.vlan.ip.host")+i.host);break;case"dhcp":a=_.getLocale("framework.component.ip.status.dhcp.tip");break;case"netgate":a=_.getLocale("framework.component.ip.status.netgate");break;default:throw new Error(_.getLocale("framework.component.ip.status.unknow"))}t.tooltip({content:a}),t.addClass("ip_square_"+e),i&&i.hasOwnProperty("host")&&t.addClass("ip_square_"+e+"_host"),n?t.addClass("ip_square_"+e+"_set"):t.removeClass("ip_square_"+e+"_set"),t.data("status",e),t.data("attach",i);var r=s();$(r).each(function(e,i){t.removeClass("ip_square_"+i)});var c=arguments;"dhcp"==e&&(t.removeClass("pointer"),$(t.siblings()).each(function(t,e){var i=$(e);i.removeClass("ip_square_dhcp_set"),i.hasClass("ip_square_dhcp")&&c.callee(i,"selected")})),"netgate"==e&&(t.removeClass("pointer"),$(t.siblings()).each(function(t,e){var i=$(e);i.hasClass("ip_square_netgate")&&c.callee(i,"unselect")})),"occupy"==e&&t.removeClass("pointer")},i.prototype.getSquareStatus=function(t){return t.data("status")},i.prototype.render=function(){this.init(),this.draw()},i.prototype.update=function(t,e){return this.clear(),new i(this.box,t,e)},i.prototype.setSelection=function(){var t=this;$(this.squares).each(function(e,i){var n=i.data("id");if(t.keyInArray(n,t.range)){var s=i.data("newdata");if(s.gateway)return void t.setNetgate(n,!0);if(s.dhcp)return void t._setDHCP(i);t.isFilter?s.isSelf&&t.setSquareStatus(i,"selected"):t.setSquareStatus(i,"selected"),s.used&&t.setOccupy(n,i)}})},i.prototype._setDHCP=function(t){this.hasDhcp||this.isNetgate(t)||(this.setDhcp(t,!0),this.hasDhcp=!0,this.refreshLegend())},i.prototype.getDhcp=function(){var t=this,e=null;return $(this.getSelectSquares()).each(function(i,n){t.isDHCP(n)&&(e=n)}),e?this.cidr.prefix+"."+this.getSquareData(e):null},i.prototype.getIps=function(){var t=[],e=this;return $(this.getIpRange()).each(function(i,n){t.push(e.cidr.prefix+"."+n)}),t},i.prototype.getIpsNoDhcp=function(){var t=[],e=this;return $(this.getIpRangeNoDhcp()).each(function(i,n){t.push(e.cidr.prefix+"."+n)}),t},i.prototype.getIpBySquare=function(t){return this.cidr.prefix+"."+this.getSquareData(t)},i.prototype.getIpsJustSelected=function(){var t=[],e=this;return $(this.squares).each(function(i,n){e.isSelected(n)&&t.push(e.cidr.prefix+"."+e.getSquareData(n))}),t},i.prototype.keyInArray=function(t,e){var i=!1;if(!e)return!1;for(var n=0;n<=e.length-1;n++)t==e[n]&&(i=!0);return i},i.prototype.setOccupy=function(t,e){var i=this;$(this.select).each(function(n,s){s.id==t&&i.setSquareStatus(e,"occupy",s)})},i.prototype.setMode=function(t){this.isEdit=t;var e=this;return t?this.container.find(".ip_square").each(function(t,i){e.isDisablePointDom($(i))||$(i).addClass("pointer")}):this.container.find(".ip_square").removeClass("poer"),this},i.prototype.setDhcp=function(t,e){this.isNetgate(t)||(e?(this.isEditDhcp||this.setSquareStatus(t,"dhcp"),this.hasDhcp=!0):this.setSquareStatus(t,"selected"))},i.prototype.setNetgate=function(t,e){var i=this,n=_.find(this.squares,function(t){return i.isNetgate(t)});n&&i.setSquareStatus(n,"unselect"),$(this.squares).each(function(n,s){var o=i.getSquareData(s);o==t&&(e?(i.setSquareStatus(s,"netgate"),i.hasNetgate=!0,i.refreshLegend()):(i.setSquareStatus(s,"unselect"),i.hasNetgate=!1))})},i.prototype.isSelect=function(t){var e=this.getSquareStatus(t);return"selected"==e||"occupy"==e||"dhcp"==e},i.prototype.isDHCP=function(t){var e=this.getSquareStatus(t);return"dhcp"==e},i.prototype.isNetgate=function(t){var e=this.getSquareStatus(t);return"netgate"==e},i.prototype.isOccupy=function(t){var e=this.getSquareStatus(t);return"occupy"==e},i.prototype.isHostOccupy=function(t){var e=t.data("newdata");return this.isOccupy(t)&&e.vm},i.prototype.isTenantOccupy=function(t){var e=t.data("newdata");return this.isOccupy(t)&&!e.vm},i.prototype.isSelected=function(t){var e=this.getSquareStatus(t);return"selected"==e},i.prototype.isUnselect=function(t){var e=this.getSquareStatus(t);return"unselect"==e},i.prototype.isDisablePointDom=function(t){var e="ip_square_";return t.hasClass(e+"netgate")||t.hasClass(e+"dhcp")||t.hasClass(e+"occupy")},i.prototype.getIpRange=function(){var t=[],e=this;return $(this.squares).each(function(i,n){e.isSelect(n)&&t.push(e.getSquareData(n))}),t},i.prototype.getIpRangeNoDhcp=function(){var t=[],e=this;return $(this.squares).each(function(i,n){e.isSelect(n)&&!e.isDHCP(n)&&t.push(e.getSquareData(n))}),t},i.prototype.getIpRangeJustSelected=function(){var t=[],e=this;return $(this.squares).each(function(i,n){e.isSelected(n)&&t.push(e.getSquareData(n))}),t},i.prototype.getSelectSquares=function(){var t=[],e=this;return $(this.squares).each(function(i,n){e.isSelect(n)&&t.push(n)}),t},i.prototype.getUnSelectedSquares=function(){var t=[],e=this;return $(this.squares).each(function(i,n){e.isUnselect(n)&&t.push(n)}),t},i.prototype.getSelectedSquare=function(){var t=[],e=this;return $(this.squares).each(function(i,n){e.isSelected(n)&&t.push(n)}),t},i.prototype.getHostOccupySquare=function(){var t=[],e=this;return $(this.squares).each(function(i,n){e.isHostOccupy(n)&&t.push(n)}),t},i.prototype.getTenantOccupySquare=function(){var t=[],e=this;return $(this.squares).each(function(i,n){e.isTenantOccupy(n)&&t.push(n)}),t},i.prototype.getDhcpSuqare=function(){var t=[],e=this;return $(this.squares).each(function(i,n){e.isDHCP(n)&&t.push(n)}),t},i.prototype.getGatewaySquare=function(){var t=[],e=this;return $(this.squares).each(function(i,n){e.isNetgate(n)&&t.push(n)}),t},i.prototype.getPreSelectSquares=function(){var t=[];return $(this.squares).each(function(e,i){i.hasClass("ip_square_circle")&&t.push(i)}),t},e.register(i,"ip"),i}),define("framework.ipLegend",["exports","framework.core"],function(t,e){function i(t,e){return this.box=t,this.data=e,this.contatiner=$('<ul class="ip-legend"><li class="square_unselect"><span class="legend_square ip_square_unselect"></span><span class="legend_text" i18n="iplegend.unselect.label"></span><p class="legend_count_p"><span>(</span><span class="legend_count">0</span><span>)</span></p></li><li class="square_selected"><span class="legend_square ip_square_selected"></span><span class="legend_text" i18n="iplegend.selected.label"></span><p class="legend_count_p"><span>(</span><span class="legend_count">0</span><span>)</span></p></li><li class="square_occupy_host"><span class="legend_square ip_square_occupy_host"></span><span class="legend_text" i18n="iplegend.occupy.host.label"></span><p class="legend_count_p"><span>(</span><span class="legend_count">0</span><span>)</span></p></li><li class="square_occupy"><span class="legend_square ip_square_occupy"></span><span class="legend_text" i18n="iplegend.occupy.label"></span><p class="legend_count_p"><span>(</span><span class="legend_count">0</span><span>)</span></p></li><li class="square_dhcp_edit"><span class="legend_square ip_square_dhcp_set"></span><span class="legend_text" i18n="iplegend.dhcp.label"></span><p class="legend_count_p"><span>(</span><span class="legend_count">0</span><span>)</span></p></li><li class="square_dhcp"><span class="legend_square ip_square_gateway_legend"></span><span class="legend_text legend_text_gateway" i18n="iplegend.gateway.label"></span><p class="legend_count_p"><span>(</span><span class="legend_count">0</span><span>)</span></p></li></ul>'),this.draw(),this}return i.prototype.draw=function(){this.box.empty(),this.box.append(this.contatiner),e.i18n.parse(this.contatiner),this.data&&this.setData(this.data)},i.prototype.setData=function(t){return _.isObject(t)?(this.data=t,this.contatiner.find(".square_unselect .legend_count").text(t.unselect),this.contatiner.find(".square_selected .legend_count").text(t.selected),this.contatiner.find(".square_occupy_host .legend_count").text(t.hostOccupy),this.contatiner.find(".square_occupy .legend_count").text(t.tenantOccupy),this.contatiner.find(".square_dhcp .legend_count").text(t.gateway),this.contatiner.find(".square_dhcp_edit .legend_count").text(t.dhcp),!0):!1},i.isDom=!0,e.register(i,"ipLegend"),i}),define("framework.lift",["framework.core","exports"],function(t,e){function i(t){this.box=t,this.container=$('<div><a class="lift-btn-up"><i class="lift-up"></i></a><a class="lift-btn-down"><i class="lift-down"></i></a></div>'),this.upBtn=this.container.find("a.lift-btn-up"),this.downBtn=this.container.find("a.lift-btn-down"),this.render()}return i.prototype.render=function(){this.box.empty(),this.box.hide(),this.box.addClass("ef-lift"),this.box.append(this.container),this.upBtn.tooltip({content:_.getLocale("lift.up.tip"),position:"top"}),this.downBtn.tooltip({content:_.getLocale("lift.down.tip")}),this.box.fadeIn("slow"),this.addListener()},i.prototype.addListener=function(){this.upBtn.click(function(){$(document.body).scrollTop(0)}),this.downBtn.click(function(){$(document.body).scrollTop($(document).height())})},i.isDom=!0,t.register(i,"lift"),i}),define("framework.loading",["exports","framework.core"],function(t,e){function i(){this.dom=$('<div style="width: 100%;height:100%;z-index:2147483647;position:fixed;top:0;"> <div class="window-loading" style="width:100%;height:100%;z-index:2147483640;position: absolute;"></div><div style="width: 100%;height:100%;z-index: 2147483641;position: absolute;left:0;top:0;display: table"><span style="display: inline-block;vertical-align: middle;height:100%;display: table-cell;text-align: center;"><i class="loading-img"></i></span></div></div>')}return i.isInstance=!0,i.prototype.show=function(){$(document.body).append(this.dom),this.dom.fadeIn("fast")},i.prototype.hide=function(){this.dom.fadeOut("fast",function(){$(this).hide()})},e.register(i,"loading"),i}),define("framework.localStorage",["exports","framework.core"],function(t,e){function i(){}return i.isInstance=!0,i.prototype.put=function(t,e){t&&2==arguments.length&&(this[t]=e)},i.prototype.get=function(t){return this[t]},i.prototype["delete"]=function(t){return this.hasKey(t)?(delete this[t],!0):!1},i.prototype.clear=function(){for(var t in this)delete this[t];return this},i.prototype.hasKey=function(t){return this.hasOwnProperty(t)},e.register(i,"localStorage"),i}),define("framework.messager",["exports","framework.core"],function(t,e){function i(){this.name="ef-framework-messager"}return i.titles={deleting:{title:_.getLocale("global.messager.title.deleting.tip"),icon:""},warning:{title:_.getLocale("global.messager.title.warning.tip"),icon:""},reminding:{title:_.getLocale("global.messager.title.reminding.tip"),icon:""}},i.prototype.alert=function(t,e,n,s,o){var a={width:450,height:"auto",title:i.titles[t].title||i.titles.reminding.title,msg:'<span class="js-frame-confirm">'+e+"</span>",icon:n,onClose:o||$.noop,fn:s};$.messager.alert.call(this,a)},i.prototype.confirm=function(t,e,n,s){var o={width:450,height:"auto",type:t||"reminding",title:i.titles[t].title||i.titles.reminding.title,msg:'<span class="js-frame-confirm">'+e+"</span>",icon:n,fn:s};$.messager.confirm.call(this,o)},i.isInstance=!0,e.register(i,"messager"),i}),define("framework.nav",["exports","framework.core","user"],function(t,e,i){function n(t,n,s,o,a){return this.box=t,this.box.empty(),this.container=$('<ul class="nav"></ul>'),this.lev0Box=$('<li class="lev0-box"></li>'),this.lev0=$('<div class="lev0"></div>'),this.lev1Box=$('<ul class="lev1-box"></ul>'),this.lev1=$('<li class="lev1"></li>'),this.lev0Icon=$('<div class="nav-icon"><img class="hide"><i /></div>'),this.lev0Text=$('<div class="nav-text"></div>'),this.lev0Right=$('<div class="nav-right-icon"><a  class="textbox-icon combo-arrow textbox-icon-disabled" icon-index="0" tabindex="-1" style="min-width: 18px; height: 52px;"></a></div>'),this.a=$("<a></a>"),this.data=n,this.expandAll=!1,this.expandLimit=3,this.box.append(this.container),this["super"]=!1,this.roleType=a?null:i.getRole().value,this["super"]=i.isSuper(),this["default"]=i.getRole()["default"],this.changeCallback=s?s:$.noop,this.prechangeCallback=o?o:$.noop,this.lastId=null,this.dir="views/",this.init(),this.draw(),this.addListener(),e.nav=this,this}return n.isDom=!0,n.prototype.Current=function(){this.id="",this.src="",this.data=null,this.fn=null},n.prototype.init=function(){this.current=new this.Current},n.prototype.change=function(t){this.changeCallback=t},n.prototype.getUrl=function(t){return this.dir+t},n.prototype["goto"]=function(t,e,i,n,s){n=n?n:$.noop,arguments.length>1&&this.setSelected(e),s&&this.setSelected(s),t&&this.load(t,e,n,i)},n.prototype._revokeData=function(){var t=$(".right-entity").find("._temp_data_cont___");t.removeData("pageData"),t.removeData("pageId"),t.remove(),$(".right-entity").empty()},n.prototype._injectData=function(t,e){var i=$('<div class="hide _temp_data_cont___"></div>');i.data("pageData",e),i.data("pageId",t),$(".right-entity").append(i)},n.prototype.setSelected=function(t){t&&this.container.find(".lev0,.lev1").each(function(e,i){if($(this).attr("id")==t){$(this).addClass("current");var n=$(this).parent();n.hasClass("lev1-box")&&!n.is(":visible")&&n.siblings().click()}else $(this).hasClass("current")&&$(this).removeClass("current").removeClass("selected").removeClass("hovered")})},n.prototype.getItemById=function(t){var e=null;return $(this.data).each(function(i,n){return n.id==t?void(e=n):void(n.children&&$(n.children).each(function(i,n){n.id==t&&(e=n)}))}),e},n.prototype.reload=function(t){this.load(this.current.src,this.current.id,this.current.fn,this.current.data,t)},n.prototype.load=function(t,i,n,s,o){this.current.id=i,this.current.src=t,this.current.data=s,this.current.fn=n;var a=this;n=n?n:$.noop,o||e.loading.show(),this._revokeData(),t=this.getUrl(t),i&&(t=t+"?id="+i),a.prechangeCallback(i,a.lastId),$(".right-entity").removeClass("no-scroll-y");var r=this.getItemById(i);if(r&&r.iframe){var c=$('<iframe class="nav-iframe" width="100%" height="100%" frameboard="0"></iframe>');c.attr("src",_.url(t)),$(".right-entity").html(c),$(".right-entity").addClass("no-scroll-y"),e.loading.hide();var h=$(this).find("._temp_data_cont___");return h.length&&a._revokeData(),a.lastId=i,void(n&&n(s))}$(".right-entity").load(t,null,function(){a.changeCallback(i,a.lastId),a.lastId=i;var t=$(this).find("._temp_data_cont___");t.length&&a._revokeData(),a._injectData(i,s),setTimeout(function(){e.loading.hide()},200),n&&n(s)})},n.prototype.addListener=function(){var t=this;this.container.find(".lev0").hover(function(){return $(this).hasClass("current")||$(this).parent().hasClass("not-allowed")?!1:($(this).addClass("hovered"),t.container.find(".lev0").not($(this)).removeClass("hovered"),void($(this).parent().hasClass("nav-popup")&&$(this).parent().find(".lev1-box").show()))},function(t){if(!$(this).hasClass("current")&&($(this).removeClass("hovered"),$(this).parent().hasClass("nav-popup"))){var e=$($(t.toElement).parents(".nav-popup"));e&&e.contains(this)||$(this).parent().find(".lev1-box").hide()}}),this.container.find(".lev0").click(function(){if($(this).parent().hasClass("not-allowed"))return!1;$(this).attr("src")&&t.load($(this).attr("src"),$(this).attr("id"));var e=$(this).next().length;e||($(this).addClass("current"),$(this).parent().siblings().find("li").removeClass("current"),t.container.find(".lev0").not($(this)).removeClass("current").removeClass("selected")),$(this).parent().siblings().find("li").removeClass("selected").removeClass("hovered"),t.expandAll||($(this).addClass("selected"),t.container.find("ul").each(function(){$(this).parent().hasClass("nav-popup")||$(this).slideUp()}),t.container.find("ul").not("selected").find("li").removeClass("selected").removeClass("hovered"),$(this).parent().siblings().find(".lev0").removeClass("selected"),$(this).parent().hasClass("nav-popup")||($(this).siblings().is(":visible")?$(this).siblings().slideUp("normal",function(){$(this).siblings().removeClass("selected")}):$(this).siblings().slideDown()))}),this.container.find("ul li").hover(function(){return $(this).hasClass("selected")||$(this).hasClass("not-allowed")?!1:($(this).addClass("hovered"),void t.container.find("ul li").not($(this)).removeClass("hoverd"))},function(){$(this).hasClass("selected")||$(this).removeClass("hovered")}),this.container.find(".lev1-box").hover(function(t){},function(t){$(this).parent().hasClass("nav-popup")&&($(t.toElement).parents(".nav-popup").length||$(this).hide())}),this.container.find("ul li").click(function(){return $(this).hasClass("not-allowed")?!1:($(this).attr("src")&&(t.load($(this).attr("src"),$(this).attr("id")),$(this).addClass("selected"),$(this).addClass("current"),t.container.find(".lev0").removeClass("current").removeClass("selected"),t.container.find("ul li").not($(this)).removeClass("selected").removeClass("hovered").removeClass("current")),$(this).parent().siblings().addClass("selected"),void t.container.find("ul.lev1-box").each(function(){$(this).siblings().hasClass("selected")||$(this).slideUp()}))}),this.container.mousewheel(function(e){var i=t.box.height()-t.box.prev().height(),n=$(this).height(),s=n-i;if(n>i){var o=$(this).css("top");o=Number(o.replace("px","")),o-=-e.deltaY*e.deltaFactor,o=-s>o?-s:o,o=o>0?0:o,o=Math.floor(o),$(this).css({top:o})}else $(this).css({top:0});$(this).find(".lev0-box").each(function(){$(this).hasClass("nav-popup")&&$(this).find(".lev1-box").hide()})}),this.box.resize(function(){t.container.css({top:0})})},n.prototype.getExpandLen=function(){var t=0,e=this;return $(this.data).each(function(i,n){_.noRight(e.roleType,n.access,e["super"])||(n.children&&$(n.children).each(function(i,n){_.noRight(e.roleType,n.access,e["super"])||t++}),t++)}),1/0},n.prototype.draw=function(){if(this.data&&this.data.length){var t=this,e=null;this.expandAll=this.getExpandLen()<this.expandLimit,$(this.data).each(function(i,n){var s=t.lev0Box.clone(),o=t.lev0.clone(),a=t.lev0Icon.clone(),r=t.lev0Text.clone(),c=t.lev1Box.clone(),h=t.lev0Right.clone();if(n.isPopup&&s.addClass("nav-popup"),e&&e.lev0&&e.lev0==n.id&&(n.selected=!0),t.roleType&&n.id==t["default"]&&(n.selected=!0),n.src&&o.attr("src",n.src),n.iframe&&o.attr("iframe",!0),n.selected&&(o.addClass("selected"),s.hasClass("nav-popup")||c.css({display:"block"}),n.children||o.addClass("current"),n.src&&t.load(n.src,n.id)),o.attr("id",n.id),t.container.append(s),s.append(o),n.href){var l=t.a.clone();l.attr("href",n.href),o.wrap(l)}return n.iconClass?(a.find("img").remove(),a.find("i").addClass(n.iconClass)):(a.find("img").show(),a.find("img").attr("src",n.icon),a.find("i").remove()),r.text(_.getLocale("framework.component.nav."+n.id+".label")),o.append(r),o.append(a),o.append(h),s.append(c),s.hide(),n.invisible&&!t["super"]?void s.remove():n.access&&!t["super"]&&_.noRight(t.roleType,n.access,t["super"])?void s.remove():(s.animate({height:"toggle",opacity:"toggle"},"slow"),n.children&&n.children.length?(t.expandAll&&c.show(),void $(n.children).each(function(i,n){if(n.invisible&&!t["super"]);else{if(_.noRight(t.roleType,n.access,t["super"]))return;var s=t.lev1.clone();if(s.text(_.getLocale("framework.component.nav."+n.id+".label")),c.append(s),n.href){var a=t.a.clone();a.attr("href",n.href),s.wrap(a)}e&&e.lev1&&e.lev1==n.id&&(n.selected=!0),t.roleType&&n.id==t["default"]&&(n.selected=!0),n.src?s.attr("src",n.src):s.addClass("not-allowed"),n.iframe&&s.attr("iframe",!0),n.selected&&(s.addClass("current"),o.addClass("selected"),c.show(),n.src&&t.load(n.src,n.id)),s.attr("id",n.id)}})):(c.remove(),void(n.src||s.addClass("not-allowed"))))})}},e.register(n,"nav"),n}),define("framework.notification",["exports","module","framework.core"],function(t,e,i){function n(){return this}function s(t){this.tm=null,this.id=_.uniqueId("message_un_"),this.config={duration:4500,message:"",description:"",icon:"",onClose:$.noop,render:function(t){var e=$("<span></span>");return e.text(t||this.description),e}},_.copy(t,this.config),this.tempalte=$('<div class="ef-notification"><div class="ef-notification-notice"><i class="ef-notification-icon"></i><div class="ef-notification-notice-content"><div class="ef-notification-notice-message"></div><div class="ef-notification-notice-description"></div></div></div><a tabindex="0" class="ef-notification-notice-close"><span class="ef-notification-notice-close-x"></span></a></div></div>'),this.render(),$(document.body).append(this.tempalte),this.tempalte.addClass("ease-in"),this.tempalte.find(".ef-notification-icon").addClass(this.config.icon),
this.config.icon||this.tempalte.find(".ef-notification-icon").remove();var e=this;n.messages.push(this),this.tempalte.find(".ef-notification-notice-close").click(function(){clearTimeout(e.tm),e.movesDown(),e.__close()}),this.destroy(),this.movesUp()}return s.prototype.movesDown=function(){var t=_.indexOf(n.messages,this);_.each(n.messages,function(e,i){t>=i&&e.move(i,!0)})},s.prototype.movesUp=function(){_.each(n.messages,function(t,e){t.move(e)})},s.prototype.render=function(){this.tempalte.find(".ef-notification-notice-message").text(this.config.message),this.tempalte.find(".ef-notification-notice-description").html(this.config.render(this.config.description))},s.prototype.__close=function(){this.hide(),this.config.onClose(),n.messages=_.without(n.messages,this)},s.prototype.move=function(t,e){if(this.tempalte.stop(),e){var i=this.tempalte.css("bottom");i=i.replace(/px$/,""),console.log(i),this.tempalte.animate({bottom:i-this.tempalte.height()})}else this.tempalte.animate({bottom:"+"+((n.messages.length-t-1)*this.tempalte.height()+10)+"px"},100)},s.prototype.destroy=function(){var t=this;this.tm=setTimeout(function(){clearTimeout(t.tm),t.__close()},this.config.duration)},n.isInstance=!0,n.messages=[],s.prototype.hide=function(){var t=this;this.tempalte.removeClass("ease-int").addClass("ease-out"),setTimeout(function(){t.tempalte.remove()},300)},n.prototype.show=function(t){new s(t)},i.register(n,"notification"),n}),define("framework.param",["framework.core","exports"],function(t,e){function i(t,e){return this.box=t,this.data=e,this.clickCallback=$.noop,this.data=this.data?this.data:[],this.current=null,this.temRender=$('<div class="ef-param"></div>'),this.template=$('<div class="paramSquare"><span class="paramText"></span><span class="paramValue"></span></div>'),this.draw(),this}return i.isDom=!0,i.prototype.draw=function(){var t=this;t.box.empty(),t.temRender.empty(),this.data.labelField||(this.data.labelField="label"),this.data.valueField||(this.data.valueField="value"),$(this.data.dataProvider).each(function(e,i){var n=t.template.clone(!0);n.find(".paramText").text(i[t.data.labelField]),n.find(".paramValue").text(i[t.data.valueField]),t.temRender.append(n)}),t.box.append(t.temRender),this.box.find(".paramSquare").addClass(this.data.allBackClass),this.addListener()},i.prototype.addListener=function(){var t=this;t.temRender.find(".paramSquare").click(function(){t.current=$(this),$(this).addClass("paramSquare-select").siblings().removeClass("paramSquare-select");var e,i=$(this).find(".paramText").text();$(t.data.dataProvider).each(function(n,s){s[t.data.labelField]==i&&(e=s)}),t.clickCallback(e)})},i.prototype.click=function(t){this.clickCallback=t},i.prototype.addParam=function(t){this.data.dataProvider=this.data.dataProvider.concat(t),this.draw()},i.prototype.deleteParam=function(){var t,e=this,i=e.template.clone(!0);$(i).each(function(i,n){t=e.temRender.find(".paramSquare-select .paramText").text(),e.temRender.find(".paramSquare-select").remove()}),console.log(t),$(this.data.dataProvider).each(function(i,n){n[e.data.labelField]==t&&e.data.dataProvider.splice(i,1)}),this.current=null},i.prototype.select=function(){var t,e,i=this,n=i.template.clone(!0);return $(n).each(function(e,n){t=i.temRender.find(".paramSquare-select .paramText").text(),i.temRender.find(".paramSquare-select").remove()}),$(this.data.dataProvider).each(function(n,s){s[i.data.labelField]==t&&(e=s)}),e},i.prototype.getAllData=function(){return console.log(this.data.dataProvider),this.data.dataProvider},i.prototype.clear=function(){this.data.dataProvider=[],this.draw()},i.prototype.destroy=function(){},t.register(i,"param"),this}),define("framework.picker",["exports","framework.core"],function(t,e){function i(t,e){this.box=t,this.data=e,this.container=$('<div class="ef-picker"></div>'),this.template=$('<div class="ef-picker-square"><i></i></div>'),this.popup=$('<div class="ef-picker-popup"></div>'),this.origin=null,this.hasSelected=!1,this.disable=!1,this.squares=[],this.setConfig(e),this.draw(),this.addListener()}return i.prototype.setConfig=function(t){if(t)for(var e in t)this[e]=t[e]},i.prototype.draw=function(){var t=this;this.box.css({display:"inline-block"}),this.box.empty(),this.box.append(this.container),this.origin=this.template.clone(),this.container.append(this.origin),this.origin.addClass("ef-picker-origin"),this.data.dataProvider&&this.dataProvider.length&&(this.container.append(this.popup),$(this.data.dataProvider).each(function(e,i){var n=new t.Square;n.data=i,n.dom=t.template.clone(),t.popup.append(n.dom),t.squares.push(n),n.dom.find("i").addClass(i.icon)}),this.hasSelected||this.select(this.squares[0].dom))},i.prototype.addListener=function(){var t=this;this.origin.click(function(){return t.disable?!1:void t.popup.show()}),this.popup.find(".ef-picker-square").click(function(){t.popup.hide(),t.select($(this))}),this.popup.find(".ef-picker-square").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}),$(document).click(function(e){var i=$(e.target);i.is(t.popup)||0==i.closest(t.origin.find("i")).length&&t.popup.hide()})},i.prototype.select=function(t){var e=this,i=t.find("i").attr("class");e.origin.find("i").removeClass(),$(this.squares).each(function(n,s){s.dom.find("i").hasClass(i)?(s.data.selected=!0,e.origin.find("i").addClass(i),t.addClass("selected"),e.hasSelected=!0,e.data.onChange&&e.data.onChange(s)):(s.data.selected=!1,s.dom.removeClass("selected"))})},i.prototype.setSelectByClass=function(t){var e=_.find(this.squares,function(e){return e.dom.find("i").hasClass(t)});e&&this.select(e.dom)},i.prototype.getSelected=function(){return _.find(this.squares,function(t){return t.data.selected})},i.prototype.Square=function(){this.data=null,this.dom=null},i.prototype.setDisable=function(t){this.disable=t,t?this.origin.addClass("disabled"):this.origin.removeClass("disabled")},i.isDom=!0,e.register(i,"picker"),this}),define("framework.placard",["exports","framework.core"],function(t,e){function i(){this.name="placard",this.type="info",this.remain=5e3,this.tm=null,this.dom=$('<div class="ef-placard"><div class="ef-placard-box"><div class="ef-placard-bg"></div><div class="ef-placard-cont"><i></i><span></span>    </div></div></div>'),this.icon=this.dom.find(".ef-placard-cont i"),this.position="n",this.addListener()}return i.isInstance=!0,i.prototype.resize=function(t){t.dom.css("left",($(e.root).width()-t.dom.width())/2)},i.prototype.addListener=function(){var t=this;$(e.root).on("resize.Placard",function(){t.resize(t)}),this.dom.hover(function(){t.tm&&t.pause()},function(){t.show()})},i.prototype.removeListener=function(){$(e.root).off("resize.Placard")},i.prototype.reset=function(){var t=this;this.tm=setTimeout(function(){t.hide()},t.remain)},i.prototype.pause=function(){this.tm&&clearTimeout(this.tm)},i.prototype.show=function(t,e,i,n){arguments.length||(t=this.msg,e=this.type,i=this.position);var s=this;this.msg=t,this.msg&&(this.pause(),this.type=void 0==e?"info":e,this.setType(this.type,n),this.position=i?i:this.position,this.dom.find(".ef-placard-cont span").text(this.msg),$(document.body).append(this.dom),this.dom.slideDown("slow",function(){s.reset()}),this.addListener(),this.resize(this))},i.prototype.tick=function(t){return this.show.apply(this,[t,"tick"])},i.prototype.info=function(t){return this.show.apply(this,[t,"info"])},i.prototype.warn=function(t){return this.show.apply(this,[t,"warn"])},i.prototype.error=function(t){return this.show.apply(this,[t,"error"])},i.prototype.mail=function(t){return this.show.apply(this,[t,"mail"])},i.prototype.doing=function(t){return this.show.apply(this,[t,"doing"])},i.prototype.custom=function(t,e,i){return this.show.apply(this,[t,"custom",e,i])},i.prototype.setType=function(t,e){t=t.toLowerCase(),this.type=t,this.icon.removeClass(),e=e||"icon-"+t,this.icon.addClass(e)},i.prototype.hide=function(){var t=this;this.msg=void 0,this.pause(),this.dom.slideUp("fast",function(){t.dom.remove(),t.removeListener()})},e.register(i,"placard"),i}),define("framework.preload",["exports","framework.core"],function(t,e){function i(t,e){return this.box=t,this.data=e,this.container=$('<div class="loading ef-preload"><span class="ef-preload-cont"><i class="inner-loading2"></i></span></div>'),this.init(),this.show(),this}return i.isDom=!0,i.prototype.init=function(){this.box.css({position:"relative"});var t=this.box.find(".ef-preload");t.length&&t.remove(),this.box.append(this.container)},i.prototype.show=function(){this.container.css({display:"table"});var t=this.data||this.box.height();t=t>500?500:t,this.container.height(t)},i.prototype.hide=function(){this.container.hide()},e.register(i,"preload"),i}),define("framework.resultList",["framework.core","module","exports"],function(t,e,i){function n(t,e){return this.box=t,this.labelField="label",this.valueField="value",this.groupField="group",this.groups=[],this.data=e||{},this.container=$('<div class="ef-result-list"><h3 class="ef-result-title"></h3><div class="ef-result-cont"></div></div></div>'),this.groupTemplate=$('<div class="ef-result-group"><h4 class="ef-result-group-title"></h4><ul class="ef-result-group-items"></ul></div>'),this.init(),this}return n.prototype.init=function(){this.labelField=this.data.labelField||this.labelField,this.valueField=this.data.valueField||this.valueField,this.groupField=this.data.groupField||this.groupField,this.box.empty(),this.box.append(this.container),this.container.find(".ef-result-title").text(this.data.title),this.parse()&&this.render(),this.box.attr("way-data",this.data.id),this.box.attr("way-writeonly",!0),this.box.attr("way-html",!0);var t=way.get(this.data.id);way.options.timeoutInput=0,t||way.set(this.data.id,{skills:[]})},n.prototype.parse=function(){var t=this;return _.isArray(this.data.data)?(this.groups=_.uniq(_.pluck(this.data.data,this.groupField)),this._parseData=_.map(this.groups,function(t){return{group:t,items:[]}}),_.each(this.data.data,function(e){var i=e.group;_.find(t._parseData,function(t){t.group==i&&t.items.push(e)})}),!0):!1},n.prototype.render=function(){var t=this,e=t.container.find(".ef-result-cont");_.each(this._parseData,function(i,n){var s=t.groupTemplate.clone();e.append(s);var o=s.find(".ef-result-group-title");o.text(i.group),o.attr({id:"ef-result-list-anchor-"+n,name:"ef-result-list-anchor-"+n}),t._renderItems(i.items,s.find(".ef-result-group-items"))}),way.registerBindings()},n.prototype["goto"]=function(t){var e="#ef-result-list-anchor-"+t,i=this.container.find(e);if(i.is("h4")){var n=this.container.find(".ef-result-cont"),s=i.position().top;0==t&&(s=0),n.scrollTop(s)}},n.prototype._renderItems=function(t,e){var i=this;_.each(t,function(t){var n;_.isArray(t.columns)?(n=$('<li class="ef-result-list-grid-line"></li>'),i._renderGrid(t,n)):_.isArray(t.list)?(n=$('<li class="ef-result-list-grid-line"><span class="ef-result-list-list-title"></span><div class="ef-result-list-list-value"></div></li>'),n.find(".ef-result-list-list-title").text(t[i.labelField]),i._renderList(t,n)):(n=$('<li><span class="ef-result-item-label"></span><span class="ef-result-item-value" way-html="true"></span></li>'),n.find(".ef-result-item-label").text(t[i.labelField]),n.find(".ef-result-item-value").attr("way-data",i.data.id+"."+t[i.valueField])),e.append(n)})},n.prototype._renderList=function(t,e){var i=$('<div class="repeat-row"></div>');i.attr("way-repeat",this.data.id+"."+t[this.valueField]),_.each(t.list,function(t){var e=$('<span class="row" way-html="true" way-transform="listTrans"></span>');e.attr("way-data",t.filed),i.append(e)}),e.find(".ef-result-list-list-value").append(i)},n.prototype._renderGrid=function(t,e){var i=$('<div class="ef-result-list-grid"><div class="header"></div><div class="body"><div class="repeat-row"></div></div></div>'),n=i.find(".header"),s=i.find(".body");s.find(".repeat-row").attr("way-repeat",this.data.id+"."+t[this.valueField]),_.each(t.columns,function(t){var e=$('<span class="col"></span>');e.text(t.title),n.append(e);var i=$('<span class="row" way-html="true"></span>');i.attr("way-data",t.filed),s.find(".repeat-row").append(i)}),e.append(i)},n.isDom=!0,t.register(n,"resultList"),n}),define("framework.sample",["exports","framework.core"],function(t,e){function i(t,e){return this.box=t,this.data=e,this.template=$("<span></span>"),this.color="#ff0000",this.render(),this}return i.prototype.render=function(){this.box.append(this.template),this.template.text(this.data.label)},i.prototype.show=function(){this.template.show()},i.prototype.hide=function(){this.template.hide()},i.isDom=!0,i.isIntance=!1,e.register(i),i}),define("framework.scrollBar",["framework.core","module","exports"],function(t,e,i){function n(t){this.box=t,this.container=$('<div class="ef-scrollbar"><div class="ef-scrollbar-content"><div class="ef-scrollbar-cont"></div></div><div class="ef-scrollbar-track"><div class="ef-scrollbar-bar"></div></div></div>'),this.container.find(".ef-scrollbar-content").height(this.box.css("height")),this.container.width(Number(this.box.css("width").replace("px",""))+10),this.box.parent().append(this.container),this.box.css({height:"auto"}),this.container.find(".ef-scrollbar-cont").append(t),this.thumb=this.container.find(".ef-scrollbar-bar"),this.box.css({position:"absolute"}),this.isDrag=!1,this.ratio=0,this.cal(),this.addListener()}return n.prototype.cal=function(){var t=this.box.height(),e=this.container.find(".ef-scrollbar-track").height(),i=t-e;if(!(0>=i)){var n=Math.pow(e,2)/(i+e);this.ratio=i/(e-n),this.thumb.height(n)}},n.prototype.addListener=function(){var t=this;this.thumb.draggable({axis:"v",onDrag:function(e){var i=e.data;i.top<0&&(i.top=0),i.top+$(i.target).outerHeight()>=$(i.parent).height()&&(i.top=$(i.parent).height()-$(i.target).outerHeight()),t.move(i.top)}})},n.prototype.move=function(t){var e=-t*this.ratio;this.box.css({top:e})},n.isDom=!0,t.register(n,"scrollBar"),n}),define("framework.sequenceLoader",["exports","framework.core"],function(t,e){function i(t){return this.options=t,this.completeCallback=$.noop,this.allExecutedCallback=$.noop,this.start(),this}return i.prototype.start=function(){this.options&&_.isArray(this.options)&&(this.loaded=!1,this.index=0,this.load())},i.prototype.complete=function(t){return this.completeCallback=t,this},i.prototype.load=function(t){var i=t||this,n=arguments,s=null;if(i.index<i.options.length){s=i.options[i.index];var o=s.success,a=s.error;s.success=function(){i.index++,i.loaded=i.index>=i.options.length,o?o(arguments):null,i.doCallback(!0,arguments,s,i.index-1),i.loaded?i.allExecutedCallback():n.callee(i)},s.error=function(){i.index++,i.loaded=i.index>=i.options.length,a?a(arguments):null,i.doCallback(!1,arguments,s,i.index-1),i.loaded?i.allExecutedCallback():n.callee(i)},e.getJSON(s)}},i.prototype.doCallback=function(t,e,i,n){var s=new this.Result;s.success=t,s.loaded=this.loaded,s.response=e,s.request=i,s.index=n,this.completeCallback(s)},i.prototype.Result=function(){this.loaded=!1,this.success=!1,this.response=null,this.request=null,this.index=-1},i.prototype.allExecuted=function(t){return this.allExecutedCallback=t,this},e.register(i,"SequenceLoader"),i}),define("framework.server.socket",["module","exports","framework.core"],function(t,e,i){function n(t,e){this.url=t,this.socket=null,this.id=e||void 0,this.init(),n._instances.push(this)}return n._instances=[],n.prototype.onclose=$.noop,n.prototype.onmessage=$.noop,n.prototype.onopen=$.noop,n.prototype.onerror=$.noop,n.prototype.init=function(){var t=this;this.socket=new WebSocket(this.url),this.socket.onclose=function(){return t.onclose(arguments)},this.socket.onmessage=function(e){return t.onmessage(e)},this.socket.onopen=function(){return t.onopen(arguments)},this.socket.onerror=function(){return t.onerror(arguments)}},n.prototype.send=function(t){return this.socket.send(t)},n.prototype.close=function(){return this.socket.close()},n.get=function(t){return t?_.find(this._instances,function(e){return e.id==t}):!1},n._revoke=function(t){this._instances=_.without(this._instances,t),t=null},n.prototype.destroy=function(){n._revoke(this)},n.closeAll=function(){$(n._instances).each(function(t,e){e.close()})},i.register(n,"Socket","server"),n}),define("framework.sessionStorage",["exports","framework.core"],function(t,e){function i(){}return i.isInstance=!0,i.prototype.put=function(t,i){this._init();var n=this.get();if(n){n[t]=i;var s=JSON.stringify(n);e.root.name=s}},i.prototype.get=function(t){var i=e.root.name;if(i){try{i=JSON.parse(i)}catch(n){return}return arguments.length&&(i=i[t]),i}},i.prototype._init=function(){var t=e.root.name;if(!t||"undefined"==t){var i={},n=JSON.stringify(i);e.root.name=n}},i.prototype.clear=function(){e.root.name=""},e.register(i,"sessionStorage"),i}),define("framework.shell",["exports","framework.core"],function(t,e){console.log("shell:"),require(["framework.core","framework.timeline","framework.topo","framework.ip","framework.incrementNum","framework.timer","framework.iconmenu","framework.sessionStorage","framework.iconstep","framework.viewstack","framework.coor","framework.interface","framework.placard","framework.backup","framework.upload","framework.buttonstep","framework.preload","framework.switch","framework.sequenceLoader","framework.dialog","framework.event","framework.loading","framework.localStorage","framework.nav","framework.terminal","framework.download","framework.alert","framework.sliceUpload","framework.iconchange","framework.squire","framework.appBlock","framework.param","framework.checkinfo","framework.coverlayer","framework.dataScroll","framework.dataCenter","framework.cn2uni","framework.server.socket","framework.picker","framework.tiles","framework.uploadLoading","framework.cidrWidget","framework.cidrX","framework.ipLegend","framework.lift","framework.topoNew","framework.breadcrumbs","framework.resultList","framework.notification","framework.messager","framework.scrollBar"])}),define("framework.sliceUpload",["exports","framework.core","user"],function(t,e,i){function n(t,e){return e.url?(this.box=t,this.config=e,this.sliceValue=52428800,this.url=null,this.tempalte=$('<form enctype="multipart/form-data"><input type="file" name="file" class="fileUpload"></form>'),this.file=null,this.init(),this.i=0,this.suffix=null,this.successCallBack=$.noop,this.progressFun=$.noop,this.errorCallBack=$.noop,this.uploadOpt=null,e.isTrigger&&this.triggerUpload(),this):void 0}return n.isDom=!0,n.prototype.init=function(){this._header={"Ecloud-Token":i.getToken(),"Ecloud-Method":"POST"},this.box.append(this.tempalte),this.config.url&&(this.url=this.config.url),this.config.styleClass&&this.tempalte.addClass(this.config.styleClass),this.config.sliceValue&&(this.sliceValue=this.config.sliceValue)},n.prototype.addListener=function(){var t=this,e=(this.file.name,this.file.size),i=this.sliceValue,n=Math.ceil(e/i);if(!(this.i>=n)){var s=this.i*i,o=Math.min(e,s+i),a=new FormData;a.append("data",this.file.slice(s,o)),this.suffix=this.file.name.split(".").pop(),a.append("filename",this.file.uuid+"."+this.suffix),t.uploadOpt=$.ajax({url:t.url,type:"POST",data:a,async:!0,processData:!1,contentType:!1,headers:t._header,success:function(e){if(e&&e.success){t.i=t.i+1;var i=Math.ceil(100*t.i/n);t.addListener(t.file,t.i),t.i==n&&(e.result.last="over"),t.successCallBack(e,i)}else t.errorCallBack()}})}},n.prototype.uploadClick=function(t,i){var n=this,s=this.box.find(".fileUpload");return""==$.trim(s.val())?void e.placard.warn("请选择上传文件"):(this.file=this.box.find(".fileUpload")[0].files[0],this.file.uuid=e.util.getUUID(),t&&(n.successCallBack=t,n.errorCallBack=i),void this.addListener())},n.prototype.triggerUpload=function(){var t=this;this.box.find(".fileUpload").change(function(){t.uploadClick()})},n.prototype.change=function(t){var e=this;this.box.find(".fileUpload").change(function(){e.file=e.box.find(".fileUpload")[0].files[0],e.suffix=e.file.name.split(".").pop(),t&&t(e.suffix)})},n.prototype.stopPost=function(t){this.uploadOpt.abort(),t&&t()},e.register(n,"sliceUpload"),n}),define("framework.squire",["framework.core","exports"],function(t,e){function i(t,e){return this.box=t,this.data=e,this.clickCallback=$.noop,this.data=this.data?this.data:[],this.state=!0,this.template=$('<div class="quotaSquare"><i class="Squire-pic"></i><span class="quotaText"></span><i class="squireSel"></i></div>'),this.draw(),this}return i.isDom=!0,i.prototype.draw=function(){var t=this;this.data.allBackClass&&this.box.find(".quotaSquare").addClass(this.data.allBackClass),$(this.data.data).each(function(e,i){var n=t.template.clone(!0);return t.data.disabled&&n.addClass("disabled"),i.text?n.find(".quotaText").text(i.text):n.find(".quotaText").text(i),i.selected&&n.addClass("quotaSquare-select").siblings().removeClass("quotaSquare-select"),t.box.append(n),i.iconClass?(n.data("squire_data",i),void n.find(".Squire-pic").addClass(i.iconClass)):(n.find(".Squire-pic").hide(),void $(t.box).find(".quotaSquare span").eq(e).text(i))}),this.addListener()},i.prototype.addListener=function(){var t=this;this.box.find(".quotaSquare").click(function(){return t.data.disabled?!1:void(0!=t.state&&($(this).addClass("quotaSquare-select").siblings().removeClass("quotaSquare-select"),t.clickCallback($(this).find("span").text(),$(this).data("squire_data"))))})},i.prototype.setStatus=function(t){this.state=t,0==this.state&&(this.template.find(".iconSquire").addClass("squireSel_disabled").removeClass("squireSel"),this.box.find(".quotaSquare").each(function(t,e){$(e).hasClass("quotaSquare-select")&&$(this).addClass("quotaSquare-select-disabled")})),1==this.state&&(this.template.find(".iconSquire").removeClass("squireSel_disabled").addClass("squireSel"),this.box.find(".quotaSquare").each(function(t,e){$(e).hasClass("quotaSquare-select")&&$(this).removeClass("quotaSquare-select-disabled")}))},i.prototype.click=function(t){this.clickCallback=t},i.prototype.select=function(t){var e;return this.box.find(".quotaSquare").each(function(i,n){$(n).hasClass("quotaSquare-select")&&(t&&t($(n).text()),e=$(n).text())}),e},i.prototype.setSelect=function(t){this.box.find(".quotaSquare").each(function(e,i){$(i).text()!=t&&$(i).text!=t.toString()||($(this).addClass("quotaSquare-select"),$(this).siblings().removeClass("quotaSquare-select"))})},t.register(i,"squire"),this}),define("framework.switch",["exports","framework.core"],function(t,e){function i(t,e){return this.onTip=void 0,this.offTip=void 0,this.onLabel="ON",this.offLabel="OFF",this.disabled=!1,this.checked=!0,this.box=t,this.changeCallback=$.noop,this.container=$('<div class="ef-switch"><div><span class="ef-switch-dot"></span><span class="ef-switch-text"></span></div></div>'),this.init(e),this.addListener(),this}return i.isDom=!0,i.prototype.init=function(t){t&&(t.change&&(this.change(t.change),delete t.change),_.copyProperty(this,t)),this.draw()},i.prototype.addListener=function(){this.container.off();var t=this;this.container.click(function(){t.disabled||t.toSwitch(!t.checked)}),this.container.hover(function(){t.disabled&&$(this).find("div").tooltip("hide")})},i.prototype.change=function(t){return this.changeCallback=t,this},i.prototype.draw=function(){this.box.empty(),this.box.append(this.container),this.toSwitch(this.checked),this.setDisable(this.disabled)},i.prototype.toSwitch=function(t){this.checked=t,this.container.find("div").removeClass(),t?(this.container.find("div").addClass("ef-switch-on"),this.container.find(".ef-switch-text").text(this.onLabel),this.container.find("div").append(this.container.find(".ef-switch-dot"))):(this.container.find("div").addClass("ef-switch-off"),this.container.find(".ef-switch-text").text(this.offLabel),this.container.find("div").prepend(this.container.find(".ef-switch-dot"))),this.changeCallback(t),t&&this.onTip&&this.container.find("div").tooltip({content:this.onTip}),!t&&this.offTip&&this.container.find("div").tooltip({content:this.offTip})},i.prototype.setDisable=function(t){return this.disabled=t,t?this.container.find("div").addClass("ef-switch-disable"):this.container.find("div").removeClass("ef-switch-disable"),this},e.register(i,"switch"),i}),define("framework.terminal",["exports","framework.core"],function(t,e){function i(t,e){this.name="terminal",this.box=t,this.width=600,this.height=350,this.data=e,this.header=$('<h3 class="terminal_header"><a class="close"><img src="theme/default/images/messager_cancel_btn.png"/></a><span class="text"></span></h3>'),this.body=$('<div class="terminal_body"><textarea ></textarea></div>'),this.container=$('<div class="terminal"></div>'),this.data&&(this.width=e.width,this.height=e.height),this.draw(),this.addListener()}return i.isDom=!0,i.prototype.addListener=function(){this.header.find(".close").click(function(){$(".dialog-box").eq(0).window("close")}),$(this.container).keydown(function(t){27==t.keyCode&&$(".dialog-box").eq(0).window("close")})},i.prototype.draw=function(){this.box.empty(),this.body.height(this.height-this.header.height()),this.header.find(".text").text(this.data.title),this.body.find("textarea").html(this.data.content),this.container.append(this.header),this.container.append(this.body),this.container.width(this.width),this.box.append(this.container),this.body.find("textarea").focus(),t.util.setCaretPosition(this.body.find("textarea")[0],this.body.find("textarea").val().length)},e.register(i,"terminal"),i}),define("framework.tiles",["exports","framework.core"],function(t,e){function i(t,e,i){this.init(),_.copy(i,this.config),this.render()}return i.prototype.init=function(){this.config={column:3,row:2,isAuto:!0}},i.isDom=!0,i.prototype.render=function(){},e.register(i,"tiles"),i}),define("framework.timeline",["exports","framework.core"],function(t,e){function i(t,e){return this.box=t,this.container=$('<table class="timeline" cellspacing="0" cellpadding="0"></table>'),this.tr=$('<tr><td class="timeline-line"></td><td class="timeline-text"><p class="date"></p><p class="desc"></p></td><td class="timeline-operate"></td></tr>'),this.dot=$('<div class="timeline-dot"></div>'),e?(this.data=e.data,this.init(),this.setConfig(e.config),this.posX=this.config.rowWidth/2,this.posY=this.config.paddingTop,this.callback=$.noop,this.type={REVERT:"revert",CANCEL:"cancel"},this.build(),this):void 0}return i.isDom=!0,i.prototype.setConfig=function(t){if(t)for(var e in t)this.config[e]=t[e]},i.prototype.click=function(t){this.callback=t?t:this.callback},i.prototype.init=function(){this.config={rowHeight:100,rowWidth:50,paddingTop:10}},i.prototype.build=function(){this.box.append(this.container),this.createRow(),this.addListener()},i.prototype.createRow=function(){for(var t=0;t<this.data.length;t++){var e=this.tr.clone();e.data("data",this.data[t]),e.tooltip({position:"top",content:this.data[t].description}),this.container.append(e),e.find(".timeline-line").width(this.config.rowWidth),e.find(".timeline-line").height(this.config.rowHeight);var i=this.dot.clone();e.find(".timeline-line").append(i),e.find(".timeline-text .date").text(this.data[t].label),e.find(".timeline-text .desc").text(this.data[t].value),e.find(".timeline-operate").append('<a class="icon-btn icon-btn-resume" title="恢复"></a>'),e.find(".timeline-operate").append('<a class="icon-btn icon-btn-delete" title="删除"></a>')}},i.prototype.addListener=function(){var t=this;this.container.find("tr").hover(function(){$(this).find(".timeline-operate").show(),$(this).siblings().find(".timeline-operate").hide()},function(){$(this).find(".timeline-operate").hide()}),this.container.find(".timeline-operate").find("a").click(function(){var e=$(this).index();t.callback({type:0==e?t.type.REVERT:t.type.CANCEL,data:$(this).parent().parent().data("data"),index:$(this).parent().parent().index()})})},e.register(i,"timeline"),i}),define("framework.timer",["exports","framework.core"],function(t,e){function i(t,e,n,s,o){this.delay=t?t:2e3,this.callback=e?e:$.noop,this.interval=0,this.running=!1,this.count=0,this.moduleId=n,this.id=o?o:void 0,this.isDirectStart=Boolean(s),i._instances.push(this)}return i._intervals=[],i._instances=[],i.getCount=function(){return this._instances.length},i.getRuningCout=function(){return _.filter(this._instances,function(t){return t.running=!0})},i.stopAll=function(){_.each(this._instances,function(t){t.stop()})},i.get=function(t){return t?_.find(this._instances,function(e){return e.id==t}):void 0},i.stop=function(t){if(t){var e=this.get(t);e&&e.stop()}},i.destorySiblingsByModuleId=function(t){_.each(this._instances,function(e){e.moduleId&&t!=e.moduleId&&e.destory()})},i.destoryAllHasModule=function(){_.each(this._instances,function(t){t.moduleId&&t.destory()})},i._revokeAllInter=function(){_.each(this._intervals,function(t){clearInterval(t)})},i.destoryAll=function(){this._revokeAllInter(),this.stopAll(),_.each(this._instances,function(t){t.destory()})},i._revoke=function(t){this._instances=_.without(this._instances,t),t=null},i.prototype.addListener=function(t){this.callback=t||this.callback,this.interval&&(this.stop(),this.start())},i.prototype.start=function(t){this.running=!0;var e=this,n=arguments,s=function(){return n.length&&e.count>=t?void clearInterval(e.interval):(e.count++,void e.callback(e.count))};this.interval=setInterval(s,this.delay),this.isDirectStart&&s(),i._intervals.push(this.interval)},i.prototype.stop=function(){clearInterval(this.interval),this.running=!1},i.prototype.reset=function(){this.count=0,this.stop()},i.prototype.destory=function(){this.reset(),i._revoke(this)},e.register(i,"Timer"),i}),define("framework.togglebutton",["require","exports","framework.core"],function(t,e,i){function n(t,e,i){return this.box=t,this.data=e,this.position=-1,this.container=$('<ul class="toggle-button"></ul>'),this.template=$("<li></li>"),this.init(),this.draw(i),this}return t(["framework.iconmenu"]),n.isDom=!0,n.prototype.init=function(){if(!this.data||!this.data.length)throw new Error("wrong with param !ToggleButton");this.position=0,this.menus=[]},n.prototype.setStatus=function(t,e){return $(this.menus).each(function(i,n){n.iconmenu.setStatus(t,e)}),this},n.prototype.resize=function(t){var e=t.dom.width();e||(e=51*t.iconmenu.data.length),this.box.css({"min-width":e})},n.prototype.getMinWidth=function(t){return t.iconmenu.data.length},n.prototype.draw=function(t){this.box.empty(),this.container.empty(),this.box.append(this.container);var e=this;$(this.data).each(function(t,i){var n=e.template.clone(),s=n.iconmenu(i,!0);s.owner=e;var o=new e.Toggle;e.container.append(n),o.dom=n,o.iconmenu=s,o.dom.find("li").css({"text-align":"right"}),e.menus.push(o),t?n.hide():(n.show(),e.resize(o))})},n.prototype.setToggle=function(t){this.toggle=t},n.prototype["goto"]=function(t){if(!(0>t||t>this.data.length-1)){this.position=t;var e=this;$(this.menus).each(function(i,n){t==i?(n.dom.show(),e.resize(n)):n.dom.hide()})}},n.prototype.Toggle=function(){this.dom=null,this.iconmenu=null},i.register(n,"togglebutton"),n}),define("framework.topo",["exports","framework.core"],function(t,e){function i(t,e,i){this.width=0,this.height=0,this.isEdit=!1,this.isDrag=!1,this.isSelect=!1,this.posX=0,this.poxY=0,this.rows=[],this.cols=[],this.box=$(t),this.data=e,this.clickX=-1,this.clickY=-1,this.lastOverRow=!1,this.container=$('<div class="net-topo"></div>'),this.canvas=$("<canvas></canvas>"),this.context=this.canvas[0].getContext("2d"),this.init(),this.setConfig(i),this.render(),this.clickCallback=$.noop,this.changeCallback=$.noop,this.startRow=null,this.endRow=null;var n=this;return $(this.box).resize(function(){n._setCurrentData(),n.render()}),this}return i.isDom=!0,i.prototype.update=function(t,e){return t&&(this.data=t),this.init(),this.setConfig(e),this.render(),this},i.prototype._setCurrentData=function(){var t=this.getSelectedRows();$(this.data.columns).each(function(e,i){$(t).each(function(t,e){e.id==i.id&&(i.selected=!0)})})},i.prototype.render=function(){this.draw(),this.addListener()},i.prototype.getFormatTip=function(t){var e="<p>"+_.getLocale("topo.column.name.tip")+":"+(t.name||"")+" ",i=_.getLocale("topo.column.cidr.tip")+":"+(t.cidr||"")+"</p>",n="<p>"+_.getLocale("topo.column.gateway.tip")+":"+(t.gateway||"")+" ",s=_.getLocale("topo.column.ipuse.tip")+":"+(t.ip_use||0)+"/"+(t.ip_total||0)+"</p>",o=t.tenants||[],a="<p>"+_.getLocale("framework.topo.icon.tenant.tip")+":"+_.pluck(o,"name").join(",")+"</p>";
return e+i+n+s+a},i.prototype.removeListener=function(){this.hoverLayer.off()},i.prototype.clear=function(){this.removeListener(),this.container.empty(),this.box.empty(),this.canvas.empty(),this.width=this.getWidth(),this.height=this.getHeight(),this.posX=this.config.paddingLeft,this.posY=this.config.paddingTop,this.canvas.attr("width",this.width),this.canvas.attr("height",this.height)},i.prototype.isLastRows=function(t){return this.rows.length>t&&this.rows.length-t<3},i.prototype.addListener=function(){var t=this;this.hoverLayer.off(),this.hoverLayer.mousemove(function(e){var i=e.offsetX,n=e.offsetY,s=t.box.offset().left,o=t.box.offset().top,a=t.isIn(i,n),r=t.isIn(i,n,!0,!0);if(a){t.createOverRow(a),t.box.addClass("hovered");var c=t.container.tooltip("tip");if(c?c.show():null,c){c.find(".tooltip-content").html(t.getFormatTip(a.data));var h=n+o+30-t.box.scrollTop();c.css({left:i+s,top:h})}t.lastOverRow&&a!=t.lastOverRow&&!t.lastOverRow.selected&&t.createUpRow(t.lastOverRow),t.lastOverRow=a}else{var c=t.container.tooltip("tip");c?c.hide():null}a!=t.lastOverRow&&(t.createUpRow(t.lastOverRow),t.box.removeClass("hovered"),$(t.rows).each(function(e,i){i.selected&&t.createOverRow(i)})),t.isEdit&&(r&&!t.isSelect?t.createUpCol(r):t.clearUpCol(),t._isDragging&&t.createDashCol(i,n))}),this.hoverLayer.blur(function(e){e.offsetX,e.offsetY;t.lastOverRow&&(t.createUpRow(t.lastOverRow),t.box.removeClass("hovered")),$(t.rows).each(function(e,i){i.selected?t.createOverRow(i):t.createUpRow(i)}),t.clickX=-1,t.clickY=-1,t._isDragging=!1;var i=t.container.tooltip("tip");i.hide()}),this.hoverLayer.click(function(e){var i=t.container.tooltip("tip");if(i.hide(),t.isEdit){var n=e.offsetX,s=e.offsetY,o=t.isIn(n,s);o&&t.isSelect&&(o.selected=!o.selected,t.changeCallback(o),o.selected?t.iconLayer.find(".layer-icon").eq(o.index-1).show():t.iconLayer.find(".layer-icon").eq(o.index-1).hide())}}),this.hoverLayer.mousedown(function(e){var i=t.container.tooltip("tip");i.hide();var n=e.offsetX,s=e.offsetY;if(t.isEdit&&t.isDrag){var i=t.container.tooltip("tip");i.hide();var o=t.isIn(n,s,!0,!0);o&&!t.isSelect&&t.delCol(o),t.isSelect||(t._isDragging=!0);var n=e.offsetX,s=e.offsetY,a=t.isIn(n,s);a&&(t.clickX=n,t.clickY=s,t.startRow=a)}}),this.hoverLayer.mouseup(function(e){t.clickX=-1,t.clickY=-1,t._isDragging=!1;var i=e.offsetX,n=e.offsetY,s=t.isIn(i,n);if(!s&&!t.isSelect)return void t.clearDashCol();if(t.endRow=s,t.startRow&&t.endRow&&!t.isSelect){var o=t.container.tooltip("tip");o&&o.hide();var a={};a.from=t.startRow.data.id,a.to=t.endRow.data.id,a.status=1,t.redrawConn(a,i),t.render(),t.startRow=null,t.endRow=null}t.clearDashCol()}),this.hoverLayer.mouseout(function(e){var i=t.container.tooltip("tip");i?i.hide():null,t.clickX=-1,t.clickY=-1,t._isDragging=!1;var n=e.offsetX,s=e.offsetY,o=t.isIn(n,s);o||t.clearDashCol()}),this.hoverLayer.mouseleave(function(){var e=t.container.tooltip("tip");e?e.hide():null})},i.prototype.betweenDraw=function(t,e){if(console.log(t),this.data.items.length<=1)return void this.data.items.push(t);for(var i=-1,n=0;n<this.cols.length;n++){var s,o=this.cols[n].x;s=n!=this.cols.length-1?this.cols[n+1].x:1/0,e>=o&&s>e&&(i=n+1)}this.data.items.splice(i,0,t)},i.prototype.redrawConn=function(t,e){var i=!1;return t.from==t.to?i=!0:($(this.data.items).each(function(e,n){t.from==n.from&&t.to==n.to&&(1==n.twoway&&(n.twoway=0,n.status=1),i=!0),t.from==n.to&&t.to==n.from&&(1==n.twoway?n.twoway=0:n.twoway=1,n.status=1,i=!0)}),i||this.betweenDraw(t,e),i)},i.prototype.isIn=function(t,e,i,n,s){var o=!1,a=i?this.cols:this.rows;return $(a).each(function(i,a){var r=n?a.x-a.width/2:a.x,c=n?a.x1:a.x1,h=s?a.y:a.y,l=s?a.y1:a.y1,d=Math.min(r,c),p=Math.max(r,c),u=Math.min(h,l),f=Math.max(h,l);t>=d&&p>t&&e>=u&&f>e&&(o=a)}),o},i.prototype.init=function(){this._isDragging=!1,this.config={rowHeight:35,rowPadding:35,paddingLeft:10,paddingRight:10,buttonWidth:100,paddingTop:0,paddingBottom:0,colPadding:62,colWidth:10,labelWidth:130,arrowRadius:5},this.data.columns=this.data.columns||[],this["public"]={label:"Public",id:"public"};var t=!1;$(this.data.columns).each(function(e,i){"public"==i.id&&(t=!0)}),t||(this.data.columns=[].concat(this.data.columns)),this.rows=[],this.cols=[],this.data.items=this.data.items&&this.data.items.length?this.data.items:[]},i.prototype.setConfig=function(t){if(t)for(var e in t)this[e]=t[e],this.config[e]=t[e]},i.prototype.getWidth=function(){var t=0;return t=this.box.width()-this.config.paddingLeft-this.config.paddingRight,t<this.config.labelWidth+this.config.buttonWidth+50&&(t=this.config.labelWidth+this.config.buttonWidth+50),t},i.prototype.getHeight=function(){var t=0;t+=this.config.paddingTop+this.config.paddingBottom;var e=this;return $(this.data.columns).each(function(){t+=e.config.rowHeight+e.config.rowPadding}),t},i.prototype.draw=function(){this.data&&(this.container.empty(),this.box.empty(),this.canvas.empty(),this.width=this.getWidth(),this.height=this.getHeight(),this.posX=this.config.paddingLeft,this.posY=this.config.paddingTop,this.canvas.attr("width",this.width),this.canvas.attr("height",this.height),this.columnLayer=this.canvas.clone(),this.columnContext=this.columnLayer[0].getContext("2d"),this.textLayer=this.canvas.clone(),this.textContext=this.textLayer[0].getContext("2d"),this.iconLayer=$('<div style="position: absolute" class="icon-layer"></div>'),this.iconLayer.width(this.width),this.iconLayer.height(this.height),this.tipLayer=this.canvas.clone(),this.isEdit?this.tipLayer.show():this.tipLayer.hide(),this.tipContext=this.tipLayer[0].getContext("2d"),this.dragLayer=this.canvas.clone(),this.dragContext=this.dragLayer[0].getContext("2d"),this.hoverLayer=this.canvas.clone(),this.hoverContex=this.hoverLayer[0].getContext("2d"),this.leftIcon=$('<span style="position: absolute;z-index:10;" class="layer-icon"><img src="theme/default/images/topology_selected.png"/></span>'),this.button=$('<div style="position: absolute;z-index:10;" class="topo_button"><span data-tip="'+e.util.getLocale("framework.topo.icon.host.tip")+'" data-relation="host" class="hostlist"><img src="theme/default/images/master.png" /></span><span data-tip="'+e.util.getLocale("framework.topo.icon.ip.tip")+'" data-relation="ip" class="ipclude"><img src="theme/default/images/ip_range.png" /></span>'),this.box.append(this.container),this.container.append(this.canvas),this.container.append(this.columnLayer),this.container.append(this.textLayer),this.container.append(this.iconLayer),this.container.append(this.tipLayer),this.container.append(this.dragLayer),this.container.append(this.hoverLayer),e.util.setDepths([this.canvas,this.columnLayer,this.textLayer,this.iconLayer,this.tipLayer,this.dragLayer,this.hoverLayer]),this.createRows(),this.createCols(),this.container.tooltip({trackMouse:!0,onShow:function(){$(".tooltip-bottom").hide()}}),this._showOrHideButton(this.isEdit))},i.prototype.getRowById=function(t){var e=null;return $(this.rows).each(function(i,n){var s=n.data;s.id==t&&(e=n)}),e},i.prototype.ClickEvent=function(t){if(this.type="click",t)for(var e in t)this[e]=t[e];return this},i.prototype.createRows=function(){var t=this;this.rows=[],$(this.data.columns).each(function(e,i){var n=new t.Row;n.index=e,n.x=t.posX,n.y=e*(t.config.rowHeight+t.config.rowPadding),n.width=t.width,n.height=t.config.rowHeight,n.x1=n.x+n.width,n.y1=n.y+n.height,n.id=i.id,n.data=i,n.selected=Boolean(n.data.selected),t.rows.push(n),t.createUpRow(n),t.createText(n),t.createEditRow(n),n.selected&&t.createUpRow(n);var s=t.button.clone();s.selected=n.selected,s.css({left:n.x1-t.config.buttonWidth,top:n.y1-40}),t.container.append(s),s.find("span").click(function(e){t._setCurrentData(),e.stopPropagation();try{var i=t.container.tooltip("tip");i.hide()}catch(s){}var o=$(this).tooltip("tip");o.hide();var a=new t.ClickEvent;return a.originalEvent=e,a.targetIndex=$(this).index(),a.targetLabel=$(this).find("img").attr("title"),a.target=$(this),a.data=n.data,a.data.relation=$(this).attr("data-relation"),t.clickCallback(a),!1}),s.find("span").each(function(){var t=$(this).attr("data-tip");$(this).tooltip({content:t})}),s.find("span").hover(function(e){e.stopPropagation();try{var i=t.container.tooltip("tip");i.hide()}catch(n){}var s=$(this).attr("data-tip");$(this).tooltip({content:s})});var o=t.leftIcon.clone();o.css({left:n.x+5,top:n.y1-25}),t.iconLayer.append(o),n.selected&&t.isEdit&&o.show()})},i.prototype.createCols=function(){var t=this;this.cols=[];var e=this.width-this.config.paddingLeft-this.config.paddingRight-this.config.buttonWidth;e/=this.data.items.length,$(this.data.items).each(function(i,n){var s=new t.Col;t.cols.push(s);var o=t.getRowById(n.from),a=t.getRowById(n.to);if(o&&a){if(s.direction=o.y>a.y?0:1,s.index=i,s.width=t.config.colWidth,s.x=t.posX+t.config.labelWidth+i*e,!o||!a)throw new Exception("wrong with data");s.x1=s.x+s.width,s.direction?(s.y=o.y+t.config.rowHeight,s.y1=a.y1-t.config.rowHeight):(s.y=o.y,s.y1=a.y1),s.height=Math.floor(s.y1-s.y),s.data=n,t.createCol(s)}})},i.prototype.createCol=function(t,e,i){this.createArrowLine(t,e,i)},i.prototype.createDashCol=function(t,e){if(-1!=this.clickX||-1!=this.clickY){var i=new this.Col;i.x=this.clickX,i.y=this.clickY,i.x1=this.clickX,i.y1=e,i.width=this.config.colWidth,this.createArrowLine(i,this.hoverContex,!0,"#ff0000")}},i.prototype.clearDashCol=function(){this.startRow=null,this.endRow=null,this.hoverContex.clearRect(this.posX,this.posY,this.width,this.height)},i.prototype.createArrowLine=function(t,e,i,n){switch(e=e||this.columnContext,i&&e.clearRect(this.posX,this.posY,this.width,this.height),t.data.status){case 0:e.strokeStyle="#ff0000",e.fillStyle="#ff0000";break;default:e.strokeStyle="#1d8c63",e.fillStyle="#1d8c63"}n&&(e.strokeStyle=n,e.fillStyle=n),e.beginPath(),e.lineWidth=3,e.moveTo(t.x,t.y),n?e.dashedLineTo(t.x,t.y,t.x1,t.y1,5):e.lineTo(t.x,t.y1),e.stroke(),e.closePath();var s=t.y1>t.y;Math.min(t.y,t.y1),Math.max(t.y,t.y1);t.y!=t.y1&&(s?(this.createDownArrow(t.x,t.y1,e),"1"==t.data.twoway&&this.createUpArrow(t.x,t.y,e)):(this.createUpArrow(t.x,t.y1,e),"1"==t.data.twoway&&this.createDownArrow(t.x,t.y,e)))},i.prototype.createUpArrow=function(t,e,i){i=i||this.columnContext,i.lineWidth=2,i.beginPath(),i.moveTo(t,e),i.lineTo(t-5,e+5),i.lineTo(t+5,e+5),i.lineTo(t,e),i.stroke(),i.fill(),i.closePath()},i.prototype.createDownArrow=function(t,e,i){i=i||this.columnContext,i.lineWidth=2,i.beginPath(),i.moveTo(t,e),i.lineTo(t-5,e-5),i.lineTo(t+5,e-5),i.lineTo(t,e),i.stroke(),i.fill(),i.closePath()},i.prototype.createText=function(t){this.textContext.fillStyle="#333",this.textContext.font="14px bold 微软雅黑,Microsoft YaHei",this.textContext.beginPath();var e=t.x+25,i=(this.width-this.config.paddingLeft-this.config.paddingRight)/2;this.textContext.fillText(t.data.label,e,t.y+23),void 0!=t.data.location&&this.textContext.fillText(t.data.location,i,t.y+23),this.textContext.closePath()},i.prototype.createUpRow=function(t){t&&(this.context.clearRect(t.x,t.y,t.width,t.height),this.context.fillStyle="#e7e7e7",t.selected&&(this.context.fillStyle="#c1d7ff"),this.context.strokeStyle="#fff",this.context.beginPath(),this.context.moveTo(t.x,t.y),this.context.fillRect(t.x,t.y,t.width,t.height,5),this.context.strokeRect(t.x,t.y,t.width,t.height),this.context.closePath())},i.prototype.createOverRow=function(t){t&&(this.context.clearRect(t.x,t.y,t.width,t.height),this.context.fillStyle="#c1d7ff",this.context.strokeStyle="#a0c2d4",this.context.beginPath(),this.context.moveTo(t.x,t.y),this.context.fillRect(t.x,t.y,t.width,t.height),this.context.strokeRect(t.x,t.y,t.width,t.height),this.context.closePath())},i.prototype.createUpCol=function(t){t&&(this.dragContext.clearRect(t.x-t.width/2,t.y,t.width,t.height),this.dragContext.fillStyle="#ff1100",this.dragContext.globalAlpha=.2,this.dragContext.beginPath(),this.dragContext.moveTo(t.x-t.width/2,t.y),this.dragContext.fillRect(t.x-t.width/2,t.y,t.width,t.height,3),this.dragContext.closePath(),this.dragContext.globalAlpha=1,this.createCloseBtn(this.dragContext,t))},i.prototype.createCloseBtn=function(t,e){t.strokeStyle="#ff1100",t.circle(e.x,e.y+e.height/2,this.config.colWidth/2),t.fill(),t.closePath(),t.strokeStyle="#ffffff",t.globalAlpha=1,t.cross(e.x,e.y+e.height/2,e.width/2-2,!0),t.stroke()},i.prototype.clearUpCol=function(){this.dragContext.clearRect(this.posX,this.posY,this.width,this.height)},i.prototype.createEditRow=function(t){t&&(this.tipContext.clearRect(t.x,t.y,t.width,t.height),this.tipContext.strokeStyle="#919191",this.tipContext.dashStorkeRect(t.x,t.y,t.width,t.height,3))},i.prototype.Row=function(){this.x=0,this.y=0,this.x1=0,this.y1=0,this.width=0,this.height=0,this.data={},this.index=0,this.selected=!1,this.id=void 0},i.prototype.Col=function(){this.data={},this.x=0,this.y=0,this.x1=0,this.y1=0,this.width=0,this.height=0,this.index=0,this.direction=0},i.prototype.addRow=function(){},i.prototype.delRow=function(){},i.prototype.addCol=function(){},i.prototype.delCol=function(t){var e=$.inArray(t.data,this.data.items);-1!=e&&(this.data.items.splice(e,1),this.render())},i.prototype.setMode=function(t){this.isEdit=t,this.isEdit?this.tipLayer.show("fast"):this.tipLayer.hide(),this._showOrHideButton(this.isEdit)},i.prototype._showOrHideButton=function(t){this.container.find(".topo_button")[t?"hide":"show"]()},i.prototype.click=function(t){return t?(this.clickCallback=t,this):void 0},i.prototype.change=function(t){return t?(this.changeCallback=t,this):void 0},i.prototype.showConnectLine=function(t){return this.columnContext.clearRect(this.posY,this.posY,this.width,this.height),t&&this.createCols(),this},i.prototype.getIds=function(t){var e=[];return t=t?t:this.rows,$(t).each(function(t,i){e.push(i.id)}),e},i.prototype.getSelectedRows=function(){var t=[];return $(this.rows).each(function(e,i){i.selected&&(i.data.selected=!0,t.push(i.data))}),t},i.prototype.delCircle=function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(-1==$.inArray(n.from,e)||-1==$.inArray(n.to,e)){t.splice(i,1),arguments.callee(t,e);break}}},i.prototype.getSelectedData=function(){var t=this.getSelectedRows(),e=this.getIds(t);return this.data.columns=t,this.delCircle(this.data.items,e),this.data},e.register(i,"topo"),i}),define("framework.topoNew",["exports","framework.core"],function(t,e){function i(t,e,i){return this.box=t,this.config=i,this.data=e.data,this.template=$('<div class="ef-topoNew-content"></div>'),this.netTemplate=$('<div class="ef-topoNew-net-content"><div class="ef-topoNew-net name"></div><div class="ef-topoNew-net-slice"></div><div class="ef-topoNew-net brige"></div><div class="ef-topoNew-net-slice net-slice-vlan" style="width: 50px;"></div></div>'),this.vlanTemplate=$('<div class="ef-topoNew-vlan"></div>'),this.vlanSimpleTem=$('<div class="ef-topoNew-vlan-content"><div class="ef-topoNew-vlan-slice"></div><div class="ef-topoNew-vlan-name"></div><div class="ef-topoNew-host-slice-vlan"></div><div class="ef-topoNew-host-content"><div class="ef-topoNew-host-slice"></div><div class="ef-topoNew-host name"></div></div></div>'),this.contractTem=$('<ul class="ef-topo-contract"></ul>'),this.contractSimpleTem=$('<li class="ef-topo-contract-li"></li>'),this.vmTemplate=$('<div class="ef-topoNew-vm"><div class="ef-topoNew-vm-slice-host"></div><div class="ef-topoNew-vm-slice"></div><div class="ef-topoNew-vm-name"></div></div>'),this.draw(),this.subnetVmDom=null,this.sliceArray=[],this.subnet=null,this.vlanLength=0,this.index=0,this.count=0,this.hostCount=0,this.vmCount=0,this.heightValue=0,this.len=0,this.displayNone(),this}return i.isDom=!0,i.prototype.vmHover=function(t,i,n,s){var o,a=this,r=[];t.children(".ef-topoNew-list-simple-content").eq(n).hover(function(){$(this).css({color:"#43a8dc"}),o=e.util.map(s[n].network_info,function(t){return t.name}),e.util.map(a.box.find(".ef-topoNew-vlan-name"),function(t){$(o).each(function(e,i){i==$(t).text()&&(console.log($(t).text()),$(t).addClass("select"))})})},function(){$(this).css({color:"black"}),e.util.map(a.box.find(".ef-topoNew-vlan-name"),function(t){$(t).hasClass("select")&&$(t).removeClass("select")})}),t.children(".ef-topoNew-list-simple-content").eq(n).tooltip({rackMouse:!0,content:'<div><label>名称：</label><div style="width: 75%;" class="tooltip-name-show-wordspace">'+i.displayname+'</div></div><div class="ef-topoNew-vmTooltip-net"><label>网卡：</label><div class="ef-topoNew-vmTooltip-net-value"></div></div><div><label>配置：</label>'+i.cores+"核"+Number(i.memory_mb)/1024+"GB</div><div><label>宿主机：</label>"+i.host.name+'</div><div style="width: 100%;float:left;"><label>用户：</label><div class="ef-topoNew-vmTooltip-user-value"></div></div><div style="  height: 32px;float: left;width: 100%;"><label>项目：</label>'+i.tenant.name+"</div><div><label>状态：</label>"+a.state(i.state,"vm")+"</div>",onShow:function(){return $(this).tooltip("tip").addClass("topo-tooltip").addClass("vm-tooltip"),$(".ef-topoNew-vmTooltip-user-value").text(s[n].user.display_name?s[n].user.display_name:"-"),r.length=0,r=e.util.map(s[n].network_info,function(t){return t.ip+"("+t.name+")"}),$(".ef-topoNew-vmTooltip-net-value").empty(),0==r.length?void $(".ef-topoNew-vmTooltip-net-value").text("-"):($(r).each(function(t,e){var i=$("<div></div>");i.text(e),$(".ef-topoNew-vmTooltip-net-value").append(i)}),void $(this).tooltip("reposition"))}})},i.prototype.subnetHover=function(t,e,i){t.find(".ef-topoNew-list-simple-content").eq(i).find("div").tooltip({content:'<div><label>名称：</label><div class="tooltip-name-show-wordspace">'+e.name+"</div></div><div><label>CIDR：</label>"+e.cidr+"</div><div><label>网关：</label>"+e.gateway+"</div><div><label>IP占用：</label>"+e.ip_use+"/"+e.ip_total+"</div>",onShow:function(){$(this).tooltip("tip").addClass("topo-tooltip").addClass("subnet-tooltip")}})},i.prototype.vm=function(t,e){if(this.vmCount=0,0==t.length)return void this.box.find(".ef-topoNew-vm").remove();this.subnetVmDom.parent().append(this.vmTemplate),this.vmTemplate.find(".ef-topoNew-vm-name").empty();var i=this,n=$('<div style="margin-left: 110px;"></div>');if($(t).each(function(e,s){var o=$('<div class="ef-topoNew-list-simple-content"><span>'+s.name+"</span></div>");n.append(o),i.vmTemplate.find(".ef-topoNew-vm-name").append(n),i.vmHover(n,s,e,t)}),1==t.length&&(this.vmTemplate.find(".ef-topoNew-vm-slice").hide(),this.vmTemplate.find(".ef-topoNew-list-simple-content").addClass("one")),t.length>1&&t.length<=8){this.vmTemplate.find(".ef-topoNew-vm-slice").removeClass("max-length"),this.vmTemplate.find(".ef-topoNew-vm-slice").show();var s=this.vmTemplate.find(".ef-topoNew-vm-name").css("height");this.vmTemplate.find(".ef-topoNew-vm-slice").css({height:s}),this.vmTemplate.find(".ef-topoNew-list-simple-content").removeClass("one")}t.length>8&&(this.vmTemplate.find(".ef-topoNew-vm-slice").show(),this.vmTemplate.find(".ef-topoNew-vm-slice").addClass("max-length"),this.contract(t,8,"vm").addClass("vm"),i.vmTemplate.find(".ef-topoNew-vm-name").empty().append(this.contract(t,8,"vm")),this.vmTemplate.find(".ef-topoNew-list-simple-content").removeClass("one")),this.displayNone();var o=this.vmTemplate.parent().parent().parent().parent().parent().parent(),a=this.vmTemplate.parent().position().top,r=a+e,c=o.css("height").match(/[1-9][0-9]*/g),h=this.vmTemplate.parent().parent(),l=h.css("height").match(/[1-9][0-9]*/g);o.prev().find(".ef-topo-contract-li").children.length>1&&i.index%2==0&&0==i.indexPar&&o.prev().css({"padding-bottom":"30px"}),Number(l[0])-a<e&&o.removeClass("show-click").css({height:r+"px"}),0==i.heightValue&&(i.heightValue=c)},i.prototype.host=function(t,e){var i=this;t.find(".ef-topoNew-host.name").empty();var n=this.contractTem.clone(!0),s=i.contractSimpleTem.clone(!0);s.css({display:"block",height:"120px","overflow-y":"hidden"}),$(e).each(function(e,o){if(s.append($('<div class="ef-topoNew-list-simple-content"><div class="host_simple">'+o.name+'<span class="ef-topo-con-every-none" style="display: none;">'+o.id+"</span></div></div>")),o.vm_counts>0){var a=o.vm_counts;a>99&&(a="..."),s.append("<div class='ef-topoNew-list-simple-content-vm-count'>"+a+"</div>")}n.append(s),t.find(".ef-topoNew-host.name").append(n),i.subnetHover(s,o,e),"unavailable"==o.status&&t.find(".host_simple").eq(e).addClass("disabled")}),1==e.length&&(t.find(".ef-topoNew-host-slice").hide(),t.find(".ef-topoNew-host-content").css({height:0}),t.find(".ef-topoNew-host.name").css({"margin-top":0,"margin-left":0}),t.find(".ef-topoNew-host-slice-vlan").addClass("hei-change")),2!=e.length&&3!=e.length||(t.find(".ef-topoNew-host-content").css({height:"90px","margin-top":"-30px"}),t.find(".ef-topoNew-host-slice").css({"border-bottom":"1px solid #bfbfbf"})),2==e.length&&t.find(".ef-topoNew-host.name .ef-topoNew-list-simple-content").eq(1).css({"margin-top":"50px"}),e.length>3&&t.find(".ef-topoNew-host-content").append('<i class="icon-topo-show ef-host-btn"></i><i class="icon-topo-hide ef-host-btn" style="display: none"></i>'),e.length>6&&(t.find(".ef-topoNew-host.name").empty().append(this.contract(e,6,"host")),t.find(".ef-topo-contract").find(".ef-topo-con-every").addClass("host_simple")),t.find(".ef-topoNew-host.name").children(".ef-topo-contract").addClass("subnet")},i.prototype.typeChoose=function(t){return"host"==t?this.hostCount:this.vmCount},i.prototype.contractClick=function(t,e,i){var n=this;t.children(".icon-topo-page-turn-down").click(function(){if(t.hasClass("vm-content")){if(n.vmCount>i.length-2)return;n.vmCount==i.length-2&&($(this).hide(),$(this).siblings(".icon-topo-page-turn-down-disabled").show(),"vm"==e&&($(this).removeClass("icon-show-down-vm"),$(this).siblings(".icon-topo-page-turn-down-disabled").addClass("icon-show-down-vm"))),n.vmCount++,t.children("li").eq(n.vmCount).show().siblings("li").hide()}else{if(n.hostCount>i.length-2)return;n.hostCount==i.length-2&&($(this).hide(),$(this).siblings(".icon-topo-page-turn-down-disabled").show(),"vm"==e&&($(this).removeClass("icon-show-down-vm"),$(this).siblings(".icon-topo-page-turn-down-disabled").addClass("icon-show-down-vm"))),n.hostCount++,t.children("li").eq(n.hostCount).show().siblings("li").hide()}$(this).siblings(".icon-topo-page-turn-up-disabled").hide(),$(this).siblings(".icon-topo-page-turn-up").show(),"vm"==e&&($(this).siblings(".icon-topo-page-turn-up-disabled").removeClass("icon-show-up-vm"),$(this).siblings(".icon-topo-page-turn-up").addClass("icon-show-up-vm"))}),t.children(".icon-topo-page-turn-up").click(function(){if(t.hasClass("vm-content")){if(n.vmCount<1)return;1==n.vmCount&&($(this).hide(),$(this).siblings(".icon-topo-page-turn-up-disabled").show(),"vm"==e&&($(this).removeClass("icon-show-up-vm"),$(this).siblings(".icon-topo-page-turn-up-disabled").addClass("icon-show-up-vm"))),n.vmCount--,t.children("li").eq(n.vmCount).show().siblings("li").hide()}else{if(n.hostCount<1)return;1==n.hostCount&&($(this).hide(),$(this).siblings(".icon-topo-page-turn-up-disabled").show(),"vm"==e&&($(this).removeClass("icon-show-up-vm"),$(this).siblings(".icon-topo-page-turn-up-disabled").addClass("icon-show-up-vm"))),n.hostCount--,t.children("li").eq(n.hostCount).show().siblings("li").hide()}$(this).siblings(".icon-topo-page-turn-down-disabled").hide(),$(this).siblings(".icon-topo-page-turn-down").show(),"vm"==e&&($(this).siblings(".icon-topo-page-turn-down-disabled").removeClass("icon-show-down-vm"),$(this).siblings(".icon-topo-page-turn-down").addClass("icon-show-down-vm"))})},i.prototype.contract=function(t,e,i){this.hostCount=0,this.vmCount=0;var n=this.contractTem.clone(!0);"vm"==i?n.addClass("vm-content"):n.addClass("sunbet-content"),n.append('<i class="icon-topo-page-turn-up-disabled" style="display: none;"></i>').append('<i class="icon-topo-page-turn-up" style="display: none;"></i>');var s=this,o=this.getSliceArray(t,e);return $(o).each(function(t,e){var o=s.contractSimpleTem.clone(!0);$(e).each(function(t,n){if(o.append('<div class="ef-topoNew-list-simple-content"><div class="ef-topo-con-every"><span>'+n.name+'</span><span class="ef-topo-con-every-none" style="display: none;">'+n.id+"</span></div></div>"),"host"==i&&(s.subnetHover(o,n,t),n.ip_use>1)){var a=Number(n.ip_use)-1;o.append("<div class='ef-topoNew-list-simple-content-vm-count'>"+a+"</div>")}"vm"==i&&s.vmHover(o,n,t,e)}),n.append(o)}),n.append('<i class="icon-topo-page-turn-down" style="display: none;"></i>'),n.append('<i class="icon-topo-page-turn-down-disabled" style="display: none;"></i>'),s.contractClick(n,i,o),"vm"==i&&(n.children("li").addClass("vm-li"),n.children(".icon-topo-page-turn-up-disabled").addClass("icon-show-up-vm"),n.children(".icon-topo-page-turn-down").addClass("icon-show-down-vm")),n},i.prototype.getSliceArray=function(t,e){var i=this;i.sliceArray=[];for(var n=0;n<Math.ceil(t.length/e);n++){var s=n*e,o=s+e;i.sliceArray.push(t.slice(s,o))}return this.sliceArray},i.prototype.state=function(t,e){switch(e){case"vlan":return"ACTIVE"==t?"<div style='color: green'>可用</div>":"<div style='color: red'>不可用</div>";case"vm":if("stopped"==t)return"<div style='color: gray'>停止</div>";if("error"==t)return"<div style='color: red'>异常</div>";if("active"==t)return"<div style='color: green'>运行</div>";if("wait_create"==t)return"<div style='color: #d19b40'>等待创建</div>";if("creating"==t)return"<div style='color: #d19b40'>创建中</div>";if("building"==t)return"<div style='color: #d19b40'>创建中</div>";if("powering-on"==t)return"<div style='color: #d19b40'>开机中</div>";if("powering-off"==t)return"<div style='color: #d19b40'>关机中</div>";if("rebooting"==t)return"<div style='color: #d19b40'>重启中</div>";if("snapshoting"==t)return"<div style='color: #d19b40'>快照中</div>";if("recovering"==t)return"<div style='color: #d19b40'>恢复中</div>";if("deleting"==t)return"<div style='color: #d19b40'>删除中</div>";if("migrating"==t)return"<div style='color: #d19b40'>迁移中</div>";if("uploading"==t)return"<div style='color: #d19b40'>上传镜像中</div>";if("preparation"==t)return"<div style='color: #d19b40'>准备中</div>";if("wait_boot"==t)return"<div style='color: #d19b40'>等待启动</div>";if("wait_reboot"==t)return"<div style='color: #d19b40'>等待重启</div>"}},i.prototype.draw=function(){this.box.empty();var t=this;$(this.data).each(function(e,i){var n=t.template.clone(!0),s=t.netTemplate.clone(!0),o=t.vlanTemplate.clone(!0);return s.find(".ef-topoNew-net.name").text(i.name),s.find(".ef-topoNew-net.brige").text(i.brige),s.find(".ef-topoNew-net.brige").tooltip({content:"<div><label>网桥：</label>"+i.brige+"</div><div><label>网卡：</label>"+i.nic+"</div>",onShow:function(){$(this).tooltip("tip").addClass("topo-tooltip").addClass("brige-tooltip")}}),n.append(s),t.box.append(n),i.vlan&&0!=i.vlan.length?(n.append(o),2==i.vlan.length&&n.find(".ef-topoNew-net-content").css({"margin-top":"50px"}),i.vlan.length>=3&&n.find(".ef-topoNew-net-content").css({"margin-top":"80px"}),void $(i.vlan).each(function(e,i){var s=t.vlanSimpleTem.clone(!0);return s.find(".ef-topoNew-vlan-name").text(i.name),"UNACTIVE"==!i.status&&(s.find(".ef-topoNew-vlan-slice").addClass("slice-disabled"),s.find(".ef-topoNew-vlan-name").addClass("disabled"),s.find(".ef-topoNew-host-slice-vlan").addClass("slice-disabled")),s.find(".ef-topoNew-vlan-name").tooltip({content:'<div><label>名称：</label><div class="tooltip-name-show-wordspace" style="width: 64%">'+i.name+"</div></div><div><label>类型：</label>"+i.vlan_type.toUpperCase()+"</div><div><label>物理网络：</label>"+i.phy_network+"</div><div><label>VLAN ID：</label>"+i.vlan_id+"</div><div><label>状态：</label>"+t.state(i.status,"vlan")+"</div>",onShow:function(){$(this).tooltip("tip").addClass("topo-tooltip").addClass("vlan-tooltip")}}),n.find(".ef-topoNew-vlan").append(s),i.subnets&&0!=i.subnets.length?void t.host(s,i.subnets):(s.find(".ef-topoNew-host-slice-vlan").hide(),void s.find(".ef-topoNew-host-content").hide())})):void n.find(".net-slice-vlan").hide()}),this.box.find(".ef-topoNew-vlan-content").each(function(t,e){console.log(t,e);var i=$(e).children(".ef-topoNew-host-slice-vlan");t%2!=0?(i.addClass("change"),console.log(i)):i.css({width:"100px;"})}),this.showClick(),this.hideClick()},i.prototype.showClick=function(){var t=this;this.box.find(".icon-topo-show").click(function(){t.count=0;var e=$(this).parent().parent();$(this).prev().find("li").addClass("show-click"),$(this).prev().addClass("show-click"),$(this).parent().addClass("show-click"),e.addClass("show-click"),$(this).hide(),$(this).siblings(".icon-topo-hide").show(),e.siblings().find(".ef-topoNew-host-content").removeClass("show-click"),e.siblings().removeClass("show-click"),e.siblings().find(".ef-topoNew-host.name").children("ul").children("li").removeClass("show-click"),$(this).siblings(".ef-topoNew-host.name").children("ul").children(".icon-topo-page-turn-up-disabled").show(),$(this).siblings(".ef-topoNew-host.name").children("ul").children(".icon-topo-page-turn-down").show(),$(e.siblings().find(".ef-topoNew-host.name").children("ul")).each(function(t,e){$(e).hasClass("subnet")&&$(e).children().length>2&&($(e).has("i").get(0)?$(e).find("li:nth-child(3)").show().siblings().hide():$(e).find("li:nth-child(1)").show().siblings().hide())}),e.siblings().find(".ef-topoNew-host.name").children("ul").children(".icon-topo-page-turn-up-disabled").hide(),e.siblings().find(".ef-topoNew-host.name").children("ul").children(".icon-topo-page-turn-up").hide(),e.siblings().find(".ef-topoNew-host.name").children("ul").children(".icon-topo-page-turn-down-disabled").hide(),e.siblings().find(".ef-topoNew-host.name").children("ul").children(".icon-topo-page-turn-down").hide(),e.siblings().find(".ef-topoNew-host.name").removeClass("show-click"),e.siblings().find(".icon-topo-hide").hide(),e.siblings().find(".icon-topo-show").show(),e.siblings().find(".host_simple").removeClass("click")})},i.prototype.hideClick=function(){var t=this;this.box.find(".icon-topo-hide").click(function(){e.util.map(t.box.find(".ef-topoNew-vlan-content"),function(t){$(t).prev().css({"padding-bottom":0}),$(t).has(".ef-topoNew-vm").get(0)&&$(t).css({height:"auto"})}),t.box.find(".host_simple").removeClass("click").removeClass("select"),t.box.find(".ef-topoNew-vm").remove(),t.heightValue=0,t.hostCount=0,$(this).prevAll(".ef-topoNew-host.name").children("ul").children("li").removeClass("show-click"),$(this).prevAll(".ef-topoNew-host.name").removeClass("show-click"),$(this).parent().removeClass("show-click"),$(this).parent().parent().removeClass("show-click"),$(this).parent().parent().css({height:"125px"}),$(this).hide(),$(this).siblings(".icon-topo-show").show(),$(this).prevAll(".ef-topoNew-host.name").children("ul").children("li").hide(),$(this).prevAll(".ef-topoNew-host.name").children("ul").has("i").get(0)?$(this).prevAll(".ef-topoNew-host.name").children("ul").children("li:nth-child(3)").show():$(this).prevAll(".ef-topoNew-host.name").children("ul").children("li:nth-child(1)").show(),$(this).siblings(".ef-topoNew-host.name").children("ul").children(".icon-topo-page-turn-up-disabled").hide(),$(this).siblings(".ef-topoNew-host.name").children("ul").children(".icon-topo-page-turn-up").hide(),$(this).siblings(".ef-topoNew-host.name").children("ul").children(".icon-topo-page-turn-down").hide(),$(this).siblings(".ef-topoNew-host.name").children("ul").children(".icon-topo-page-turn-down-disabled").hide()})},i.prototype.subnetClick=function(t){var i=this;this.box.find(".host_simple").click(function(){if($(this).hasClass("click"))return $(this).removeClass("click"),$(this).next().remove(),$(this).siblings().removeClass("select"),$(this).parent().parent().parent().parent().parent().parent().css({height:"auto"}),void(i.heightValue=0);e.util.map(i.box.find(".ef-topoNew-vlan-content"),function(t){$(t).prev().css({"padding-bottom":0}),$(t).has(".ef-topoNew-vm").get(0)&&$(t).css({height:"auto"})});var n=$(this),s=n.parent().parent().parent().parent().parent().parent();i.vlanLength=Math.ceil(s.parent().children().length/2),i.index=s.parent().children().index(s),i.indexPar=$(this).parent().parent().children().index($(this).parent()),i.subnetVmDom=n,i.subnet=n.children(".ef-topo-con-every-none").text(),i.box.find(".host_simple").removeClass("click"),n.addClass("click"),
t(i.subnet)})},i.prototype.displayNone=function(){var t=this;this.box.find(".vm-li").find(".ef-topo-con-every").click(function(t){t.stopPropagation()}),this.box.find(".ef-topoNew-vm").find("i").click(function(t){t.stopPropagation()}),this.box.find(".ef-topoNew-vm").find(".ef-topoNew-list-simple-content").click(function(t){t.stopPropagation()}),this.box.find(".host_simple").click(function(t){t.stopPropagation()}),this.box.find(".icon-topo-hide").click(function(){event.stopPropagation()}),$(document).bind("click",function(){e.util.map(t.box.find(".ef-topoNew-vlan-content"),function(t){$(t).prev().css({"padding-bottom":0}),$(t).has(".ef-topoNew-vm").get(0)&&($(t).css({height:"auto"}),"none"==$(t).find(".icon-topo-show").css("display")&&$(t).addClass("show-click"))}),t.box.find(".host_simple").removeClass("click").removeClass("select"),t.box.find(".ef-topoNew-vm").remove(),t.heightValue=0})},e.register(i,"topoNew"),i}),define("framework.upload",["exports","framework.core"],function(t,e){function i(t,e){return e?(this.box=t,this.config=e,this.label=e.label||_.getLocale("framework.upload.label.text"),this.filters=e.filters||["."],this.container=$('<div class="ef-upload"><form><div class="ef-upload-elements"></div><div class="ef-upload-state-box"><span class="upload-state"></span><span class="ef-upload-file-span"><span class="ef-upload-file-text"><i></i></span><input type="file" class="ef-upload-file"></span></div></form></div>'),this.ajax=null,this.state="unselect",this.init(),this.addListener(),this):void 0}return i.isDom=!0,i.prototype.addListener=function(){var t=this;this.uploadBtn.click(function(){return t.input.val()?t.isValid()?(t.changeState("uploading"),t.getElementsValue(),void(t.ajax=e.getJSON({isFormData:!0,form:t.form,async:!1,cache:!1,contentType:!1,processData:!1,url:t.config.url,type:t.config.type,isUpload:!0,success:function(e){t.changeState("success"),t.successCallback(e),t.input.val("")},error:function(e){t.changeState("fail"),t.failCallback(e),t.input.val("")}}))):void e.placard.warn(_.getLocale("framework.component.upload.element.valid")):void e.placard.warn(_.getLocale("framework.component.upload.toselect"))}),this.cancelBtn.click(function(){"uploading"==t.state&&t.ajax.abort(),t.changeState("unselect")}),this.input.change(function(e){var i=$(this).val();return i?t.validType()?(t.selectCallback(i),void t.changeState("selected",i)):(t.changeState("selectfail",t.filters.join(", *"),!0),void $(this).val("")):void t.changeState("unselect")}),this.input.click(function(){"success"!=t.state&&"fail"!=t.state||t.changeState("unselect")}),this.deleteBtn.click(function(){t.input.change(),t.changeState("unselect")}),this.stateDom.find("i").click(function(){($(this).hasClass("ef-upload-icon-fail")||$(this).hasClass("ef-upload-icon-success"))&&t.changeState("unselect")})},i.prototype.changeState=function(t,e){switch(this.state=t,this.stateDom.find(".upload-state").text(_.getLocale("framework.component.upload.state."+t,e)),this.stateDom.find(".upload-state").attr("title",this.stateDom.text()),this.stateDom.removeClass(),this.stateDom.addClass("ef-upload-state-box").addClass("ef-upload-state-"+t),this.stateDom.find("i").removeClass(),this.stateDom.find("i").addClass("ef-upload-icon-"+t),t){case"unselect":this.input.val("")}},i.prototype.validType=function(){var t=$.trim(this.input.val());if(!t.length)return!1;var e=[];$(this.filters).each(function(t,i){e.push("("+i+")")});var i=new RegExp(e.join("|")+"$","g");return i.test(t)},i.prototype.init=function(){this.elements=[],this.box.append(this.container),this.fileId=this.config.id||"file",this.form=this.container.find("form"),this.input=this.form.find("input[type='file']"),this.input.attr("name",this.fileId),this.input.attr("id",this.fileId),this.uploadBtn=this.box.next().find("span.upload_ok"),this.cancelBtn=this.form.find("i.ef-upload-cancel"),this.deleteBtn=this.form.find("button.ef-upload-delete"),this.config.formElements&&this.createElements(this.config.formElements),this.selectCallback=this.config.select||$.noop,this.uploadCallback=this.config.upload||$.noop,this.cancelCallback=this.config.cancel||$.noop,this.deleteCallback=this.config["delete"]||$.noop,this.successCallback=this.config.success||$.noop,this.failCallback=this.config.fail||$.noop,this.stateDom=this.form.find(".ef-upload-state-box"),this.changeState("unselect")},i.prototype.createElements=function(t){var e=this;_.isArray(t)&&$(t).each(function(t,i){e.createElement(i)})},i.prototype.createElement=function(t){var e=$('<div class="ef-upload-element"><input class="ef-ele"><input type="hidden" class="ef-input-hidden"></div>'),i=e.find("input.ef-input-hidden:hidden");i.attr("name",t.id),e.find("input.ef-ele")[t.type](t),this.form.find(".ef-upload-elements").append(e);var n=new this.Element;n.dom=e.find("input.ef-ele"),n.option=t,n.input=i,this.elements.push(n)},i.prototype.Element=function(){this.dom=null,this.option=null,this.input=null},i.prototype.isValid=function(){if(!this.elements.length)return!0;var t=!0;return $(this.elements).each(function(e,i){var n=i.dom[i.option.type]("isValid");n||(t=n)}),t},i.prototype.getElementsValue=function(){var t={};return $(this.elements).each(function(e,i){var n=i.dom[i.option.type]("getValue");i.input.val(n),t[i.option.id]=n}),t},i.prototype.onSelect=function(t){this.selectCallback=t||this.selectCallback},i.prototype.onUpload=function(t){this.uploadCallback=t||this.uploadCallback},i.prototype.onCancel=function(t){this.cancelCallback=t||this.cancelCallback},i.prototype.onDelete=function(t){this.deleteCallback=t||this.deleteCallback},i.prototype.onSuccess=function(t){this.successCallback=t||this.successCallback},i.prototype.onFail=function(t){this.failCallback=t||this.failCallback},i.prototype.upload=function(){this.uploadCallback()},i.prototype.cancel=function(){this.cancelCallback()},i.prototype["delete"]=function(){this.deleteCallback()},i.prototype.success=function(){this.changeState("success")},i.prototype.fail=function(){this.changeState("fail")},e.register(i,"upload"),i}),define("framework.uploadLoading",["framework.core","exports"],function(t,e){function i(t,e){return this.box=t,this.data=e,this.clickCallback=$.noop,this.data=this.data?this.data:[],this.template=$('<div class="loading-back"><div class="loading-float"></div></div>'),this.backWidth=0,this.draw(),this}return i.isDom=!0,i.prototype.draw=function(){this.box.append(this.template),this.backWidth=this.box.find(".loading-back").css("width").replace(/[^0-9]+/g,""),this.transform()},i.prototype.transform=function(){if(this.data.value){var t=this.data.value/100*this.backWidth;this.box.find(".loading-float").css({width:t})}this.data.onChange&&this.data.onChange(this.data.value)},i.prototype.setValue=function(t){this.data.value=t,this.transform()},t.register(i,"uploadLoading"),this}),define("framework.util",["require","exports","underscore","framework.cidr"],function(t,e,i,n){return i.isClass=function(t,e){return t instanceof e},i.sum=function(t){if(!this.isArray(t))return!1;var e=0;return this.each(t,function(t){e+=t}),e},i.arg2arr=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e.push(t[i]);return e},i.isServer=function(t){if(!t)throw new Error("wrong with param in _.isServer");return t.isForce?!0:t.useLocal||t.isLocal||!ef.config.isServer?!1:ef.config.isServer},i.copyProperty=function(t,e){if(t&&e){for(var i in e)t[i]=e[i];return t}},i.copy=function(t,e){return this.copyProperty(e||{},t)},i.dcopy=function(t){return this.copyDeepProperty(t)},i.radix2=function(t){var e=2;return Number(t).toString(Number(e))},i.radix10=function(t,e){return e=e||2,parseInt(t,e)},i.copyDeepProperty=function(t){return t?JSON.parse(JSON.stringify(t)):null},i.getInitRandom=function(t){return Math.floor(Math.random()*t)},i.getUUID=function(){var t=new Date,e=t.getTime(),i=this.getInitRandom(1e8);return e+"_"+i},i.getRandomArrs=function(t){var e=this.getInitRandom(t.length);0==e&&(e=1);for(var i=t.concat([]),n=[],s=0;e>s;s++){var o=this.getInitRandom(i.length);n.push(i[o]),i.splice(o,1)}return n},i.getInterNum=function(t){t=Math.abs(Math.floor(t));var e=String(t).length;if(1>=e)return t;for(var i=e-1,n=String(t).substr(0,1),s=0;i>s;s++)n+=String("0");return Math.floor(Number(n)/10)},i.escapeJSON=function(t){return t?escape(t):void 0},i.unescapeJSON=function(t){return t?unescape(t):void 0},i.formatPageData=function(t){return t?this.escapeJSON(JSON.stringify(t)):null},i.getCrossData=function(t){var e=t.data("pageData");return e?JSON.parse(this.unescapeJSON(e)):null},i.getCrossId=function(t){return t.data("pageData")},i.formatComboxData=function(t){return this.map(t,function(t,e){return{label:t,value:t,index:e}})},i.getKeys=function(t){var e=[];if(!t)return e;for(var i in t)e.push(i);return e},i.isIE=function(){return navigator.userAgent.indexOf("MSIE")>0},i.isFirefox=function(){return navigator.userAgent.indexOf("Firefox")>0},i.isSafari=function(){return navigator.userAgent.indexOf("Safari")>0&&!this.isChrome()},i.isChrome=function(){return navigator.userAgent.indexOf("Chrome")>0},i.sort=function(t,e,i){if(e){var n=this.sortBy(e,t);return i?n.reverse():null,n}},i.sortNum=function(t,e){return t.sort(function(t,i){return e?t-i:i-t})},i.valueInRange=function(t,e){if(!this.isNumber(t))return!1;if(!this.isArray(e))return!1;if(2!=e.length)return!1;var n=!0;return $(e).each(function(t,e){i.isNumber(e)||(n=!1)}),n?t>=e[0]&&t<=e[1]:!1},i.getValues=function(t){var e=[];if(!t)return e;for(var i in t)e.push(t[i]);return e},i.noRight=function(t,e,i){return t?i?!1:-1==$.inArray(t,e):!1},i.getPageData=function(t){return $("._temp_data_cont___").data(t)},i.getPageId=function(){return $("._temp_data_cont___").data("pageId")},i.getCursortPosition=function(t){var e=0;if(document.selection){t.focus();var i=document.selection.createRange();i.moveStart("character",-t.value.length),e=i.text.length}else if(t.selectionStart||"0"==t.selectionStart)return e=t.selectionStart},i.resize=function(t){return $(ef.root).resize(t)},i.setCaretPosition=function(t,e){if(t.setSelectionRange)t.focus(),t.setSelectionRange(e,e);else if(t.createTextRange){var i=t.createTextRange();i.collapse(!0),i.moveEnd("character",e),i.moveStart("character",e),i.select()}},i.getBrowserLang=function(){return $.i18n.browserLang()},i.getBrowserLangAbbr=function(){return this.getBrowserLang().split("-")[0]},i.getCidr=function(t,e,i){return new n(t,null,e,i)},i.getLocale=function(t,e){return $.i18n.prop.apply(null,this.arg2arr(arguments))},i.close=function(t,e){var i=$(t).dialog("close");e&&(i.remove(),i=null)},i.isInt=function(t){return this.isNumber(t)?t==Math.floor(t):!1},i.b2kb=function(t,e,i){return this.kb2mb.apply(this,arguments)},i.kb2b=function(t,e,i){return this.mb2kb.apply(this,arguments)},i.mb2kb=function(t,e,i){if(!this.isNumber(t))return!1;i=i||1024;var n=t*i;return this.isInt(n)?n:e?n.toFixed(e):n},i.gb2mb=function(t,e,i){return this.mb2kb.apply(this,arguments)},i.kb2mb=function(t,e,i){if(!this.isNumber(t))return!1;i=i||1024;var n=t/i;return this.isInt(n)?n:e?n.toFixed(e):n},i.mb2gb=function(t,e,i){return this.kb2mb.apply(this,arguments)},i.kb2gb=function(t,e,i){return this.mb2gb(this.kb2mb(t,e),e)},i.gb2kb=function(t,e,i){return this.mb2kb(this.gb2mb(t,e),e)},i.gb2tb=function(t,e,i){return this.kb2mb.apply(this,arguments)},i.kb2kb=function(t){return t},i.mb2mb=function(t){return t},i.gb2gb=function(t){return t},i.tb2tb=function(t){return t},i.getKGM=function(t,e){e=e||1024;var i=[e,e*e,e*e*e];return this.isNumber(t)?this.isLt(t,i[0])?"k":this.isBetween(t,[i[0],i[1]],!0)?"m":this.isBetween(t,[i[1],i[2]],!0)?"g":this.isGt(t,i[2],!0)?"t":void 0:!1},i.getBKGM=function(t,e){e=e||1024;var i=[e,e*e,e*e*e,e*e*e*e];return this.isNumber(t)?this.isLt(t,i[0])?"b":this.isBetween(t,[i[0],i[1]],!0)?"k":this.isBetween(t,[i[1],i[2]],!0)?"m":this.isBetween(t,[i[2],i[3]],!0)?"g":this.isGt(t,i[3],!0)?"t":void 0:!1},i.format1024=function(t){var e,i,n,s={b:1,k:1024,m:1048576,g:1073741824,t:1099511627776};return e=this.getBKGM.call(this,t),i=s[e],e&&i?(n="b"==e?String(e).toUpperCase():String(e).toUpperCase()+"B",{value:this.kb2mb.call(this,t,null,i),unit:n}):!1},i.trans=function(t,e,i,n){if(arguments.length<3||e==i)return t;switch(e=e.toLowerCase(),i=i.toLowerCase(),e){case"k":if("m"==i)return this.kb2mb.apply(this,[t,n]);if("g"==i)return this.kb2gb.apply(this,[t,n]);break;case"m":if("k"==i)return this.mb2kb.apply(this,[t,n]);if("g"==i)return this.mb2gb.apply(this,[t,n]);break;case"g":if("k"==i)return this.gb2kb.apply(this,[t,n]);if("m"==i)return this.gb2mb.apply(this,[t,n])}return t},i.toTransUnit=function(t,e,i){var n=this.getKGM(e);switch(n){case"k":return this.isInt(t)?t:t.toFixed(2);case"m":return this.kb2mb(t,i);case"g":return this.kb2gb(t,i);default:return!1}},i.isLt=function(t,e,i){return i?e>=t:e>t},i.isGt=function(t,e,i){return i?t>=e:t>e},i.isBetween=function(t,e,i,n){return arguments.length<2||!this.isArray(e)||2!=e.length?!1:(i?t>=e[0]:t>e[0])&&(n?t<=e[1]:t<e[1])},i.isValidTime=function(t){if(this.isDate(t))return t;var e=/Z$/;this.isFirefox()&&!this.isNumber(t)&&(e.test(t)||(t=String(t).replace(/-/g,"/")));var i=new Date(t);return"Invalid Date"==i?!1:i},i.number2time=function(t,e,i){return this.formatTime(t,e,i)},i.formatTime=function(t,e,n){var s=this.isValidTime(t);if(!s)return s;this.isNumber(t)&&n&&(s=new Date(this.time2numberMillSecond(t)));var o=s.getFullYear(),a=i.preppendChar(s.getMonth()+1,"0",2),r=i.preppendChar(s.getDate(),"0",2),c=i.preppendChar(s.getHours(),"0",2),h=i.preppendChar(s.getMinutes(),"0",2),l=i.preppendChar(s.getSeconds(),"0",2),d=i.preppendChar(s.getMilliseconds(),"0",3),p=s.getDay(),u={Y:o,M:a,D:r,h:c,m:h,s:l,i:d,w:p,t:s.getTime()};e=e||"Y-M-D h:m:s";for(var f in u){var g=new RegExp(f,"g");e=e.replace(g,u[f])}return e},i.time2number=function(t,e){var i=this.isValidTime(t);if(!i)return 0;var n=i.getTime(),s=String(n).length;return s==e?Number(n):s>e?Number(String(n).substr(0,e)):Number(this.appendChar(String(n),"0",e))},i.time2numberSecond=function(t){return this.time2number(t,10)},i.time2numberMillSecond=function(t){return this.time2number(t,13)},i.preppendChar=function(t,e,i){return t=String(t),t.length>=i?t:(t=e+t,t.length<i?arguments.callee(t,e,i):t)},i.appendChar=function(t,e,i){return t=String(t),t.length>=i?t:(t+=e,t.length<i?arguments.callee(t,e,i):t)},i.formatDate=function(t){},i.setDepths=function(t){t&&t.length&&$(t).each(function(t,e){$(e).css({"z-index":t+1})})},i.isValidIp=function(t){var e=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;return e.test(t)},i.getIpSufix=function(t){if(!this.isValidIp(t))return null;var e=/^((\d{1,3}\.){2}(\d{1,3})\.)/;return t.replace(e,"")},i.getIpFirst=function(t){return this.isValidIp(t)?t.substring(0,t.indexOf(".")):null},i.getIpTwo=function(t){if(!this.isValidIp(t))return null;var e=t.replace(i.getIpFirst(t),"");return e=e.substr(1),e.substring(0,e.indexOf("."))},i.getIpThree=function(t){if(!this.isValidIp(t))return null;var e=t.replace(i.getIpFirst(t),"");return e=e.replace(i.getIpTwo(t),""),e.substring(2,e.lastIndexOf("."))},i.getIpPrefix=function(t){if(!this.isValidIp(t))return null;var e=/^((\d{1,3}\.){2}(\d{1,3}))/;return t.match(e)[0]},i.getTablePageData=function(t,e){e&&void 0!=e||(e={});var i=[],n=[],s=t.datagrid("options").pageNumber,o=t.datagrid("getChecked");for(var a in e)a==s&&(delete e[s],e[s]=o),i.push(a);-1==i.indexOf(s)&&(e[s]=o);for(var r in e)$(e[r]).each(function(t,e){n.push(e)});return n},i.ippoolFormat=function(t){var e=[],n="",s="",o="",a="",r="",c="",h="";return $(t).each(function(t,i){if(i.start==i.end)e.push({ip:i.start,dhcp:!1,used:0,vm:"",tenant:{}});else if(n=i.start.slice(0,i.start.lastIndexOf(".")),s=i.end.slice(0,i.end.lastIndexOf(".")),r=i.start.slice(i.start.lastIndexOf(".")+1),c=i.end.slice(i.end.lastIndexOf(".")+1),h=i.start.slice(0,n.lastIndexOf(".")),o=n.slice(n.lastIndexOf(".")+1),a=s.slice(s.lastIndexOf(".")+1),n==s)for(var t=Number(r);t<=Number(c);t++)e.push({ip:n+"."+t,dhcp:!1,used:0,vm:"",tenant:{}});else{if(Number(a)-Number(o)>1)for(var l=Number(o)+1;l<Number(a);l++)for(var d=0;255>=d;d++)e.push({ip:h+"."+l+"."+d,dhcp:!1,used:0,vm:"",tenant:{}});for(var p=Number(r);255>=p;p++)e.push({ip:h+"."+o+"."+p,dhcp:!1,used:0,vm:"",tenant:{}});for(var u=0;u<=Number(c);u++)e.push({ip:h+"."+a+"."+u,dhcp:!1,used:0,vm:"",tenant:{}})}}),e=i.uniq(e)},i.getTotalIP=function(t){var e,n,s,o;return t.tenants?(e=t.ipused,n=t.tenants,s=i.ippoolFormat(t.ippools),$(n).each(function(t,e){o=i.ippoolFormat(e.ippools),$(o).each(function(t,i){$(s).each(function(t,n){i.ip==n.ip&&(n.tenant.id=e.id,n.tenant.name=e.name)})})})):(e=t.ipused,s=i.ippoolFormat(t.ippools),$(s).each(function(e,i){i.tenant.id=t.id,i.tenant.name=t.name})),$(e).each(function(t,e){i.find(s,function(t){t.ip==e.ip&&(t.dhcp=e.dhcp,t.used=e.used?0:1,t.port=e.port,t.vm=""!=e.vm||e.dhcp?e.vm:"emptyvm")})}),s},i.getAvailableIP=function(t){var t=t||{},e=t.ipavailable;if(!i.isArray(e)||!e.length)return[];var n=i.ippoolFormat(e);return i.each(n,function(e,i){e.tenant.id=t.id,e.tenant.name=t.name}),n},i.sliceIpData=function(t){for(var e,i,n=arguments,s=[],o=0,a=0;a<t.length;a++){var r=t[a];if($(r).each(function(c,h){return 254!=Number(ef.util.getIpSufix(h))||r.type||(e=ef.util.getIpThree(h),s=r,i=a),Number(ef.util.getIpThree(h))==Number(e)+1&&i!=a&&1==Number(ef.util.getIpSufix(h))?(o=1,t[a]=s.concat(r),t.splice(i,1),n.callee(t),!1):void 0}),1==o)break}return t},i.getIpGroupsData=function(t){var e=ef.util.map(t,function(t){return ef.util.getIpThree(t)});e=ef.util.uniq(e);var n=[];ef.util.map(e,function(e){var i=ef.util.map(t,function(t){return e==ef.util.getIpThree(t)?t:void 0});n.push(ef.util.without(i,void 0))});var s=[];$(n).each(function(t,e){var i=[],n=[],o=[];$(e).each(function(t,a){Number(ef.util.getIpSufix(e[0]))+1==Number(ef.util.getIpSufix(e[1]))?(i.push(e[0]),i.push(e[1]),o.push(e[0]),o.push(e[1])):(n.push(e[0]),0!=o.length&&(o=ef.util.uniq(o),s.push(o)),o=[]),e.splice(0,1)}),i=ef.util.uniq(i),n=ef.util.difference(n,i),$(n).each(function(t,e){s.push([e])})}),s=i.sliceIpData(s);var o=ef.util.map(s,function(t){return t.type?void 0:t});o=ef.util.without(o,void 0,[]);var a=[];return $(o).each(function(t,e){a.push({start:e[0],end:e[e.length-1]})}),a},i.param=function(t,e,i){if(e){var n=/\?{1,}/g,s=/\?$/,o=/&$/g,a=n.test(e),r=s.test(e),c=o.test(e);return a?r||c||(e+="&"):e+="?",e+$.param(t,i)}return $.param(t,i)},i.url=function(t,e,i){return this.param({_:(new Date).getTime()+""+Math.floor(1e5*Math.random())},this.param(e||{},t,i),i)},this.explore=function(t){this[name]=t},i.encrypt=function(t){return t=this.base64_encode(t),t=t.replace(/=/g,"EstedN")},i.decrypt=function(t){return t=t.replace(/EstedN/g,"="),this.base64_decode(t)},i.getQueryString=function(t,e){e=String(e||ef.root.location.href);var i=new RegExp("(\\?|&)"+t+"=([^&]*)(&|$)"),n=e.match(i);return n&&this.isArray(n)?decodeURIComponent(n[2]):void 0},i.base64_encode=function(t){for(var e,i,n,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=t.length,r="";a>o;){if(e=255&t.charCodeAt(o++),o==a){r+=s.charAt(e>>2),r+=s.charAt((3&e)<<4),r+="==";break}if(i=t.charCodeAt(o++),o==a){r+=s.charAt(e>>2),r+=s.charAt((3&e)<<4|(240&i)>>4),r+=s.charAt((15&i)<<2),r+="=";break}n=t.charCodeAt(o++),r+=s.charAt(e>>2),r+=s.charAt((3&e)<<4|(240&i)>>4),r+=s.charAt((15&i)<<2|(192&n)>>6),r+=s.charAt(63&n)}return r},i.base64_decode=function(t){for(var e,i,n,s,o=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],a=0,r=t.length,c="";r>a;){do e=o[255&t.charCodeAt(a++)];while(r>a&&-1==e);if(-1==e)break;do i=o[255&t.charCodeAt(a++)];while(r>a&&-1==i);if(-1==i)break;c+=String.fromCharCode(e<<2|(48&i)>>4);do{if(n=255&t.charCodeAt(a++),61==n)return c;n=o[n]}while(r>a&&-1==n);if(-1==n)break;c+=String.fromCharCode((15&i)<<4|(60&n)>>2);do{if(s=255&t.charCodeAt(a++),61==s)return c;s=o[s]}while(r>a&&-1==s);if(-1==s)break;c+=String.fromCharCode((3&n)<<6|s)}return c},i.trimHtml=function(t){var e=/<[^>]*>/g;return t.replace(e,"")},i.trimScript=function(t){var e=new RegExp("<script[^>]*?>.*?</script>","g");return t.replace(e,"")},i.trimImg=function(t){var e=/<img[^>]*>/g;return t.replace(e,"")},i.getFunctionName=function(t){var e=String(t),i=/^function\s+(\w+)()/,n=e.match(i);return n?n[1]:""},i.cn2unicode=function(t){if(t){var e=escape(t);return e.replace(/%/g,"\\")}},i.search=function(t){var e=this.arg2arr(arguments);e.shift();for(var n=[],s=0;s<e.length;s++){var o=e[s];s||(n=t),n=i.filter(n,function(t){return o.filterFunction?o.filterFunction(t):String(o.value).length?t[o.key]==o.value:!0})}return{total:n.length,rows:n}},i.unicode2cn=function(t){if(t){var e=t.replace(/\\+/g,"%");return unescape(e)}},i.EchartsColor={setColorList:[],colorList:["#e32028","#1a08b7","#7e08b7","#0899b7","#1aa100","#1ad99c","#fff000","#d7931e","#2f72e0","#f75b36","#dc88ff","#2fd1e0","#59e02f","#4e93f2","#f7b136","#89e2f5"],colorCache:[{data:[{name:"cpu",color:"#e32028"},{name:"mem",color:"#e32028"}],type:"info"}],setColor:function(t){i.isArray(t)&&(this.setColorList=t)},clearColor:function(t){i.isBoolean(t)&&t&&(this.colorCache=[{data:[{name:"cpu",color:"#e32028"},{name:"mem",color:"#e32028"}],type:"info"}])},getColor:function(t,e){if(!t&&!e)return[];var i=this.colorList;if(this.setColorList.length>0&&(i=this.setColorList),this.colorCache.length>i.length)return[];var n=null,s=!1;$(this.colorCache).each(function(i,o){o.type==e&&(s=!0,$(o.data).each(function(e,i){i.name==t&&(n=i.color)}))}),s||this.colorCache.push({type:e,data:[]}),n||$(this.colorCache).each(function(s,o){if(o.type==e){var a=o.data.length;o.data.push({name:t,color:i[a]}),n=i[a]}}),console.log(this.colorCache,n);var o={itemStyle:{normal:{color:n}},lineStyle:{normal:{width:2,color:n}}};return o}},t(["framework.core"],function(t){i.ready=function(e){var i=new t.Timer(10,function(){var t=$("._temp_data_cont___");t.length&&(i.destory(),e(t))},null,!0);i.start()},t.register(i)}),i}),define("framework.viewstack",["exports","framework.core"],function(t,e){function i(t,e,i){return this.box=t,this.data=e,this.config=i,this._callback=$.noop,this.init(),this.render(),this}return i.isDom=!0,i.prototype.init=function(){this.current=-1,this.numchildren=0,this.children=[],this.oldPos=-1;var t=this;_.isArray(this.data)&&(this.box.empty(),$(this.data).each(function(){var e=$("<li></li>");void 0!=this.content?e.append(this.content):void 0!=this.contentURL&&e.load(this.contentURL),this.selected&&e.addClass("selected"),t.box.append(e)}))},i.prototype.change=function(t){return this._callback=t?t:this._callback,this},i.prototype.render=function(){var t=this;this.box.addClass("viewstack"),this.box.children("li").addClass("viewstack-li"),this.numchildren=this.box.children("li").length,this.current=this.box.children("li.selected").index(),this.current=-1==this.current?0:this.current,this.box.children("li").each(function(e,i){var n=new t.Stack;n.dom=$(this),n.index=e,t.children.push(n),_.isArray(t.data)?n.data=t.data[e]:n.data={content:$(this).children(),selected:$(this).hasClass("selected")},$(this).hasClass("selected")&&(t.current=e)}),this.config&&this.config.killAutoSelected||this["goto"](this.current)},i.prototype["goto"]=function(t){var e=this,i=null;return t>=this.numchildren||0>t?void 0:($(this.children).each(function(n,s){t==s.index?(s.dom.addClass("selected"),s.index=t,e.current=t,i=s,s.selected=!0):(s.dom.removeClass("selected"),s.selected=!1)}),this.current!=this.oldPos&&this._callback(this.current,i),this.oldPos=this.current,this)},i.prototype.next=function(){return this["goto"](this.current+1)},i.prototype.prev=function(){return this["goto"](this.current-1)},i.prototype.first=function(){return this["goto"](0)},i.prototype.last=function(){return this["goto"](this.numchildren-1)},i.prototype.Stack=function(){this.dom=null,this.index=-1,this.data=null},i.prototype.getStack=function(t){return _.isNumber(t)?0>t?!1:t>this.children.length-1?!1:this.children[t]:!1},ef.register(i,"viewstack"),i});